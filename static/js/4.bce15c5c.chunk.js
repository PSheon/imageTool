(this["webpackJsonpimage-edit-app"]=this["webpackJsonpimage-edit-app"]||[]).push([[4],{721:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e){return(i="function"==typeof Symbol&&"symbol"==r(Symbol.iterator)?function(e){return"undefined"===typeof e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"===typeof e?"undefined":r(e)})(e)}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=function(e){return e instanceof HTMLElement},s=function(e,t){return t.parentNode.insertBefore(e,t)},f=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},d=function(e){return"object"===i(e)&&null!==e},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=a({},e),i=[],o=[],l=function(e,t,n){n?o.push({type:e,data:t}):(f[e]&&f[e](t),i.push({type:e,data:t}))},c=function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return s[e]?(t=s)[e].apply(t,r):null},u={getState:function(){return a({},r)},processActionQueue:function(){var e=[].concat(i);return i.length=0,e},processDispatchQueue:function(){var e=[].concat(o);o.length=0,e.forEach(function(e){var t=e.type,n=e.data;l(t,n)})},dispatch:l,query:c},s={};t.forEach(function(e){s=a({},e(r),s)});var f={};return n.forEach(function(e){f=a({},e(l,c,r),f)}),u},p=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},m=function(e){var t={};return p(e,function(n){!function(e,t,n){"function"!=typeof n?Object.defineProperty(e,t,n):e[t]=n}(t,n,e[n])}),t},g=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===n)return e.getAttribute(t)||e.hasAttribute(t);e.setAttribute(t,n)},v="http://www.w3.org/2000/svg",y=["svg","path"],E=function(e){return y.includes(e)},_=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===i(t)&&(n=t,t=null);var r=E(e)?document.createElementNS(v,e):document.createElement(e);return t&&(E(e)?g(r,"class",t):r.className=t),p(n,function(e,t){g(r,e,t)}),r},w=function(e){return function(t,n){void 0!==n&&e.children[n]?e.insertBefore(t,e.children[n]):e.appendChild(t)}},T=function(e,t){return function(e,n){return void 0!==n?t.splice(n,0,e):t.push(e),e}},x=function(e,t){return function(n){return t.splice(t.indexOf(n),1),n.element.parentNode&&e.removeChild(n.element),n}},R=function(e,t,n,r){var i=n[0]||e.left,o=n[1]||e.top,l=i+e.width,c=o+e.height*(r[1]||1),u={element:a({},e),inner:{left:e.left,top:e.top,right:e.right,bottom:e.bottom},outer:{left:i,top:o,right:l,bottom:c}};return t.filter(function(e){return!e.isRectIgnored()}).map(function(e){return e.rect}).forEach(function(e){A(u.inner,a({},e.inner)),A(u.outer,a({},e.outer))}),I(u.inner),u.outer.bottom+=u.element.marginBottom,u.outer.right+=u.element.marginRight,I(u.outer),u},A=function(e,t){t.top+=e.top,t.right+=e.left,t.bottom+=e.top,t.left+=e.left,t.bottom>e.bottom&&(e.bottom=t.bottom),t.right>e.right&&(e.right=t.right)},I=function(e){e.width=e.right-e.left,e.height=e.bottom-e.top},C=function(e){return"number"==typeof e},b=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;return Math.abs(e-t)<r&&Math.abs(n)<r},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stiffness,n=void 0===t?.5:t,r=e.damping,i=void 0===r?.75:r,o=e.mass,a=void 0===o?10:o,l=e.delay,c=void 0===l?0:l,u=null,s=null,f=0,d=!1,h=null,p=m({interpolate:function(e){if(null===h&&(h=e),!(e-c<h||d)){if(!C(u)||!C(s))return d=!0,void(f=0);b(s+=f+=-(s-u)*n/a,u,f*=i)?(s=u,f=0,d=!0,p.onupdate(s),p.oncomplete(s)):p.onupdate(s)}},target:{set:function(e){if(C(e)&&!C(s)&&(s=e,h=null),null===u&&(u=e,s=e,h=null),d&&(h=null),s===(u=e)||void 0===u)return d=!0,f=0,h=null,p.onupdate(s),void p.oncomplete(s);d=!1},get:function(){return u}},resting:{get:function(){return d}},onupdate:function(){},oncomplete:function(){},position:{get:function(){return s}}});return p},M=function(e){return e<.5?2*e*e:(4-2*e)*e-1},S={spring:O,tween:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.duration,i=void 0===r?500:r,o=n.easing,a=void 0===o?M:o,l=n.delay,c=void 0===l?0:l,u=null,s=!0,f=!1,d=null,h=m({interpolate:function(n){s||null===d||(null===u&&(u=n),n-u<c||((e=n-u-c)<i?(t=e/i,h.onupdate((e>=0?a(f?1-t:t):0)*d)):(e=1,t=f?0:1,h.onupdate(t*d),h.oncomplete(t*d),s=!0)))},target:{get:function(){return f?0:d},set:function(e){if(null===d)return d=e,h.onupdate(e),void h.oncomplete(e);e<d?(d=1,f=!0):(f=!1,d=e),s=!1,u=null}},resting:{get:function(){return s}},onupdate:function(){},oncomplete:function(){}});return h}},L=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(t=Array.isArray(t)?t:[t]).forEach(function(t){e.forEach(function(e){var o=e,a=function(){return n[e]},l=function(t){return n[e]=t};"object"===i(e)&&(o=e.key,a=e.getter||a,l=e.setter||l),t[o]&&!r||(t[o]={get:a,set:l})})})},P={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},G=function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!0;for(var n in t)if(t[n]!==e[n])return!0;return!1},k=function(e,t){var n=t.opacity,r=t.perspective,i=t.translateX,o=t.translateY,a=t.scaleX,l=t.scaleY,c=t.rotateX,u=t.rotateY,s=t.rotateZ,f=t.originX,d=t.originY,h=t.width,p=t.height,m="",g="";null==f&&null==d||(g+="transform-origin: ".concat(f||0,"px ").concat(d||0,"px;")),null!=r&&(m+="perspective(".concat(r,"px) ")),null==i&&null==o||(m+="translate3d(".concat(i||0,"px, ").concat(o||0,"px, 0) ")),null==a&&null==l||(m+="scale3d(".concat(null!=a?a:1,", ").concat(null!=l?l:1,", 1) ")),null!=s&&(m+="rotateZ(".concat(s,"rad) ")),null!=c&&(m+="rotateX(".concat(c,"rad) ")),null!=u&&(m+="rotateY(".concat(u,"rad) ")),""!=m&&(g+="transform:".concat(m,";")),null!=n&&(g+="opacity:".concat(n,";"),n<1&&(g+="pointer-events:none;"),0===n&&"BUTTON"===e.nodeName&&(g+="visibility:hidden;")),null!=h&&(g+="width:".concat(h,"px;")),null!=p&&(g+="height:".concat(p,"px;"));var v=e.elementCurrentStyle||"";g.length===v.length&&g===v||(e.style.cssText=g,e.elementCurrentStyle=g)},D={styles:function(e){var t=e.mixinConfig,n=e.viewProps,r=e.viewInternalAPI,i=e.viewExternalAPI,o=e.view,l=a({},n),c={};L(t,[r,i],n);var u=function(){return o.rect?R(o.rect,o.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return r.rect={get:u},i.rect={get:u},t.forEach(function(e){n[e]=void 0===l[e]?P[e]:l[e]}),{write:function(){if(G(c,n))return k(o.element,n),Object.assign(c,a({},n)),!0},destroy:function(){}}},listeners:function(e){var t=e.viewExternalAPI,n=e.view,r=[],i=function(e){return function(t,n){e.addEventListener(t,n)}}(n.element),o=function(e){return function(t,n){e.removeEventListener(t,n)}}(n.element);return t.on=function(e,t){r.push({type:e,fn:t}),i(e,t)},t.off=function(e,t){r.splice(r.findIndex(function(n){return n.type===e&&n.fn===t}),1),o(e,t)},{write:function(){return!0},destroy:function(){r.forEach(function(e){o(e.type,e.fn)})}}},animations:function(e){var t=e.mixinConfig,n=e.viewProps,r=e.viewInternalAPI,o=e.viewExternalAPI,l=a({},n),c=[];return p(t,function(e,t){var u=function(e,t,n){var r=e[t]&&"object"===i(e[t][n])?e[t][n]:e[t]||e,o="string"==typeof r?r:r.type,l="object"===i(r)?a({},r):{};return S[o]?S[o](l):null}(t);u&&(u.onupdate=function(t){n[e]=t},u.target=l[e],L([{key:e,setter:function(e){u.target!==e&&(u.target=e)},getter:function(){return n[e]}}],[r,o],n,!0),c.push(u))}),{write:function(e){var t=!0;return c.forEach(function(n){n.resting||(t=!1),n.interpolate(e)}),t},destroy:function(){}}},apis:function(e){var t=e.mixinConfig,n=e.viewProps,r=e.viewExternalAPI;L(t,r,n)}},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.layoutCalculated||(e.paddingTop=parseInt(n.paddingTop,10)||0,e.marginTop=parseInt(n.marginTop,10)||0,e.marginRight=parseInt(n.marginRight,10)||0,e.marginBottom=parseInt(n.marginBottom,10)||0,e.marginLeft=parseInt(n.marginLeft,10)||0,t.layoutCalculated=!0),e.left=t.offsetLeft||0,e.top=t.offsetTop||0,e.width=t.offsetWidth||0,e.height=t.offsetHeight||0,e.right=e.left+e.width,e.bottom=e.top+e.height,e.scrollTop=t.scrollTop,e.hidden=null===t.offsetParent&&"fixed"!==n.position,e},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tag,n=void 0===t?"div":t,r=e.name,i=void 0===r?null:r,o=e.attributes,l=void 0===o?{}:o,c=e.read,u=void 0===c?function(){}:c,s=e.write,f=void 0===s?function(){}:s,d=e.create,h=void 0===d?function(){}:d,p=e.destroy,g=void 0===p?function(){}:p,v=e.filterFrameActionsForChild,y=void 0===v?function(e,t){return t}:v,E=e.didCreateView,A=void 0===E?function(){}:E,I=e.didWriteView,C=void 0===I?function(){}:I,b=e.shouldUpdateChildViews,O=void 0===b?function(){return!0}:b,M=e.ignoreRect,S=void 0!==M&&M,L=e.ignoreRectUpdate,P=void 0!==L&&L,G=e.mixins,k=void 0===G?[]:G;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=_(n,i?"doka--".concat(i):null,l),o=window.getComputedStyle(r,null),c=U(),s=null,d=!1,p=[],v=[],E={},I={},b=[f],M=[u],L=[g],G=function(){return r},V=function(){return[].concat(p)},B=function(){return s||(s=R(c,p,[0,0],[1,1]))},N=function(){return r.layoutCalculated=!1},z={element:{get:G},style:{get:function(){return o}},childViews:{get:V}},F=a({},z,{rect:{get:B},ref:{get:function(){return E}},is:function(e){return i===e},appendChild:w(r),createChildView:function(e){return function(t,n){return t(e,n)}}(e),linkView:function(e){return p.push(e),e},unlinkView:function(e){p.splice(p.indexOf(e),1)},appendChildView:T(0,p),removeChildView:x(r,p),registerWriter:function(e){return b.push(e)},registerReader:function(e){return M.push(e)},registerDestroyer:function(e){return L.push(e)},invalidateLayout:N,dispatch:e.dispatch,query:e.query}),W={element:{get:G},childViews:{get:V},rect:{get:B},resting:{get:function(){return d}},isRectIgnored:function(){return S},invalidateLayout:N,_read:function(){s=null,O({root:Y,props:t})&&p.forEach(function(e){return e._read()}),!(P&&c.width&&c.height)&&U(c,r,o);var e={root:Y,props:t,rect:c};M.forEach(function(t){return t(e)})},_write:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0===n.length;return b.forEach(function(i){!1===i({props:t,root:Y,actions:n,timestamp:e})&&(r=!1)}),v.forEach(function(t){!1===t.write(e)&&(r=!1)}),O({props:t,root:Y,actions:n,timestamp:e})&&(p.filter(function(e){return!!e.element.parentNode}).forEach(function(t){t._write(e,y(t,n))||(r=!1)}),p.forEach(function(t,i){t.element.parentNode||(Y.appendChild(t.element,i),t._read(),t._write(e,y(t,n)),r=!1)})),d=r,C({props:t,root:Y,actions:n,timestamp:e}),r},_destroy:function(){v.forEach(function(e){return e.destroy()}),L.forEach(function(e){e({root:Y})}),p.forEach(function(e){return e._destroy()})}},q=a({},z,{rect:{get:function(){return c}}});Object.keys(k).sort(function(e,t){return"styles"===e?1:"styles"===t?-1:0}).forEach(function(e){var n=D[e]({mixinConfig:k[e],viewProps:t,viewState:I,viewInternalAPI:F,viewExternalAPI:W,view:m(q)});n&&v.push(n)});var Y=m(F);h({root:Y,props:t});var H=(r.children||[]).length;return p.forEach(function(e,t){Y.appendChild(e.element,H+t)}),A(Y),m(W)}},B=function(e,t){return function(n){var r=n.root,i=n.props,o=n.actions,a=void 0===o?[]:o,l=n.timestamp;if(a.filter(function(t){return e[t.type]}).forEach(function(t){return e[t.type]({root:r,props:i,action:t.data,timestamp:l})}),t)return t({root:r,props:i,actions:a,timestamp:l})}},N=function(e){return Array.isArray(e)},z=function(e){return null==e},F=function(e){return e.trim()},W=function(e){return""+e},q=function(e){return"boolean"==typeof e},Y=function(e){return"string"==typeof e},H=function(e){return C(e)?e:Y(e)?W(e).replace(/[a-z]+/gi,""):0},j=function(e){return parseInt(H(e),10)},Z=function(e){return C(e)&&isFinite(e)&&Math.floor(e)===e},X=function(e){if(Z(e))return e;var t=W(e).trim();return/MB$/i.test(t)?(t=t.replace(/MB$i/,"").trim(),1e3*j(t)*1e3):/KB/i.test(t)?(t=t.replace(/KB$i/,"").trim(),1e3*j(t)):j(t)},K=function(e){return N(e)?"array":function(e){return null===e}(e)?"null":Z(e)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(e)?"bytes":i(e)},Q={array:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return z(e)?[]:N(e)?e:W(e).split(t).map(F).filter(function(e){return e.length})},boolean:function(e){return q(e)?e:"true"===e},int:function(e){return"bytes"===K(e)?X(e):j(e)},float:function(e){return parseFloat(H(e))},bytes:X,string:function(e){return function(e){return"function"==typeof e}(e)?e:W(e)},object:function(e){try{return JSON.parse(function(e){return e.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",')}(e))}catch(t){return e}},file:function(e){return e},function:function(e){return function(e){for(var t=self,n=e.split("."),r=null;r=n.shift();)if(!(t=t[r]))return null;return t}(e)}},J=function(e,t,n){if(e===t)return e;var r=K(e);if(r!==n){var i=function(e,t){return Q[t](e)}(e,n);if(r=K(i),null===i)throw'Trying to assign value with incorrect type, allowed type: "'.concat(n,'"');e=i}return e},$=function(e){var t={};return p(e,function(n){var r=Y(e[n])?e[n]:n,i=e[r];t[n]=r===n?function(e,t){var n=e;return{enumerable:!0,get:function(){return n},set:function(r){n=J(r,e,t)}}}(i[0],i[1]):t[r]}),m(t)},ee=function(e){e.file=null,e.activeView=null,e.markup=[],e.rootRect={x:0,y:0,left:0,top:0,width:0,height:0},e.stage=null,e.stageOffset=null,e.image=null,e.zoomTimeoutId=null,e.instantUpdate=!1,e.filePromise=null,e.fileLoader=null,e.instructions={size:null,crop:null,filter:null,color:null},e.filter=null,e.filterName=null,e.filterValue=null,e.colorValues={},e.colorMatrices={},e.size={width:!1,height:!1,aspectRatioLocked:!0,aspectRatioPrevious:!1},e.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,limitToImageBounds:!0,draft:{rectangle:null,transforms:null}}},te=function(e){var t={noImageTimeout:null,options:$(e)};return ee(t),t},ne=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.split(/(?=[A-Z])/).map(function(e){return e.toLowerCase()}).join(t)},re=function(e,t){var n={};return p(t,function(r){var i=Y(t[r])?t[r]:r;n[r]={get:function(){return e.getState().options[i]},set:function(t){e.dispatch("SET_".concat(ne(i,"_").toUpperCase()),{value:t})}}}),n},ie=function(e){return function(t,n,r){var i={};return p(e,function(e){var n=ne(e,"_").toUpperCase();i["SET_".concat(n)]=function(i){var o;try{o=r.options[e],r.options[e]=i.value}catch(e){}t("DID_SET_".concat(n),{value:r.options[e],prevValue:o})}}),i}},oe=function(e){return function(t){var n={};return p(e,function(e){n["GET_".concat(ne(e,"_").toUpperCase())]=function(){return t.options[e]}}),n}},ae=function(){return Math.random().toString(36).substr(2,9)},le=function(){var e=[],t=function(t,n){!function(e,t){e.splice(t,1)}(e,e.findIndex(function(e){return e.event===t&&(e.cb===n||!n)}))};return{fire:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.filter(function(e){return e.event===t}).map(function(e){return e.cb}).forEach(function(e){setTimeout(function(){e.apply(void 0,r)},0)})},on:function(t,n){e.push({event:t,cb:n})},onOnce:function(n,r){e.push({event:n,cb:function(){t(n,r),r.apply(void 0,arguments)}})},off:t}},ce="boolean",ue="int",se="number",fe="string",de="array",he="object",pe="function",me="file",ge="undefined"!=typeof window&&void 0!==window.document,ve=function(){return ge},ye=null,Ee=function(){return null===ye&&(ye=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),ye},_e=function(){return a({},Te)},we=function(e,t){e=function(e){return Y(Te[e])?Te[e]:e}(e),Te[e][0]=J(t,Te[e][0],Te[e][1])},Te={id:[null,fe],className:[null,fe],src:[null,me],maxImagePreviewWidth:[1500,ue],maxImagePreviewHeight:[1500,ue],allowPreviewFitToView:[!0,ce],allowButtonCancel:[!0,ce],allowButtonConfirm:[!0,ce],allowDropFiles:[!1,ce],allowBrowseFiles:[!0,ce],allowAutoClose:[!0,ce],allowAutoDestroy:[!1,ce],utils:[["crop","filter","color","markup"],de],initialState:[null,he],outputData:[!1,ce],outputFile:[!0,ce],outputCorrectImageExifOrientation:[!0,ce],outputStripImageHead:[!0,ce],outputType:[null,fe],outputQuality:[null,ue],outputFit:["cover",fe],outputUpscale:[!0,ce],outputWidth:[null,ue],outputHeight:[null,ue],outputCanvasBackgroundColor:[null,fe],outputCanvasMemoryLimit:[ve()&&Ee()?16777216:null,ue],size:[null,he],sizeMin:[{width:1,height:1},he],sizeMax:[{width:9999,height:9999},he],filter:[null,he],filters:[{original:{label:"Original",matrix:function(){return null}},chrome:{label:"Chrome",matrix:function(){return[1.398,-.316,.065,-.273,.201,-.051,1.278,-.08,-.273,.201,-.051,.119,1.151,-.29,.215,0,0,0,1,0]}},fade:{label:"Fade",matrix:function(){return[1.073,-.015,.092,-.115,-.017,.107,.859,.184,-.115,-.017,.015,.077,1.104,-.115,-.017,0,0,0,1,0]}},mono:{label:"Mono",matrix:function(){return[.212,.715,.114,0,0,.212,.715,.114,0,0,.212,.715,.114,0,0,0,0,0,1,0]}},noir:{label:"Noir",matrix:function(){return[.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,0,0,0,1,0]}}},he],crop:[null,he],cropShowSize:[!1,ce],cropZoomTimeout:[null,ue],cropMask:[null,pe],cropMaskInset:[0,ue],cropAllowImageTurnLeft:[!0,ce],cropAllowImageTurnRight:[!1,ce],cropAllowImageFlipHorizontal:[!0,ce],cropAllowImageFlipVertical:[!0,ce],cropAllowToggleLimit:[!1,ce],cropLimitToImageBounds:[!0,ce],cropResizeMatchImageAspectRatio:[!1,ce],cropResizeKeyCodes:[[18,91,92,93],de],cropResizeScrollRectOnly:[!1,ce],cropAspectRatio:[null,fe],cropAspectRatioOptions:[null,de],cropMinImageWidth:[1,ue],cropMinImageHeight:[1,ue],colorBrightness:[0,se],colorBrightnessRange:[[-.25,.25],de],colorContrast:[1,se],colorContrastRange:[[.5,1.5],de],colorExposure:[1,se],colorExposureRange:[[.5,1.5],de],colorSaturation:[1,se],colorSaturationRange:[[0,2],de],markup:[null,de],markupFilter:[function(){return!0},pe],markupAllowAddMarkup:[!0,ce],markupFontSizeDefault:[2,se],markupFontSizeOptions:[[["XL",.15],["L",.125],["M",.1],["S",.075],["XS",.05]],de],markupFontFamilyDefault:[1,ue],markupFontFamilyOptions:[[["Serif","Palatino, 'Times New Roman', serif"],["Sans Serif","Helvetica, Arial, Verdana"],["Monospaced","Monaco, 'Lucida Console', monospaced"]],de],markupShapeStyleDefault:[2,ue],markupShapeStyleOptions:[[["Fill",0,null,0],["Outline thick",.025,null,4],["Outline default",.015,null,2],["Outline thin",.005,null,1],["Outline dashed",.005,[.01],1]],de],markupLineStyleDefault:[1,ue],markupLineStyleOptions:[[["Thick",.025,null,4],["Default",.015,null,2],["Thin",.005,null,1],["Dashed",.005,[.01],1]],de],markupLineDecorationDefault:[1,ue],markupLineDecorationOptions:[[["None",[]],["Single arrow",["arrow-end"]],["Double arrow",["arrow-begin","arrow-end"]]],de],markupColorDefault:[0,ue],markupColorOptions:[[["White","#fff","#f6f6f6"],["Silver","#9e9e9e"],["Black","#000","#333"],["Red","#f44336"],["Orange","#ff9800"],["Yellow","#ffeb3b"],["Green","#4caf50"],["Blue","#2196f3"],["Violet","#3f51b5"],["Purple","#9c27b0"]],de],beforeCreateBlob:[null,pe],afterCreateBlob:[null,pe],onconfirm:[null,pe],oncancel:[null,pe],onclose:[null,pe],onloadstart:[null,pe],onload:[null,pe],onloaderror:[null,pe],onupdate:[null,pe],oninit:[null,pe],ondestroy:[null,pe],labelButtonReset:["Reset",fe],labelButtonCancel:["Cancel",fe],labelButtonConfirm:["Done",fe],labelButtonUtilCrop:["Crop",fe],labelButtonUtilResize:["Resize",fe],labelButtonUtilFilter:["Filter",fe],labelButtonUtilColor:["Colors",fe],labelButtonUtilMarkup:["Markup",fe],labelStatusMissingWebGL:["WebGL is required but is disabled on your browser",fe],labelStatusAwaitingImage:["Waiting for image\u2026",fe],labelStatusLoadImageError:["Error loading image\u2026",fe],labelStatusLoadingImage:["Loading image\u2026",fe],labelStatusProcessingImage:["Processing image\u2026",fe],labelColorBrightness:["Brightness",fe],labelColorContrast:["Contrast",fe],labelColorExposure:["Exposure",fe],labelColorSaturation:["Saturation",fe],labelMarkupTypeRectangle:["Square",fe],labelMarkupTypeEllipse:["Circle",fe],labelMarkupTypeText:["Text",fe],labelMarkupTypeLine:["Arrow",fe],labelMarkupSelectFontSize:["Size",fe],labelMarkupSelectFontFamily:["Font",fe],labelMarkupSelectLineDecoration:["Decoration",fe],labelMarkupSelectLineStyle:["Style",fe],labelMarkupSelectShapeStyle:["Style",fe],labelMarkupRemoveShape:["Remove",fe],labelButtonCropZoom:["Zoom",fe],labelButtonCropRotateLeft:["Rotate left",fe],labelButtonCropRotateRight:["Rotate right",fe],labelButtonCropRotateCenter:["Center rotation",fe],labelButtonCropFlipHorizontal:["Flip horizontal",fe],labelButtonCropFlipVertical:["Flip vertical",fe],labelButtonCropAspectRatio:["Aspect ratio",fe],labelButtonCropToggleLimit:["Crop selection",fe],labelButtonCropToggleLimitEnable:["Limited to image",fe],labelButtonCropToggleLimitDisable:["Select outside image",fe],pointerEventsPolyfillScope:["root",fe],styleCropCorner:["circle",fe],styleFullscreenSafeArea:[ve()&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",fe],styleLayoutMode:[null,fe]},xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(t,e))},Re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return parseFloat(e.toFixed(t))},Ae=function(e,t){return{x:Re(e.x,t),y:Re(e.y,t)}},Ie=function(e,t){return Se(e.x-t.x,e.y-t.y)},Ce=function(e,t){return function(e,t){return e.x*t.x+e.y*t.y}(Ie(e,t),Ie(e,t))},be=function(e,t){return Math.sqrt(Ce(e,t))},Oe=function(e,t){return Se(xe(e.x,t.x,t.x+t.width),xe(e.y,t.y,t.y+t.height))},Me=function(e,t,n){var r=Math.cos(t),i=Math.sin(t),o=Se(e.x-n.x,e.y-n.y);return Se(n.x+r*o.x-i*o.y,n.y+i*o.x+r*o.y)},Se=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},Le=function(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},Pe=function(e,t){return Ne(e.x+t.x,e.y+t.y,e.width,e.height)},Ge={translate:Pe,rotate:function(e,t,n){var r=function(e,t,n){return 0===t?{tl:e.tl,tr:e.tr,br:e.br,bl:e.bl}:{tl:Me(e.tl,t,n),tr:Me(e.tr,t,n),br:Me(e.br,t,n),bl:Me(e.bl,t,n)}}(Be(e),t,n),i=r.tl,o=r.tr,a=r.br,l=r.bl,c=Math.min(i.x,o.x,a.x,l.x),u=Math.min(i.y,o.y,a.y,l.y),s=Math.max(i.x,o.x,a.x,l.x),f=Math.max(i.y,o.y,a.y,l.y);return Ne(c,u,s-c,f-u)},scale:function(e,t,n){return Ne(t*(e.x-n.x)+n.x,t*(e.y-n.y)+n.y,t*e.width,t*e.height)}},ke=function(e){return Ne(e.x,e.y,e.width,e.height)},De=function(e){return{top:e.y,right:e.x+e.width,bottom:e.y+e.height,left:e.x}},Ue=function(e){var t=e.top,n=e.right,r=e.bottom,i=e.left;return{x:i,y:t,width:n-i,height:r-t}},Ve=function(e){return Se(e.x+.5*e.width,e.y+.5*e.height)},Be=function(e){return{tl:{x:e.x,y:e.y},tr:{x:e.x+e.width,y:e.y},br:{x:e.x+e.width,y:e.y+e.height},bl:{x:e.x,y:e.y+e.height}}},Ne=function(e,t,n,r){return{x:e,y:t,width:n,height:r}},ze=function(e){if(z(e))return e;if(/:/.test(e)){var t=e.split(":"),n=t[0];return t[1]/n}return parseFloat(e)},Fe=function(e,t){var n=e.width,r=n*t;return r>e.height&&(n=(r=e.height)/t),{x:.5*(e.width-n),y:.5*(e.height-r),width:n,height:r}},We=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.height/e.width,i=t,o=1,a=r;a>i&&(o=(a=i)/r);var l=Math.max(1/o,i/a),c=e.width/(n*l*o);return{width:c,height:c*t}},qe=function(e,t){return{x:e,y:t}},Ye=function(e,t){return qe(e.x-t.x,e.y-t.y)},He=function(e,t){return Math.sqrt(function(e,t){return function(e,t){return e.x*t.x+e.y*t.y}(Ye(e,t),Ye(e,t))}(e,t))},je=function(e,t){var n=e,r=t,i=1.5707963267948966-t,o=Math.sin(1.5707963267948966),a=Math.sin(r),l=Math.sin(i),c=Math.cos(i),u=n/o;return qe(c*(u*a),c*(u*l))},Ze=function(e,t){var n=e.width,r=e.height,i=je(n,t),o=je(r,t),a=qe(e.x+Math.abs(i.x),e.y-Math.abs(i.y)),l=qe(e.x+e.width+Math.abs(o.y),e.y+Math.abs(o.x)),c=qe(e.x-Math.abs(o.y),e.y+e.height-Math.abs(o.x));return{width:He(a,l),height:He(a,c)}},Xe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},i=r.x>.5?1-r.x:r.x,o=r.y>.5?1-r.y:r.y,a=2*i*e.width,l=2*o*e.height,c=Ze(t,n);return Math.max(c.width/a,c.height/l)},Ke=function(e,t){var n=t.origin,r=t.translation;return function(e,t,n){return t.reduce(function(e,t){return(0,Ge[t[0]])(e,t[1],n)},e)}(e,[["scale",t.scale],["translate",r]],n)},Qe=function(e,t){var n=e,r=t,i=1.5707963267948966-t,o=Math.sin(1.5707963267948966),a=Math.sin(r),l=Math.sin(i),c=Math.cos(i),u=n/o;return Se(c*(u*a),c*(u*l))},Je=function(e,t){var n=e.width,r=e.height,i=t%(Math.PI/2),o=Qe(n,i),a=Qe(r,i),l=Be(e);return{tl:Se(l.tl.x+Math.abs(o.x),l.tl.y-Math.abs(o.y)),tr:Se(l.tr.x+Math.abs(a.y),l.tr.y+Math.abs(a.x)),br:Se(l.br.x-Math.abs(o.x),l.br.y+Math.abs(o.y)),bl:Se(l.bl.x-Math.abs(a.y),l.bl.y-Math.abs(a.x))}},$e=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.origin,o=n.translation,a=Ke(e,n),l={x:i.x+o.x,y:i.y+o.y},c=2*Math.PI+n.rotation%(2*Math.PI),u=Je(t,c),s=Me(u.tl,-c,l),f=Me(u.tr,-c,l),d=Me(u.br,-c,l),h={x:Math.min(s.x,f.x,d.x),y:Math.min(s.y,f.y,d.y),width:Math.max(s.x,f.x,d.x)-Math.min(s.x,f.x,d.x),height:Math.max(s.y,f.y,d.y)-Math.min(s.y,f.y,d.y)},p=Ne(h.x,h.y,h.width,h.height),m=Ve(p),g=t.height/t.width,v={x:(m.x-a.x)/a.width,y:(m.y-a.y)/a.height},y=v.y>.5?1-v.y:v.y,E=2*(v.x>.5?1-v.x:v.x)*a.width,_=2*y*a.height;return{center:v,zoom:r?Math.min(E/p.width,_/p.height):Math.min(a.width/p.width,a.height/p.height),rotation:n.rotation,aspectRatio:g,scaleToFit:r}},et=function(e,t){var n=tt(e,t);return{center:{x:Re(n.center.x),y:Re(n.center.y)},rotation:Re(n.rotation),zoom:Re(n.zoom),aspectRatio:Re(n.aspectRatio),flip:a({},t.flip),scaleToFit:n.scaleToFit}},tt=function(e,t){var n=$e(e,t.rectangle,t.transforms,t.limitToImageBounds);return{center:{x:n.center.x,y:n.center.y},rotation:n.rotation,zoom:n.zoom,aspectRatio:n.aspectRatio,flip:a({},t.flip),scaleToFit:n.scaleToFit}},nt=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"width",o=e.width,a=e.height;return o||a?(o=o&&xe(o,t.width,n.width),a=a&&xe(a,t.height,n.height),r?(a?o?"width"===i?a=o/r:"height"===i?o=a*r:(a*r<t.width?a=(o=t.width)/r:o/r<t.height&&(o=(a=t.height)*r),a*r>n.width?a=(o=n.width)/r:o/r>n.height&&(o=(a=n.height)*r)):a=xe(a*r,t.width,n.width)/r:o=xe(o/r,t.height,n.height)*r,{width:o,height:a}):{width:o,height:a}):{width:o,height:a}},rt=function(e){var t;if(/^#/.test(e)){if(4===e.length){var n=e.split("");e="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]}var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);t=[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]}else/^rgb/.test(e)&&((t=e.match(/\d+/g).map(function(e){return parseInt(e,10)})).length=3);return t},it=[],ot=function(e){var t=[];return p(e,function(e,n){return t.push(n)}),t.length?t.reduce(function(e,t){return function(e,t){var n=new Array(20);return n[0]=e[0]*t[0]+e[1]*t[5]+e[2]*t[10]+e[3]*t[15],n[1]=e[0]*t[1]+e[1]*t[6]+e[2]*t[11]+e[3]*t[16],n[2]=e[0]*t[2]+e[1]*t[7]+e[2]*t[12]+e[3]*t[17],n[3]=e[0]*t[3]+e[1]*t[8]+e[2]*t[13]+e[3]*t[18],n[4]=e[0]*t[4]+e[1]*t[9]+e[2]*t[14]+e[3]*t[19]+e[4],n[5]=e[5]*t[0]+e[6]*t[5]+e[7]*t[10]+e[8]*t[15],n[6]=e[5]*t[1]+e[6]*t[6]+e[7]*t[11]+e[8]*t[16],n[7]=e[5]*t[2]+e[6]*t[7]+e[7]*t[12]+e[8]*t[17],n[8]=e[5]*t[3]+e[6]*t[8]+e[7]*t[13]+e[8]*t[18],n[9]=e[5]*t[4]+e[6]*t[9]+e[7]*t[14]+e[8]*t[19]+e[9],n[10]=e[10]*t[0]+e[11]*t[5]+e[12]*t[10]+e[13]*t[15],n[11]=e[10]*t[1]+e[11]*t[6]+e[12]*t[11]+e[13]*t[16],n[12]=e[10]*t[2]+e[11]*t[7]+e[12]*t[12]+e[13]*t[17],n[13]=e[10]*t[3]+e[11]*t[8]+e[12]*t[13]+e[13]*t[18],n[14]=e[10]*t[4]+e[11]*t[9]+e[12]*t[14]+e[13]*t[19]+e[14],n[15]=e[15]*t[0]+e[16]*t[5]+e[17]*t[10]+e[18]*t[15],n[16]=e[15]*t[1]+e[16]*t[6]+e[17]*t[11]+e[18]*t[16],n[17]=e[15]*t[2]+e[16]*t[7]+e[17]*t[12]+e[18]*t[17],n[18]=e[15]*t[3]+e[16]*t[8]+e[17]*t[13]+e[18]*t[18],n[19]=e[15]*t[4]+e[16]*t[9]+e[17]*t[14]+e[18]*t[19]+e[19],n}(c(e),t)},t.shift()):[]},at=function(e){return e.crop.draft.transforms?e.crop.draft.transforms.scale:e.crop.transforms.scale},lt=function(e){var t=e.image.width/e.image.naturalWidth,n=at(e);return{width:e.options.cropMinImageWidth*n*t,height:e.options.cropMinImageHeight*n*t}},ct=function(e){var t=at(e);return{width:e.image.width*t,height:e.image.height*t}},ut=function(e){return e.options.cropAspectRatioOptions?e.options.cropAspectRatioOptions.map(function(e){var t={aspectRatio:null,width:null,height:null};return"number"==typeof e.value&&(t.aspectRatio=e.value),"string"==typeof e.value&&(t.aspectRatio=ze(e.value)),"object"===i(e.value)&&null!==e.value&&(t.width=e.value.width,t.height=e.value.height,t.aspectRatio=t.height/t.width),{label:e.label,value:t}}):null},st=function(e){return{ALLOW_MANUAL_RESIZE:function(){return e.options.utils.includes("resize")},GET_SIZE:function(){return!1!==e.size.width&&!1!==e.size.height?{width:e.size.width,height:e.size.height}:{width:null,height:null}},GET_SIZE_INPUT:function(){return{width:e.size.width,height:e.size.height}},GET_SIZE_ASPECT_RATIO_LOCK:function(){return e.size.aspectRatioLocked},IS_ACTIVE_VIEW:function(t){return e.activeView===t},GET_ACTIVE_VIEW:function(){return e.activeView},GET_STYLES:function(){return Object.keys(e.options).filter(function(e){return/^style/.test(e)}).map(function(t){return{name:t,value:e.options[t]}})},GET_FILE:function(){return e.file},GET_IMAGE:function(){return e.image},GET_STAGE:function(){return a({},e.stage,e.stageOffset)},GET_ROOT:function(){return e.rootRect},GET_ROOT_SIZE:function(){return{width:e.rootRect.width,height:e.rootRect.height}},GET_MIN_IMAGE_SIZE:function(){return{width:e.options.cropMinImageWidth,height:e.options.cropMinImageHeight}},GET_IMAGE_PREVIEW_SCALE_FACTOR:function(){return e.image.width/e.image.naturalWidth},GET_MIN_PREVIEW_IMAGE_SIZE:function(){var t=e.image.width/e.image.naturalWidth;return{width:e.options.cropMinImageWidth*t,height:e.options.cropMinImageHeight*t}},GET_MIN_CROP_SIZE:function(){return lt(e)},GET_MAX_CROP_SIZE:function(){return ct(e)},GET_MIN_PIXEL_CROP_SIZE:function(){var t=e.crop.transforms.scale,n=lt(e);return{width:n.width/t,height:n.height/t}},GET_MAX_PIXEL_CROP_SIZE:function(){var t=e.crop.transforms.scale,n=ct(e);return{width:n.width/t,height:n.height/t}},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return ut(e)},GET_ACTIVE_CROP_ASPECT_RATIO:function(){var t=e.crop.aspectRatio;return Y(t)?ze(t):t},GET_CROP_ASPECT_RATIO:function(){var t=Y(e.options.cropAspectRatio)?ze(e.options.cropAspectRatio):e.options.cropAspectRatio,n=ut(e);return!n||n&&!n.length?t:n.find(function(e){return e.value.aspectRatio===t})?t:n[0].value.aspectRatio},GET_CROP_RECTANGLE_ASPECT_RATIO:function(){var t=e.crop,n=t.rectangle,r=t.aspectRatio;return n?n.width/n.height:r},GET_CROP_FLIP:function(){return e.crop.flip?a({},e.crop.flip):a({},e.instructions.crop.flip)},GET_CROP_ROTATION:function(){return a({},e.crop.rotation)},GET_CROP:function(t,n){var r=it[t];if(r&&r.ts===n)return r;var i=gt(e);return i&&(i.ts=n,it[t]=i),i},GET_COLOR_MATRIX:function(){return ot(e.colorMatrices)},GET_COLOR_VALUES:function(){return a({exposure:e.options.colorExposure,brightness:e.options.colorBrightness,contrast:e.options.colorContrast,saturation:e.options.colorSaturation},e.colorValues)},GET_PREVIEW_IMAGE_DATA:function(){return e.file.preview},GET_THUMB_IMAGE_DATA:function(){return e.file.thumb},GET_FILTER:function(){return e.filter},GET_UID:function(){return e.uid},GET_MARKUP_BY_ID:function(t){return e.markup.find(function(e){return e[1].id===t})},GET_BACKGROUND_COLOR:function(){var t=e.options.outputCanvasBackgroundColor;if(!t)return dt;if(ft[t])return ft[t];var n=rt(t);return ft[t]=n.concat(1),ft[t]}}},ft={},dt=[0,0,0,0],ht=function(e,t){var n=function(e){return!1===e.size.width?function(e){return e.options.size?e.options.size.width:null}(e):e.size.width}(e),r=function(e){return!1===e.size.height?function(e){return e.options.size?e.options.size.height:null}(e):e.size.height}(e),i=t.width/t.height;return nt({width:n,height:r},e.options.sizeMin,e.options.sizeMax,i)},pt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.zoom,i=t.rotation,o=t.center,a=t.aspectRatio,l=We(e,a,r),c={x:.5*l.width,y:.5*l.height},u={x:0,y:0,width:l.width,height:l.height,center:c},s=r*Xe(e,Fe(u,a),i,n?o:{x:.5,y:.5});return{widthFloat:l.width/s,heightFloat:l.height/s,width:Math.round(l.width/s),height:Math.round(l.height/s)}},mt=function(e,t){var n=Ve(t);return!function(e,t){return Re(e.x)===Re(t.x)&&Re(e.y)===Re(t.y)}(Ve(e),n)},gt=function(e){if(!e.stage||!e.image)return null;var t=e.crop.draft.rectangle||{free:e.crop.rectangle,limited:e.crop.rectangle},n=e.crop.draft.transforms||e.crop.transforms,r=n.origin,i=n.translation,o=n.scale,a=n.interaction,l=e.crop.rotation,c=e.crop.flip,u=!(!e.crop.draft.rectangle&&!e.crop.draft.transforms),s=u||e.instantUpdate,f=mt(t.limited,e.stage),d=e.crop.isDirty||u,h=e.crop.isRotating,m=void 0===e.crop.limitToImageBounds||e.crop.limitToImageBounds,g={width:e.image.naturalWidth,height:e.image.naturalHeight},v=ot(e.colorMatrices),y={crop:pt(g,tt(e.image,{rectangle:t.limited,transforms:{origin:r,translation:i,scale:o,rotation:l.main+l.sub},flip:c,limitToImageBounds:e.crop.limitToImageBounds}),e.crop.limitToImageBounds),image:ht(e,t.limited)},E=y.image,_=y.crop,w=_.width,T=_.height,x=_.widthFloat/_.heightFloat;E.width&&E.height?(w=E.width,T=E.height):E.width&&!E.height?(w=E.width,T=E.width/x):E.height&&!E.width&&(T=E.height,w=E.height*x),y.currentWidth=Math.round(w),y.currentHeight=Math.round(T);var R={x:0,y:0},A=0,I=0;if(s&&a){if(a.translation){var C=a.translation.x-i.x,b=a.translation.y-i.y;R.x=100*Math.sign(C)*Math.log10(1+Math.abs(C)/100),R.y=100*Math.sign(b)*Math.log10(1+Math.abs(b)/100)}if(a.scale){var O=a.scale-o;A=.25*Math.sign(O)*Math.log10(1+Math.abs(O)/.25)}if(a.rotation){var M=a.rotation-(l.main+l.sub);I=.05*Math.sign(M)*Math.log10(1+Math.abs(M)/.05)}}var S={},L=t.free,P=De(L),G=De(t.limited);return p(P,function(e){var t=P[e]-G[e];S[e]=G[e]+5*Math.sign(t)*Math.log10(1+Math.abs(t)/5)}),{canRecenter:f,canReset:d,isDraft:s,isRotating:h,isLimitedToImageBounds:m,cropRect:{x:S.left,y:S.top,width:S.right-S.left,height:S.bottom-S.top},origin:r,translation:i,translationBand:R,scale:o,scaleBand:A,rotation:l,rotationBand:I,flip:c,interaction:a,cropStatus:y,colorMatrix:v,markup:e.markup}},vt=function(e,t){if(1165519206!==e.getUint32(t+=2,!1))return-1;var n=18761===e.getUint16(t+=6,!1);t+=e.getUint32(t+4,n);var r=e.getUint16(t,n);t+=2;for(var i=0;i<r;i++)if(274===e.getUint16(t+12*i,n))return e.getUint16(t+12*i+8,n)},yt=function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){return t(function(e){var t=new DataView(e);if(65496!=t.getUint16(0,!1))return null;for(var n,r=t.byteLength,i=2;i<r;){if(t.getUint16(i+2,!1)<=8)return-1;if(n=t.getUint16(i,!1),i+=2,65505===n)return vt(t,i);if(65280!=(65280&n))return null;i+=t.getUint16(i,!1)}}(n.result)||-1)},n.readAsArrayBuffer(e.slice(0,262144))})},Et=1,_t=2,wt=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.center,o=e.zoom,a=e.aspectRatio,l=Ve(t),c={x:l.x-n.width*i.x,y:l.y-n.height*i.y},u=2*Math.PI+e.rotation%(2*Math.PI),s=o*Xe(n,Fe(t,a||n.height/n.width),u,r?i:{x:.5,y:.5});return{origin:{x:i.x*n.width,y:i.y*n.height},translation:c,scale:s,rotation:e.rotation}},Tt=function(e){return{origin:a({},e.origin),translation:a({},e.translation),rotation:e.rotation,scale:e.scale}},xt=function(e,t,n,r){var i=n.translation,o=n.scale,l=n.rotation,c=n.origin,u={origin:a({},c),translation:a({},i),scale:o,rotation:2*Math.PI+l%(2*Math.PI)},s=e.height/e.width,f={x:c.x+i.x,y:c.y+i.y},d=Je(t,u.rotation),h=Me(d.tl,-u.rotation,f),p=Me(d.tr,-u.rotation,f),m=Me(d.br,-u.rotation,f),g=Me(d.bl,-u.rotation,f),v={x:Math.min(h.x,p.x,m.x,g.x),y:Math.min(h.y,p.y,m.y,g.y),width:Math.max(h.x,p.x,m.x,g.x)-Math.min(h.x,p.x,m.x,g.x),height:Math.max(h.y,p.y,m.y,g.y)-Math.min(h.y,p.y,m.y,g.y)},y=Ne(v.x,v.y,v.width,v.height),E=Ve(y),_=De(y),w=Ke(e,n),T=Ve(w),x={x:w.x,y:w.y},R={x:T.x,y:T.y},A=E.x,I=E.y,C={x:x.x,y:x.y,width:w.width,height:w.height};if(!function(e,t){var n=De(e),r=De(t);return n.left>=r.left&&n.top>=r.top&&n.bottom<=r.bottom&&n.right<=r.right}(y,w))if("moving"===r){C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width);var b=Ke(e,a({},n,{scale:u.scale})),O=Ve(b);R.x=O.x,R.y=O.y,x.x=b.x,x.y=b.y,C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width);var M={x:C.x-x.x,y:C.y-x.y},S={x:M.x*Math.cos(u.rotation)-M.y*Math.sin(u.rotation),y:M.x*Math.sin(u.rotation)+M.y*Math.cos(u.rotation)};u.translation.x+=S.x,u.translation.y+=S.y}else if("resizing"===r){w.width<y.width&&(C.width=y.width,C.height=C.width*s,C.height<y.height&&(C.height=y.height,C.width=C.height/s)),w.height<y.height&&(C.height=y.height,C.width=C.height/s,C.width<y.width&&(C.width=y.width,C.height=C.width*s)),C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width),u.scale=Xe(e,t,u.rotation,{x:(A-C.x)/C.width,y:(I-C.y)/C.height});var L=Ke(e,a({},n,{scale:u.scale})),P=Ve(L);R.x=P.x,R.y=P.y,x.x=L.x,x.y=L.y,C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width);var G={x:C.x-x.x,y:C.y-x.y},k={x:G.x*Math.cos(u.rotation)-G.y*Math.sin(u.rotation),y:G.x*Math.sin(u.rotation)+G.y*Math.cos(u.rotation)};u.translation.x+=k.x,u.translation.y+=k.y}else if("rotating"===r){var D=!1;if(C.y>y.y){var U=C.y-y.y;C.y=y.y,C.height+=2*U,D=!0}if(C.y+C.height<_.bottom){var V=_.bottom-(C.y+C.height);C.y=_.bottom-C.height,C.height+=2*V,D=!0}if(C.x>y.x){var B=C.x-y.x;C.x=y.x,C.width+=2*B,D=!0}if(C.x+C.width<_.right){var N=_.right-(C.x+C.width);C.x=_.right-C.width,C.width+=2*N,D=!0}D&&(u.scale=Xe(e,t,u.rotation,{x:(A-w.x)/w.width,y:(I-w.y)/w.height}))}return a({},u,{rotation:n.rotation})},Rt={n:function(e){return{x:e.x+.5*e.width,y:e.y}},e:function(e){return{x:e.x+e.width,y:e.y+.5*e.height}},s:function(e){return{x:e.x+.5*e.width,y:e.y+e.height}},w:function(e){return{x:e.x,y:e.y+.5*e.height}}},At=function(e,t){return Rt[e](t)},It=function(e,t,n){var r=n.origin,i=n.translation,o=2*Math.PI+n.rotation%(2*Math.PI),l=Ke(e,n),c={x:r.x+i.x,y:r.y+i.y},u=Je(t,o),s=Me(u.tl,-o,c),f=Me(u.tr,-o,c),d=Me(u.br,-o,c),h={x:Math.min(s.x,f.x,d.x),y:Math.min(s.y,f.y,d.y),width:Math.max(s.x,f.x,d.x)-Math.min(s.x,f.x,d.x),height:Math.max(s.y,f.y,d.y)-Math.min(s.y,f.y,d.y)},p=Ne(h.x,h.y,h.width,h.height),m=De(p),g=De(l),v=l;if(m.top<g.top||m.right>g.right||m.bottom>g.bottom||m.left<g.left){var y=a({},g);if(m.top<=y.top){var E=y.bottom-y.top,_=y.right-y.left,w=Math.max(1,p.height/E),T=E*w,x=_*w-_;y.bottom=m.top+T,y.top=m.top,y.left-=.5*x,y.right+=.5*x}if(m.bottom>=y.bottom){var R=y.bottom-y.top,A=y.right-y.left,I=Math.max(1,p.height/R),C=R*I,b=A*I-A;y.bottom=m.bottom,y.top=m.bottom-C,y.left-=.5*b,y.right+=.5*b}if(m.left<=y.left){var O=y.bottom-y.top,M=y.right-y.left,S=Math.max(1,p.width/M),L=M*S,P=O*S-O;y.right=m.left+L,y.left=m.left,y.top-=.5*P,y.bottom+=.5*P}if(m.right>=y.right){var G=y.bottom-y.top,k=y.right-y.left,D=Math.max(1,p.width/k),U=k*D,V=G*D-G;y.right=m.right,y.left=m.right-U,y.top-=.5*V,y.bottom+=.5*V}v=Ne(y.left,y.top,y.right-y.left,y.bottom-y.top)}var B=Be(v),N=Ve(v),z=Me(B.tl,o,c),F=Me(B.br,o,c),W=z.x+.5*(F.x-z.x),q=z.y+.5*(F.y-z.y),Y=Pe(v,{x:W-N.x,y:q-N.y}),H=Pe(p,{x:W-N.x,y:q-N.y}),j=Ve(H),Z={x:Y.x,y:Y.y},X=Y.width,K=Y.height,Q=(j.x-Z.x)/X,J=(j.y-Z.y)/K,$=X/e.width,ee={x:Q*e.width,y:J*e.height},te=1-$,ne=ee.x*te,re=ee.y*te,ie={x:Z.x+X*Q,y:Z.y+K*J},oe=Me(Z,o,{x:Z.x+.5*X,y:Z.y+.5*K}),ae=Me(Z,o,ie),le=oe.x-ae.x,ce=oe.y-ae.y;return{origin:ee,translation:{x:Z.x-ne+le,y:Z.y-re+ce},scale:$,rotation:n.rotation}},Ct={nw:function(e){return{x:e.x,y:e.y}},ne:function(e){return{x:e.x+e.width,y:e.y}},se:function(e){return{x:e.x+e.width,y:e.y+e.height}},sw:function(e){return{x:e.x,y:e.y+e.height}}},bt=function(e,t){return Ct[e](t)},Ot=Math.PI/2,Mt=Math.PI/4,St=function(e){var t=Re(Mt),n=Re(Ot),r=e/n,i=Math.floor(r)*n,o=e-i;return o>t&&(o-=n,i+=n),{main:i,sub:o}},Lt=function(e){return new Promise(function(t,n){var r=new Image;r.src=URL.createObjectURL(e),r.onerror=function(e){clearInterval(i),n(e)};var i=setInterval(function(){r.naturalWidth&&r.naturalHeight&&(clearInterval(i),URL.revokeObjectURL(r.src),t({width:r.naturalWidth,height:r.naturalHeight}))},1)})},Pt=function(e,t){var n={width:e.width,height:e.height};if(e.width>t.width||e.height>t.height){var r=e.height/e.width,i=t.width/e.width,o=t.height/e.height;i<o?(n.width=e.width*i,n.height=n.width*r):(n.height=e.height*o,n.width=n.height/r)}return n},Gt=function(e){return/^image/.test(e.type)},kt={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},Dt=function(e){e.width=1,e.height=1,e.getContext("2d").clearRect(0,0,1,1)},Ut=function(e){return e&&(e.horizontal||e.vertical)},Vt=function(e,t,n){if(t<=1&&!Ut(n))return e.width=e.naturalWidth,e.height=e.naturalHeight,e;var r=document.createElement("canvas"),i=e.naturalWidth,o=e.naturalHeight,a=t>=5&&t<=8;a?(r.width=o,r.height=i):(r.width=i,r.height=o);var l=r.getContext("2d");if(t&&l.transform.apply(l,function(e,t,n){return-1===n&&(n=1),kt[n](e,t)}(i,o,t)),Ut(n)){var c=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(c[0]=-1,c[4]=i),(!a&&n.vertical||a&&n.horizontal)&&(c[3]=-1,c[5]=o),l.transform.apply(l,c)}return l.drawImage(e,0,0,i,o),r},Bt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.canvasMemoryLimit,o=r.background,a=void 0===o?null:o,l=n.zoom||1,c=Vt(e,t,n.flip),u={width:c.width,height:c.height},s=n.aspectRatio||u.height/u.width,f=We(u,s,l);if(i){var d=f.width*f.height;if(d>i){var h=Math.sqrt(i)/Math.sqrt(d);u.width=Math.floor(u.width*h),u.height=Math.floor(u.height*h),f=We(u,s,l)}}var p=document.createElement("canvas"),m={x:.5*f.width,y:.5*f.height},g={x:0,y:0,width:f.width,height:f.height,center:m},v=void 0===n.scaleToFit||n.scaleToFit,y=l*Xe(u,Fe(g,s),n.rotation,v?n.center:{x:.5,y:.5});p.width=Math.round(f.width/y),p.height=Math.round(f.height/y),m.x/=y,m.y/=y;var E=m.x-u.width*(n.center?n.center.x:.5),_=m.y-u.height*(n.center?n.center.y:.5),w=p.getContext("2d");a&&(w.fillStyle=a,w.fillRect(0,0,p.width,p.height)),w.translate(m.x,m.y),w.rotate(n.rotation||0),w.drawImage(c,E-m.x,_-m.y,u.width,u.height);var T=w.getImageData(0,0,p.width,p.height);return Dt(p),T};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){var r=this.toDataURL(t,n).split(",")[1];setTimeout(function(){for(var n=atob(r),i=n.length,o=new Uint8Array(i),a=0;a<i;a++)o[a]=n.charCodeAt(a);e(new Blob([o],{type:t||"image/png"}))})}}));var Nt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(r){var i=n?n(e):e;Promise.resolve(i).then(function(e){e.toBlob(r,t.type,t.quality)})})},zt=function(e,t){return Yt(e.x*t,e.y*t)},Ft=function(e,t){return Yt(e.x+t.x,e.y+t.y)},Wt=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return 0===t?{x:0,y:0}:Yt(e.x/t,e.y/t)},qt=function(e,t,n){var r=Math.cos(t),i=Math.sin(t),o=Yt(e.x-n.x,e.y-n.y);return Yt(n.x+r*o.x-i*o.y,n.y+i*o.x+r*o.y)},Yt=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},Ht=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;return"string"==typeof e?parseFloat(e)*n:"number"==typeof e?e*(r?t[r]:Math.min(t.width,t.height)):void 0},jt=function(e,t,n){var r=e.borderStyle||e.lineStyle||"solid",i=e.backgroundColor||e.fontColor||"transparent",o=e.borderColor||e.lineColor||"transparent",a=Ht(e.borderWidth||e.lineWidth,t,n);return{"stroke-linecap":e.lineCap||"round","stroke-linejoin":e.lineJoin||"round","stroke-width":a||0,"stroke-dasharray":"string"==typeof r?"":r.map(function(e){return Ht(e,t,n)}).join(","),stroke:o,fill:i,opacity:e.opacity||1}},Zt=function(e){return null!=e},Xt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=Ht(e.x,t,n,"width")||Ht(e.left,t,n,"width"),i=Ht(e.y,t,n,"height")||Ht(e.top,t,n,"height"),o=Ht(e.width,t,n,"width"),a=Ht(e.height,t,n,"height"),l=Ht(e.right,t,n,"width"),c=Ht(e.bottom,t,n,"height");return Zt(i)||(i=Zt(a)&&Zt(c)?t.height-a-c:c),Zt(r)||(r=Zt(o)&&Zt(l)?t.width-o-l:l),Zt(o)||(o=Zt(r)&&Zt(l)?t.width-r-l:0),Zt(a)||(a=Zt(i)&&Zt(c)?t.height-i-c:0),{x:r||0,y:i||0,width:o||0,height:a||0}},Kt=function(e,t){return Object.keys(t).forEach(function(n){return e.setAttribute(n,t[n])})},Qt=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&Kt(n,t),n},Jt={contain:"xMidYMid meet",cover:"xMidYMid slice"},$t={left:"start",center:"middle",right:"end"},en=function(e){return function(t){return Qt(e,{id:t.id})}},tn={image:function(e){var t=Qt("image",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return t.onload=function(){t.setAttribute("opacity",e.opacity||1)},t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.src),t},rect:en("rect"),ellipse:en("ellipse"),text:en("text"),line:function(e){var t=Qt("g",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=Qt("line");t.appendChild(n);var r=Qt("path");t.appendChild(r);var i=Qt("path");return t.appendChild(i),t}},nn={rect:function(e){return Kt(e,a({},e.rect,e.styles))},ellipse:function(e){var t=e.rect.x+.5*e.rect.width,n=e.rect.y+.5*e.rect.height,r=.5*e.rect.width,i=.5*e.rect.height;return Kt(e,a({cx:t,cy:n,rx:r,ry:i},e.styles))},image:function(e,t){Kt(e,a({},e.rect,e.styles,{preserveAspectRatio:Jt[t.fit]||"none"}))},text:function(e,t,n,r){var i=Ht(t.fontSize,n,r),o=t.fontFamily||"sans-serif",l=t.fontWeight||"normal",c=$t[t.textAlign]||"start";Kt(e,a({},e.rect,e.styles,{"stroke-width":0,"font-weight":l,"font-size":i,"font-family":o,"text-anchor":c})),e.text!==t.text&&(e.text=t.text,e.textContent=t.text.length?t.text:" ")},line:function(e,t,n,r){Kt(e,a({},e.rect,e.styles,{fill:"none"}));var i=e.childNodes[0],o=e.childNodes[1],l=e.childNodes[2],c=e.rect,u={x:e.rect.x+e.rect.width,y:e.rect.y+e.rect.height};if(Kt(i,{x1:c.x,y1:c.y,x2:u.x,y2:u.y}),t.lineDecoration){o.style.display="none",l.style.display="none";var s=Wt({x:u.x-c.x,y:u.y-c.y}),f=Ht(.05,n,r);if(-1!==t.lineDecoration.indexOf("arrow-begin")){var d=zt(s,f),h=Ft(c,d),p=qt(c,2,h),m=qt(c,-2,h);Kt(o,{style:"display:block;",d:"M".concat(p.x,",").concat(p.y," L").concat(c.x,",").concat(c.y," L").concat(m.x,",").concat(m.y)})}if(-1!==t.lineDecoration.indexOf("arrow-end")){var g=zt(s,-f),v=Ft(u,g),y=qt(u,2,v),E=qt(u,-2,v);Kt(l,{style:"display:block;",d:"M".concat(y.x,",").concat(y.y," L").concat(u.x,",").concat(u.y," L").concat(E.x,",").concat(E.y)})}}}},rn=function(e,t){return tn[e](t)},on=function(e,t,n,r,i){e.rect=Xt(n,r,i),e.styles=jt(n,r,i),nn[t](e,n,r,i)},an=function(e,t){return e[1].zIndex>t[1].zIndex?1:e[1].zIndex<t[1].zIndex?-1:0},ln=function(e,t,n,r){return new Promise(function(i){var o=r.background,a=void 0===o?null:o,l=new FileReader;l.onloadend=function(){var e=l.result,r=document.createElement("div");r.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",r.innerHTML=e;var o=r.querySelector("svg");document.body.appendChild(r);var c=o.getBBox();r.parentNode.removeChild(r);var u=r.querySelector("title"),s=o.getAttribute("viewBox")||"",f=o.getAttribute("width")||"",d=o.getAttribute("height")||"",h=parseFloat(f)||null,p=parseFloat(d)||null,m=(f.match(/[a-z]+/)||[])[0]||"",g=(d.match(/[a-z]+/)||[])[0]||"",v=s.split(" ").map(parseFloat),y=v.length?{x:v[0],y:v[1],width:v[2],height:v[3]}:c,E=null!=h?h:y.width,_=null!=p?p:y.height;o.style.overflow="visible",o.setAttribute("width",E),o.setAttribute("height",_);var w="";if(n&&n.length){var T={width:E,height:_};w=n.sort(an).reduce(function(e,t){var n=rn(t[0],t[1]);return on(n,t[0],t[1],T),n.removeAttribute("id"),1===n.getAttribute("opacity")&&n.removeAttribute("opacity"),e+"\n"+n.outerHTML+"\n"},""),w="\n\n<g>".concat(w.replace(/&nbsp;/g," "),"</g>\n\n")}var x=t.aspectRatio||_/E,R=E,A=R*x,I=void 0===t.scaleToFit||t.scaleToFit,C=Xe({width:E,height:_},Fe({width:R,height:A},x),t.rotation,I?t.center:{x:.5,y:.5}),b=t.zoom*C,O=t.rotation*(180/Math.PI),M={x:.5*R,y:.5*A},S={x:M.x-E*t.center.x,y:M.y-_*t.center.y},L=["rotate(".concat(O," ").concat(M.x," ").concat(M.y,")"),"translate(".concat(M.x," ").concat(M.y,")"),"scale(".concat(b,")"),"translate(".concat(-M.x," ").concat(-M.y,")"),"translate(".concat(S.x," ").concat(S.y,")")],P=["scale(".concat(t.flip.horizontal?-1:1," ").concat(t.flip.vertical?-1:1,")"),"translate(".concat(t.flip.horizontal?-E:0," ").concat(t.flip.vertical?-_:0,")")],G='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(R).concat(m,'" height="').concat(A).concat(g,'" \nviewBox="0 0 ').concat(R," ").concat(A,'" ').concat(a?'style="background:'+a+'" ':"",'\npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>').concat(u?u.textContent:"",'</title>\n<g transform="').concat(L.join(" "),'">\n<g transform="').concat(P.join(" "),'">\n').concat(o.outerHTML).concat(w,"\n</g>\n</g>\n</svg>");i(G)},l.readAsText(e)})},cn=function(e){var t;try{t=new ImageData(e.width,e.height)}catch(n){t=document.createElement("canvas").getContext("2d").createImageData(e.width,e.height)}return t.data.set(e.data),t},un=function(){var e={resize:function(e,t){var r=t.mode,a=void 0===r?"contain":r,l=t.upscale,c=void 0!==l&&l,u=t.width,s=t.height,f=t.matrix;if(f=!f||i(f)?null:f,!u&&!s)return o(e,f);if(null===u?u=s:null===s&&(s=u),"force"!==a){var d=u/e.width,h=s/e.height,p=1;if("cover"===a?p=Math.max(d,h):"contain"===a&&(p=Math.min(d,h)),p>1&&!1===c)return o(e,f);u=e.width*p,s=e.height*p}for(var m=e.width,g=e.height,v=Math.round(u),y=Math.round(s),E=e.data,_=new Uint8ClampedArray(v*y*4),w=m/v,T=g/y,x=Math.ceil(.5*w),R=Math.ceil(.5*T),A=0;A<y;A++)for(var I=0;I<v;I++){for(var C=4*(I+A*v),b=0,O=0,M=0,S=0,L=0,P=0,G=0,k=(A+.5)*T,D=Math.floor(A*T);D<(A+1)*T;D++)for(var U=Math.abs(k-(D+.5))/R,V=(I+.5)*w,B=U*U,N=Math.floor(I*w);N<(I+1)*w;N++){var z=Math.abs(V-(N+.5))/x,F=Math.sqrt(B+z*z);if(F>=-1&&F<=1&&(b=2*F*F*F-3*F*F+1)>0){var W=E[3+(z=4*(N+D*m))];G+=b*W,M+=b,W<255&&(b=b*W/250),S+=b*E[z],L+=b*E[z+1],P+=b*E[z+2],O+=b}}_[C]=S/O,_[C+1]=L/O,_[C+2]=P/O,_[C+3]=G/M,f&&n(C,_,f)}return{data:_,width:v,height:y}},filter:o},t=function(t,n){var r=t.transforms,i=null;if(r.forEach(function(e){"filter"===e.type&&(i=e)}),i){var o=null;r.forEach(function(e){"resize"===e.type&&(o=e)}),o&&(o.data.matrix=i.data,r=r.filter(function(e){return"filter"!==e.type}))}n(function(t,n){return t.forEach(function(t){n=e[t.type](n,t.data)}),n}(r,t.imageData))};function n(e,t,n){for(var r=0,i=0,o=0,a=t[e]/255,l=t[e+1]/255,c=t[e+2]/255,u=t[e+3]/255;r<4;r++)o=255*(a*n[i=5*r]+l*n[i+1]+c*n[i+2]+u*n[i+3]+n[i+4]),t[e+r]=Math.max(0,Math.min(o,255))}self.onmessage=function(e){t(e.data.message,function(t){self.postMessage({id:e.data.id,message:t},[t.data.buffer])})};var r=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function i(e){return self.JSON.stringify(e||[])===r}function o(e,t){if(!t||i(t))return e;for(var n=e.data,r=n.length,o=t[0],a=t[1],l=t[2],c=t[3],u=t[4],s=t[5],f=t[6],d=t[7],h=t[8],p=t[9],m=t[10],g=t[11],v=t[12],y=t[13],E=t[14],_=t[15],w=t[16],T=t[17],x=t[18],R=t[19],A=0,I=0,C=0,b=0,O=0;A<r;A+=4)I=n[A]/255,C=n[A+1]/255,b=n[A+2]/255,O=n[A+3]/255,n[A]=Math.max(0,Math.min(255*(I*o+C*a+b*l+O*c+u),255)),n[A+1]=Math.max(0,Math.min(255*(I*s+C*f+b*d+O*h+p),255)),n[A+2]=Math.max(0,Math.min(255*(I*m+C*g+b*v+O*y+E),255)),n[A+3]=Math.max(0,Math.min(255*(I*_+C*w+b*T+O*x+R),255));return e}},sn=function(e,t){if(1165519206===e.getUint32(t+4,!1)){t+=4;var n=18761===e.getUint16(t+=6,!1);t+=e.getUint32(t+4,n);var r=e.getUint16(t,n);t+=2;for(var i=0;i<r;i++)if(274===e.getUint16(t+12*i,n))return e.setUint16(t+12*i+8,1,n),!0;return!1}},fn=function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){return t(function(e){var t=new DataView(e);if(65496!==t.getUint16(0))return null;for(var n,r,i=2,o=!1;i<t.byteLength&&(n=t.getUint16(i,!1),r=t.getUint16(i+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(o||(o=sn(t,i)),!(i+r>t.byteLength));)i+=r;return e.slice(0,i)}(n.result)||null)},n.readAsArrayBuffer(e.slice(0,262144))})},dn=function(e,t){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var r=new n;return r.append(e),r.getBlob(t)}return new Blob([e],{type:t})},hn=function(e){var t=new Blob(["(",e.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(t),r=new Worker(n),i=[];return{transfer:function(){},post:function(e,t,n){var o=Math.random().toString(36).substr(2,9);i[o]=t,r.onmessage=function(e){var t=i[e.data.id];t&&(t(e.data.message),delete i[e.data.id])},r.postMessage({id:o,message:e},n)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},pn=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(e){n(e)},r.src=e})},mn=function(e,t){return new Promise(function(n){var r={width:e.width,height:e.height},i=e.getContext("2d");(function(e){return e.reduce(function(e,t){return e.then(function(e){return t().then(Array.prototype.concat.bind(e))})},Promise.resolve([]))})(t.sort(an).map(function(e){return function(){return new Promise(function(t){yn[e[0]](i,r,e[1],t)&&t()})}})).then(function(){return n(e)})})},gn=function(e,t){e.beginPath(),e.lineCap=t["stroke-linecap"],e.lineJoin=t["stroke-linejoin"],e.lineWidth=t["stroke-width"],t["stroke-dasharray"].length&&e.setLineDash(t["stroke-dasharray"].split(",")),e.fillStyle=t.fill,e.strokeStyle=t.stroke,e.globalAlpha=t.opacity||1},vn=function(e){e.fill(),e.stroke(),e.globalAlpha=1},yn={rect:function(e,t,n){var r=Xt(n,t),i=jt(n,t);return gn(e,i),e.rect(r.x,r.y,r.width,r.height),vn(e),!0},ellipse:function(e,t,n){var r=Xt(n,t),i=jt(n,t);gn(e,i);var o=r.x,a=r.y,l=r.width,c=r.height,u=l/2*.5522848,s=c/2*.5522848,f=o+l,d=a+c,h=o+l/2,p=a+c/2;return e.moveTo(o,p),e.bezierCurveTo(o,p-s,h-u,a,h,a),e.bezierCurveTo(h+u,a,f,p-s,f,p),e.bezierCurveTo(f,p+s,h+u,d,h,d),e.bezierCurveTo(h-u,d,o,p+s,o,p),vn(e),!0},image:function(e,t,n,r){var i=Xt(n,t),o=jt(n,t);gn(e,o);var a=new Image;a.onload=function(){if("cover"===n.fit){var t=i.width/i.height,o=t>1?a.width:a.height*t,l=t>1?a.width/t:a.height,c=.5*a.width-.5*o,u=.5*a.height-.5*l;e.drawImage(a,c,u,o,l,i.x,i.y,i.width,i.height)}else if("contain"===n.fit){var s=Math.min(i.width/a.width,i.height/a.height),f=s*a.width,d=s*a.height,h=i.x+.5*i.width-.5*f,p=i.y+.5*i.height-.5*d;e.drawImage(a,0,0,a.width,a.height,h,p,f,d)}else e.drawImage(a,0,0,a.width,a.height,i.x,i.y,i.width,i.height);vn(e),r()},a.src=n.src},text:function(e,t,n){var r=Xt(n,t),i=jt(n,t);gn(e,i);var o=Ht(n.fontSize,t),a=n.fontFamily||"sans-serif",l=n.fontWeight||"normal",c=n.textAlign||"left";return e.font="".concat(l," ").concat(o,"px ").concat(a),e.textAlign=c,e.fillText(n.text,r.x,r.y),vn(e),!0},line:function(e,t,n){var r=Xt(n,t),i=jt(n,t);gn(e,i),e.beginPath();var o={x:r.x,y:r.y},a={x:r.x+r.width,y:r.y+r.height};e.moveTo(o.x,o.y),e.lineTo(a.x,a.y);var l=Wt({x:a.x-o.x,y:a.y-o.y}),c=.04*Math.min(t.width,t.height);if(-1!==n.lineDecoration.indexOf("arrow-begin")){var u=zt(l,c),s=Ft(o,u),f=qt(o,2,s),d=qt(o,-2,s);e.moveTo(f.x,f.y),e.lineTo(o.x,o.y),e.lineTo(d.x,d.y)}if(-1!==n.lineDecoration.indexOf("arrow-end")){var h=zt(l,-c),p=Ft(a,h),m=qt(a,2,p),g=qt(a,-2,p);e.moveTo(m.x,m.y),e.lineTo(a.x,a.y),e.lineTo(g.x,g.y)}return vn(e),!0}},En=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t},_n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(t+e).slice(-t.length)},wn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return"".concat(e.getFullYear(),"-").concat(_n(e.getMonth()+1,"00"),"-").concat(_n(e.getDate(),"00"),"_").concat(_n(e.getHours(),"00"),"-").concat(_n(e.getMinutes(),"00"),"-").concat(_n(e.getSeconds(),"00"))},Tn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e("GET_CROP_ASPECT_RATIO"),o={center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null};n?Object.assign(o,n):t.options.crop?Object.assign(o,t.options.crop):o.aspectRatio=i;var a=r.width,l=r.height;if(a&&l)o.aspectRatio=l/a;else if(t.instructions.size){var c=t.instructions.size,u=c.width,s=c.height;u&&s&&(o.aspectRatio=s/u)}return o},xn=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},Rn=function(e){return e.split(".").pop()},An=function(e){if("string"!=typeof e)return"";var t=e.split("/").pop();return/svg/.test(t)?"svg":/zip|compressed/.test(t)?"zip":/plain/.test(t)?"txt":/msword/.test(t)?"doc":/[a-z]+/.test(t)?"jpeg"===t?"jpg":t:""},In={jpeg:"jpg","svg+xml":"svg"},Cn=function(e){return Array.isArray(e)&&20===e.length},bn=["x","y","left","top","right","bottom","width","height"],On=function(e){var t=l(e,2),n=t[0],r=t[1],i=!1!==r.allowSelect,o=!1!==r.allowMove,c=!1!==r.allowResize,u=!1!==r.allowInput,s=!1!==r.allowDestroy,f=void 0===r.allowEdit||r.allowEdit;return(!0===r.allowResize||!0===r.allowMove||!0===r.allowInput||r.allowEdit)&&(i=!0),!1===r.allowMove&&(c=!1),!0===r.allowResize&&(o=!0),[n,a({zIndex:0,id:Math.random().toString(36).substr(2,9)},r,bn.reduce(function(e,t){return e[t]=function(e){return"string"==typeof e&&/%/.test(e)?parseFloat(e)/100:e}(r[t]),e},{}),{isDestroyed:!1,isSelected:!1,isDirty:!0,allowDestroy:s,allowSelect:i,allowMove:o,allowResize:c,allowInput:u,allowEdit:f})]},Mn={contrast:function(e){return[e,0,0,0,.5*(1-e),0,e,0,0,.5*(1-e),0,0,e,0,.5*(1-e),0,0,0,1,0]},exposure:function(e){return[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0]},brightness:function(e){return[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0]},saturation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return[.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715+.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,0,1,0]}},Sn=Math.PI/2,Ln=function(e){var t={upscale:e("GET_OUTPUT_UPSCALE"),mode:e("GET_OUTPUT_FIT"),width:e("GET_OUTPUT_WIDTH"),height:e("GET_OUTPUT_HEIGHT")},n=e("GET_SIZE_INPUT");if(e("ALLOW_MANUAL_RESIZE")&&(n.width||n.height)){var r=n.width,i=n.height,o=e("GET_CROP_RECTANGLE_ASPECT_RATIO");r&&!i?i=r/o:i&&!r&&(r=i*o),t.width=r,t.height=i,t.upscale=!0,t.mode="force"}return t},Pn=function(e,t){var n=t("GET_UID"),r=t("GET_CROP",n,Date.now()),i={width:r.cropStatus.currentWidth,height:r.cropStatus.currentHeight},o=e.mode,a=e.width,l=e.height,c=e.upscale;if(!a&&!l)return i;if(null===a?a=l:null===l&&(l=a),"force"!==o){var u=a/i.width,s=l/i.height,f=1;if("cover"===o?f=Math.max(u,s):"contain"===o&&(f=Math.min(u,s)),f>1&&!1===c)return i;a=i.width*f,l=i.height*f}return{width:Math.round(a),height:Math.round(l)}},Gn=function(e){return e.markup.filter(function(e){return!e[1].isDestroyed})},kn=function(e,t,n){return new Promise(function(r,i){var o={data:null,file:null},l=et(t.image,t.crop),c=Ln(n),u={crop:l,image:a({},Pn(c,n),{orientation:t.file.orientation}),size:c,output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY"),background:t.options.outputCanvasBackgroundColor},filter:t.colorMatrices.filter?{id:t.filterName,value:t.filterValue,matrix:t.colorMatrices.filter}:null,color:Object.keys(t.colorValues).length?Object.keys(t.colorValues).reduce(function(e,n){return e[n]={value:t.colorValues[n],matrix:t.colorMatrices[n].map(function(e){return Re(e,5)})},e},{}):null,markup:Gn(t).map(function(e){return[e[0],a({},e[1])]}),colorMatrix:n("GET_COLOR_MATRIX")};if(e.data&&(o.data=u),e.file){var s={beforeCreateBlob:n("GET_BEFORE_CREATE_BLOB"),afterCreateBlob:n("GET_AFTER_CREATE_BLOB"),stripImageHead:n("GET_OUTPUT_STRIP_IMAGE_HEAD"),canvasMemoryLimit:n("GET_OUTPUT_CANVAS_MEMORY_LIMIT")},f=t.file.data,d=a({},u,{filter:u.colorMatrix,markup:u.markup});(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,i){if(!e||!Gt(e))return i({status:"not an image file",file:e});var o=n.stripImageHead,a=n.beforeCreateBlob,l=n.afterCreateBlob,c=n.canvasMemoryLimit,u=t.crop,s=t.size,f=t.filter,d=t.markup,h=t.output,p=t.image&&t.image.orientation?Math.max(1,Math.min(8,t.image.orientation)):null,m=h&&h.quality,g=null===m?null:m/100,v=h&&h.type||null,y=h&&h.background||null,E=[];!s||"number"!=typeof s.width&&"number"!=typeof s.height||E.push({type:"resize",data:s}),f&&20===f.length&&E.push({type:"filter",data:f});var _=function(e){var t=l?l(e):e;Promise.resolve(t).then(r)},w=function(e,t){var n=En(e),r=d.length?mn(n,d):n;Promise.resolve(r).then(function(e){Nt(e,t,a).then(function(t){if(Dt(e),o)return _(t);fn(t).then(function(e){null!==e&&(t=new Blob([e,t.slice(20)],{type:t.type})),_(t)})}).catch(i)})};if(/svg/.test(e.type)&&null===v)return ln(e,u,d,{background:y}).then(function(e){r(dn(e,"image/svg+xml"))});var T=URL.createObjectURL(e);pn(T).then(function(t){URL.revokeObjectURL(T);var n=Bt(t,p,u,{canvasMemoryLimit:c,background:y}),r={quality:g,type:v||e.type};if(!E.length)return w(n,r);var i=hn(un);i.post({transforms:E,imageData:n},function(e){w(cn(e),r),i.terminate()},[n.data.buffer])}).catch(i)})})(f,d,s).then(function(e){o.file=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i="string"==typeof n?e.slice(0,e.size,n):e.slice(0,e.size,e.type);return i.lastModifiedDate=new Date,Y(t)||(t=wn()),t&&null===r&&Rn(t)?i.name=t:(r=r||An(i.type),i.name=t+(r?"."+r:"")),i}(e,function(e,t){var n=function(e){return e.substr(0,e.lastIndexOf("."))||e}(e),r=t.split("/")[1],i=In[r]||r;return"".concat(n,".").concat(i)}(f.name,function(e){return/jpeg|png|svg\+xml/.test(e)?e:"image/jpeg"}(e.type))),r(o)}).catch(i)}else r(o)})},Dn=function(e){e.crop.draft.rotateMinScale=null},Un=function(e){e.crop.draft.rotateMinScale||(e.crop.draft.rotateMinScale=e.crop.transforms.scale)},Vn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];Un(e);var o=a({},e.crop.transforms,{scale:e.crop.draft.rotateMinScale});e.crop.draft.transforms=jn(e.image,e.crop.rectangle,o,t.main+t.sub,n,e.crop.draft.transforms?e.crop.draft.transforms.rotation:e.crop.rotation.main+e.crop.rotation.sub,r,i),e.crop.rotation=St(e.crop.draft.transforms.rotation)},Bn=function(e,t,n){if(null!==e.stage){qn(e),e.size.width=!!e.instructions.size&&e.instructions.size.width,e.size.height=!!e.instructions.size&&e.instructions.size.height,e.size.aspectRatioLocked=!0,e.size.aspectRatioPrevious=!1,e.crop.rectangle=Fe(e.stage,e.instructions.crop.aspectRatio||e.image.aspectRatio),e.crop.draft.rectangle=null;var r=void 0===e.instructions.crop.scaleToFit?void 0===e.crop.limitToImageBounds?e.options.cropLimitToImageBounds:e.crop.limitToImageBounds:e.instructions.crop.scaleToFit;e.crop.transforms=wt(e.instructions.crop,e.stage,e.image,r),e.crop.draft.transforms=null,e.crop.rotation=St(e.instructions.crop.rotation),e.crop.flip=a({},e.instructions.crop.flip);var i=t("GET_CROP_ASPECT_RATIO_OPTIONS")||[],o=i.map(function(e){return e.value.aspectRatio}).find(function(t){return t===e.instructions.crop.aspectRatio}),l=i.find(function(e){return null===e.value.aspectRatio});o?e.crop.aspectRatio=o:l&&i.length?e.crop.aspectRatio=null:e.crop.aspectRatio=t("GET_CROP_ASPECT_RATIO"),e.crop.isDirty=!1,e.instructions.markup&&n("MARKUP_SET_VALUE",{value:e.instructions.markup.map(On).sort(an)}),n("CROP_SET_LIMIT",{value:r,silent:!0}),Object.keys(e.instructions.color).forEach(function(t){return n("COLOR_SET_VALUE",{key:t,value:e.instructions.color[t]})}),n("FILTER_SET_VALUE",{value:e.instructions.filter}),Dn(e)}},Nn=function(e,t){if(e.stage){qn(e);var n=e.crop.rectangle,r=n.height/n.width,i=e.crop.aspectRatio;if(null!==i&&Re(r,3)!==i){var o=t("GET_MIN_CROP_SIZE");o.width=Re(o.width),o.height=Re(o.height);var l=Math.min(n.width,n.height);Math.min(l*i,l/i)<Math.max(o.width,o.height)&&(e.crop.rectangle=function(e,t,n){var r=ke(e);return r.width=Math.min(r.height,r.width),r.height=r.width,r.height=r.width*t,r.height<n.height&&(r.height=n.height,r.width=r.height/t),r.width<n.width&&(r.width=n.width,r.height=r.width*t),r}(a({},e.crop.rectangle),i,o),e.crop.draft.transforms=It(e.image,e.crop.rectangle,e.crop.transforms))}var c=e.crop.draft.transforms||e.crop.transforms,u=$e(e.image,e.crop.rectangle,c,e.crop.limitToImageBounds);e.crop.aspectRatio&&(u.aspectRatio=e.crop.aspectRatio),e.crop.transforms=wt(u,e.stage,e.image,u.scaleToFit),e.crop.draft.transforms=null;var s=e.crop.aspectRatio||e.crop.rectangle.height/e.crop.rectangle.width;e.crop.rectangle=Fe(e.stage,s),e.crop.draft.rectangle=null,Dn(e)}},zn=function(e){e.crop.draft.rectangle=null,e.crop.transforms=e.crop.draft.transforms||e.crop.transforms,e.crop.transforms.interaction=null,e.crop.draft.transforms=null,e.crop.transforms=a({},e.crop.transforms,function(e,t,n){var r=n.origin,i=n.translation,o=n.scale,a=2*Math.PI+n.rotation%(2*Math.PI),l={x:r.x+i.x,y:r.y+i.y},c=Je(t,a),u=Me(c.tl,-a,l),s=Me(c.tr,-a,l),f=Me(c.br,-a,l),d=Me(c.bl,-a,l),h=Ne(Math.min(u.x,s.x,f.x,d.x),Math.min(u.y,s.y,f.y,d.y),Math.max(u.x,s.x,f.x,d.x)-Math.min(u.x,s.x,f.x,d.x),Math.max(u.y,s.y,f.y,d.y)-Math.min(u.y,s.y,f.y,d.y)),p=Ne(h.x,h.y,h.width,h.height),m=Ke(e,n),g=Be(m),v=Ve(m),y=Me(g.tl,a,l),E=Me(g.br,a,l),_=y.x+.5*(E.x-y.x),w=y.y+.5*(E.y-y.y),T=Pe(m,{x:_-v.x,y:w-v.y}),x=Pe(p,{x:_-v.x,y:w-v.y}),R=Ve(x),A={x:T.x,y:T.y},I=T.width,C=T.height,b=(R.x-A.x)/I,O=(R.y-A.y)/C,M={x:b*e.width,y:O*e.height},S=1-o,L=M.x*S,P=M.y*S,G={x:A.x+I*b,y:A.y+C*O},k=Me(A,a,{x:A.x+.5*I,y:A.y+.5*C}),D=Me(A,a,G),U=k.x-D.x,V=k.y-D.y;return{origin:Ae(M),translation:Ae({x:A.x-L+U,y:A.y-P+V})}}(e.image,e.crop.rectangle,e.crop.transforms)),e.crop.isRotating=!1,e.crop.isDirty=!0},Fn=function(e,t,n){var r=t("GET_CROP_ZOOM_TIMEOUT");r&&(clearTimeout(e.zoomTimeoutId),e.zoomTimeoutId=setTimeout(function(){n("CROP_ZOOM")},r))},Wn=function(e,t,n){qn(e),Fn(e,t,n)},qn=function(e){clearTimeout(e.zoomTimeoutId)},Yn=function(e){e.crop.draft.transforms=Tt(e.crop.transforms),e.crop.draft.rectangle={limited:ke(e.crop.rectangle),free:ke(e.crop.rectangle)},qn(e)},Hn=function(e,t){return Math.min(e.width/t.width,e.height/t.height)},jn=function(e,t,n,r,i,o,l,c){var u=a({},Tt(n),{rotation:r}),s=c?xt(e,t,u,"rotating"):u,f=Hn(t,i);return Re(s.scale,5)>Re(f,5)?(l&&(o+=2*l),a({},Tt(n),{rotation:o,interaction:{rotation:s.rotation}})):(s.scale=Math.min(f,s.scale),s.interaction={rotation:s.rotation},s)},Zn=function(e,t,n,r,i,o){var l=Math.max(1e-10,r),c=a({},Tt(n),{scale:l}),u=o?xt(e,t,c,"resizing"):c,s=Hn(t,i);return u.scale=Math.min(s,u.scale),u.interaction={scale:l},u},Xn=function(e){return!1===e.file},Kn=function(e,t,n){return a({SET_UID:function(e){var t=e.id;n.uid=t},AWAIT_IMAGE:function(){n.file||(n.noImageTimeout=setTimeout(function(){e("AWAITING_IMAGE")},250))},REQUEST_REMOVE_IMAGE:function(){e("UNLOAD_IMAGE"),n.file=!1,n.noImageTimeout=setTimeout(function(){e("AWAITING_IMAGE")},500)},DID_UNLOAD_IMAGE:function(){e("ABORT_IMAGE")},REQUEST_ABORT_IMAGE:function(t){e("UNLOAD_IMAGE"),n.file=!1,n.queuedFile=t},DID_SET_SRC:function(t){t.value!==t.prevValue&&(clearTimeout(n.noImageTimeout),e("REQUEST_LOAD_IMAGE",{source:t.value}))},ABORT_IMAGE:function(){if(n.file=null,n.queuedFile){var t=n.queuedFile;n.queuedFile=null,e("REQUEST_LOAD_IMAGE",t)}},REQUEST_LOAD_IMAGE:function(t){var r=t.source,i=t.success,o=void 0===i?function(){}:i,a=t.failure,l=void 0===a?function(e){}:a,c=t.options,u=t.resolveOnConfirm,s=void 0!==u&&u;if(clearTimeout(n.noImageTimeout),!r)return l("no-image-source");null===n.file?(ee(n),n.file={uid:ae()},e("DID_REQUEST_LOAD_IMAGE",{source:r}),function(e){return new Promise(function(t,n){if(Y(e)){var r=null;fetch(e).then(function(e){if(e.headers&&(r=e.headers.get("Content-Type")),e.ok)return e.blob();n(e)}).then(function(i){if(!i)return n(e);!i.type.length&&r&&(i=i.slice(0,i.size,r)),t(i)}).catch(n)}else if(e instanceof Blob)t(e);else{if("IMG"===e.nodeName){var i=function(e){var n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight,n.getContext("2d").drawImage(e,0,0),n.toBlob(t)};return e.complete?void i(e):void(e.onload=function(){return i(e)})}"CANVAS"!==e.nodeName?n(e):e.toBlob(t)}})}(r).then(function(t){if(Xn(n))return e("ABORT_IMAGE");t.name||(t.name=wn()),n.file.orientation=-1,n.file.data=t,e("LOAD_IMAGE",{success:o,failure:l,options:c,resolveOnConfirm:s},!0),e("KICK")}).catch(function(t){if(Xn(n))return e("ABORT_IMAGE");e("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_LOAD_ERROR",data:t}}),l(t)})):e("REQUEST_ABORT_IMAGE",{source:r,success:o,failure:l,options:c,resolveOnConfirm:s})},LOAD_IMAGE:function(r){var i=r.success,o=r.failure,c=r.options,u=void 0===c?{}:c,s=r.resolveOnConfirm;if(Xn(n))return e("ABORT_IMAGE");var f=n.file.data;Promise.all([Lt(f),yt(f)]).then(function(r){var c=l(r,2),f=c[0],d=c[1];if(Xn(n))return e("ABORT_IMAGE");if(n.file.orientation=t("GET_OUTPUT_CORRECT_IMAGE_EXIF_ORIENTATION")?d:-1,n.file.orientation>-1){var h=f.width,p=f.height;d>=5&&d<=8&&(f.width=p,f.height=h)}var m=t("GET_MIN_IMAGE_SIZE");if(f.width<m.width||f.height<m.height)return e("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_MIN_SIZE_VALIDATION_ERROR",data:{size:f,minImageSize:m}}}),ee(n),void o();var g=Pt(f,{width:t("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:t("GET_MAX_IMAGE_PREVIEW_HEIGHT")});if(n.image={x:0,y:0,width:g.width,height:g.height,naturalWidth:f.width,naturalHeight:f.height,aspectRatio:f.height/f.width},t("ALLOW_MANUAL_RESIZE")&&u.size&&(n.size.width=u.size.width,n.size.height=u.size.height,n.size.aspectRatioLocked=!0,n.size.aspectRatioPrevious=!1,n.instructions.size={width:u.size.width,height:u.size.height}),n.instructions.crop=Tn(t,n,u.crop?a({},u.crop):null,n.size),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,!1===n.instructions.crop.scaleToFit&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),void 0===u.filter)n.instructions.filter=n.options.filter;else{var v=u.filter;n.instructions.filter=null===v?v:v.id||v.matrix||v}var y=n.options.markup||[];n.instructions.markup=y.concat(u.markup||[]),n.instructions.color=Object.keys(Mn).reduce(function(e,t){return e[t]=u.color&&void 0!==u.color[t]?"number"==typeof u.color[t]?u.color[t]:u.color[t].value:n.options["color".concat(xn(t))],e},{}),e("DID_LOAD_IMAGE",{image:a({size:n.file.data.size,name:n.file.data.name,type:n.file.data.type,orientation:d},f)}),n.filePromise={resolveOnConfirm:s,success:i,failure:o}}).catch(function(t){if(Xn(n))return e("ABORT_IMAGE");e("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_UNKNOWN_ERROR",data:t}}),ee(n),o()})},CHANGE_VIEW:function(t){var r=t.id;n.activeView=r,e("SHOW_VIEW",{id:r})},UPDATE_ROOT_RECT:function(e){var t=e.rect;n.rootRect=t},DID_RESIZE_STAGE:function(r){var i=r.size,o=r.offset,a=r.animate,l=null===n.stage;if(n.stage=Ne(0,0,i.width,i.height),n.stageOffset=Se(o.x,o.y),!t("GET_ALLOW_PREVIEW_FIT_TO_VIEW")){var c=Math.min(i.width,n.image.naturalWidth),u=Math.min(i.height,n.image.naturalHeight);n.stage=Ne(0,0,c,u),n.stageOffset=Se(o.x+.5*i.width-.5*c,o.y+.5*i.height-.5*u)}if(l){if(Bn(n,t,e),!n.filePromise.resolveOnConfirm){var s=et(n.image,n.crop),f=Ln(t);n.filePromise.success({crop:s,image:{orientation:n.file.orientation},size:f,output:{type:t("GET_OUTPUT_TYPE"),quality:t("GET_OUTPUT_QUALITY")}})}}else n.instantUpdate=!a,Nn(n,t),setTimeout(function(){n.instantUpdate=!1},16)},RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK:function(e){var t=e.value;n.size.aspectRatioLocked=t},RESIZE_SET_OUTPUT_SIZE:function(r){var i=r.width,o=r.height,a=nt({width:i=i||null,height:o=o||null},t("GET_SIZE_MIN"),t("GET_SIZE_MAX"),t("GET_CROP_RECTANGLE_ASPECT_RATIO"));if(n.size.width=a.width?Math.round(a.width):null,n.size.height=a.height?Math.round(a.height):null,i&&o){var l=o/i;if(l===n.crop.aspectRatio)return;!1===n.size.aspectRatioPrevious&&(n.size.aspectRatioPrevious=n.crop.aspectRatio),e("CROP_SET_ASPECT_RATIO",{value:l})}else!1!==n.size.aspectRatioPrevious&&(e("CROP_SET_ASPECT_RATIO",{value:n.size.aspectRatioPrevious}),n.size.aspectRatioPrevious=!1)},CROP_SET_ASPECT_RATIO:function(e){var r=e.value;if(qn(n),n.crop.aspectRatio=r,n.crop.aspectRatio&&Nn(n,t),n.crop.isDirty=!0,n.size.width&&n.size.height)if(n.crop.aspectRatio){var i=n.size.width*n.crop.aspectRatio,o=xe(i,t("GET_SIZE_MIN").height,t("GET_SIZE_MAX").height);n.size.height=o,n.size.width=o/n.crop.aspectRatio}else n.size.height=null},DID_SET_CROP_ASPECT_RATIO:function(t){var n=t.value,r=t.prevValue;ze(n)!==ze(r)&&e("CROP_SET_ASPECT_RATIO",{value:n})},CROP_ZOOM:function(){n.stage&&(qn(n),Nn(n,t))},DID_SET_CROP_LIMIT_TO_IMAGE_BOUNDS:function(t){var r=t.value,i=t.prevValue;n.crop.limitToImageBounds=r,!1===i&&r&&e("CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS")},CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS:function(){var e=n.stage,r=n.image,i=n.crop.rectangle.height/n.crop.rectangle.width,o=Fe(e,i);n.crop.rectangle=o,n.crop.transforms=xt(r,n.crop.rectangle,n.crop.transforms,"moving"),n.crop.transforms=xt(r,n.crop.rectangle,n.crop.transforms,"resizing"),n.crop.transforms=xt(r,n.crop.rectangle,n.crop.transforms,"rotating"),n.crop.draft.rectangle=null,n.crop.draft.transforms=null,Nn(n,t)},CROP_SET_LIMIT:function(t){var r=t.value,i=t.silent,o=void 0!==i&&i,a=n.crop.limitToImageBounds!==r;n.crop.limitToImageBounds=r,a&&!o&&(n.crop.isDirty=!0),a&&r&&e("CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS")},CROP_IMAGE_RESIZE_GRAB:function(){Yn(n),qn(n)},CROP_IMAGE_ROTATE_GRAB:function(){Yn(n),qn(n),n.crop.isRotating=!0},CROP_RECT_DRAG_GRAB:function(){Yn(n),qn(n)},CROP_RECT_DRAG_RELEASE:function(){(function(e){e.crop.rectangle=e.crop.draft.rectangle.limited,e.crop.draft.rectangle=null,zn(e),Dn(e)})(n),Fn(n,t,e)},CROP_RECT_EDGE_DRAG:function(e){var r=e.offset,i=e.origin,o=e.anchor,a=n.image,l=n.stage,c=/n|s/.test(i)?_t:Et,u=At(i,n.crop.rectangle),s=At(o,n.crop.rectangle),f=Oe({x:u.x+(c===Et?r.x:0),y:u.y+(c===_t?r.y:0)},l),d=t("GET_MIN_CROP_SIZE"),h=t("GET_MAX_CROP_SIZE");d.width=Re(d.width),d.height=Re(d.height);var p=Hn(n.crop.rectangle,t("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);h.width=Re(h.width*p),h.height=Re(h.height*p);var m={x:Math.sign(u.x-s.x),y:Math.sign(u.y-s.y)};n.crop.draft.rectangle=function(e,t,n,r,i,o,a,l,c){var u=o.left,s=o.right,f=o.top,d=o.bottom,h=s-u,p=d-f,m=i.left,g=i.right,v=i.top,y=i.bottom;if(n===_t){if(v=e.y>0?r.y:Math.min(r.y,Math.max(t.y,f)),y=e.y>0?Math.max(r.y,Math.min(t.y,d)):r.y,a){var E=(y-v)/a;m=r.x-.5*E,g=r.x+.5*E}}else if(m=e.x>0?r.x:Math.min(r.x,Math.max(t.x,u)),g=e.x>0?Math.max(r.x,Math.min(t.x,s)):r.x,a){var _=(g-m)*a;v=r.y-.5*_,y=r.y+.5*_}var w,T,x,R,A=l.width,I=l.height;if(n===_t?(w=r.x-.5*A,T=r.x+.5*A,e.y<0?(x=r.y-I,R=r.y):e.y>0&&(x=r.y,R=r.y+I)):(x=r.y-.5*I,R=r.y+.5*I,e.x<0?(w=r.x-A,T=r.x):e.x>0&&(w=r.x,T=r.x+A)),a)if(n===_t){var C=Math.min((y-v)/a,h),b=C*a;m<u&&(g=(m=u)+C),g>s&&(m=(g=s)-C),r.x=m+.5*C,e.y<0?v=r.y-b:e.y>0&&(y=r.y+b)}else{var O=Math.min((g-m)*a,p),M=O/a;v<f&&(y=(v=f)+O),y>d&&(v=(y=d)-O),r.y=v+.5*O,e.x<0?m=r.x-M:e.x>0&&(g=r.x+M)}var S=Ue({top:v,right:g,bottom:y,left:m}),L=function(){var t=A*a;n===Et?(v=r.y-.5*t,y=r.y+.5*t):e.y<0?(y=r.y,v=y-t):e.y>0&&(v=r.y,y=v+t)},P=function(){var t=I/a;n===_t?(m=r.x-.5*t,g=r.x+.5*t):e.x<0?(g=r.x,m=g-t):e.x>0&&(m=r.x,g=m+t)};g<T&&(g=T,m=T-A,a&&L()),m>w&&(m=w,g=w+A,a&&L()),v>x&&(v=x,y=x+I,a&&P()),y<R&&(y=R,v=R-I,a&&P());var G=c.width,k=c.height;if(a&&(a<1?G=k/a:k=G*a),g-m>G&&(e.x<0?m=r.x-G:g=r.x+G),y-v>k&&(e.y<0?v=r.y-k:y=r.y+k),g-m==0&&(e.x>0?g=r.x+2:m=r.x-2),y-v==0&&(e.y>0?y=r.y+2:v=r.y-2),Math.round(m)<u||Math.round(g)>s||Math.round(v)<f||Math.round(y)>d){var D=d-f,U=s-u;if(m<u){m=u;var V=Math.min(g-m,U);g=m+V}if(g>s){g=s;var B=Math.min(g-m,U);m=g-B}if(v<f){v=f;var N=Math.min(y-v,D);y=v+N}if(y>d){y=d;var z=Math.min(y-v,D);v=y-z}S=Ue({top:v,right:g,bottom:y,left:m})}return{free:S,limited:Ue({top:v,right:g,bottom:y,left:m})}}(m,f,c,s,De(n.crop.rectangle),De(l),n.crop.aspectRatio,d,h),n.crop.limitToImageBounds&&(n.crop.draft.transforms=It(a,n.crop.draft.rectangle.limited,n.crop.transforms))},CROP_RECT_CORNER_DRAG:function(e){var r=e.offset,i=e.origin,o=e.anchor,a=n.image,l=n.stage,c=bt(i,n.crop.rectangle),u=bt(o,n.crop.rectangle),s={x:c.x+r.x,y:c.y+r.y},f=t("GET_MIN_CROP_SIZE"),d=t("GET_MAX_CROP_SIZE");f.width=Re(f.width),f.height=Re(f.height);var h=Hn(n.crop.rectangle,t("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);d.width=Re(d.width*h),d.height=Re(d.height*h);var p={x:Math.sign(c.x-u.x),y:Math.sign(c.y-u.y)};n.crop.draft.rectangle=function(e,t,n,r,i,o,a){var l=De(r),c=l.left,u=l.right,s=l.top,f=l.bottom,d=Oe({x:t.x,y:t.y},r),h=e.x>0?n.x:Math.min(d.x,n.x),p=e.x>0?Math.max(n.x,d.x):n.x,m=e.y>0?n.y:Math.min(d.y,n.y),g=e.y>0?Math.max(n.y,d.y):n.y;if(i){var v=d.x-n.x;e.x>0?p=Math.max(n.x,n.x+e.x*v):h=Math.min(n.x,n.x-e.x*v),e.y>0?g=Math.max(n.y,n.y+e.x*v*i):m=Math.min(n.y,n.y-e.x*v*i)}var y=Ue({top:m,right:p,bottom:g,left:h});if(Ue({top:m,right:p,bottom:g,left:h}),o.width&&o.height){var E=o.width,_=o.height;i&&(1===i?_=E=Math.max(E,_):E<_?E=_/i:E>_?_=E*i:E=_/i),p-h<E&&(e.x>0?p=n.x+E:h=n.x-E),g-m<_&&(e.y>0?g=n.y+_:m=n.y-_);var w=a.width,T=a.height;i&&(i<1?w=T/i:T=w*i),p-h>w&&(e.x<0?h=n.x-w:p=n.x+w),g-m>T&&(e.y<0?m=n.y-T:g=n.y+T)}if(p-h==0&&(e.x>0?p=n.x+2:h=n.x-2),g-m==0&&(e.y>0?g=n.y+2:m=n.y-2),Math.round(h)<c||Math.round(p)>u||Math.round(m)<s||Math.round(g)>f){var x=f-s,R=u-c;if(h<c){h=c;var A=Math.min(p-h,R);p=h+A,i&&(e.y>0&&(g=n.y+A*i),e.y<0&&(m=n.y-A*i))}if(p>u){p=u;var I=Math.min(p-h,R);h=p-I,i&&(e.y>0&&(g=n.y+I*i),e.y<0&&(m=n.y-I*i))}if(m<s){m=s;var C=Math.min(g-m,x);g=m+C,i&&(e.x>0&&(p=n.x+C/i),e.x<0&&(h=n.x-C/i))}if(g>f){g=f;var b=Math.min(g-m,x);m=g-b,i&&(e.x>0&&(p=n.x+b/i),e.x<0&&(h=n.x-b/i))}y=Ue({top:m,right:p,bottom:g,left:h})}return{free:y,limited:Ue({top:m,right:p,bottom:g,left:h})}}(p,s,u,l,n.crop.aspectRatio,f,d),n.crop.limitToImageBounds&&(n.crop.draft.transforms=It(a,n.crop.draft.rectangle.limited,n.crop.transforms))},CROP_IMAGE_DRAG_GRAB:function(){return Yn(n)||qn(n)},CROP_IMAGE_DRAG_RELEASE:function(){zn(n),Dn(n),Fn(n,t,e)},CROP_IMAGE_ROTATE_RELEASE:function(){zn(n),Fn(n,t,e)},CROP_IMAGE_DRAG:function(e){var t=e.value;qn(n),n.crop.draft.transforms=function(e,t,n,r,i){var o={x:n.translation.x+r.x,y:n.translation.y+r.y},l=a({},Tt(n),{translation:o}),c=i?xt(e,t,l,"moving"):l;return c.interaction={translation:o},c}(n.image,n.crop.rectangle,n.crop.transforms,t,n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_RELEASE:function(){t("GET_CROP_RESIZE_MATCH_IMAGE_ASPECT_RATIO")&&function(e){if(e.crop.draft.targetSize>=e.crop.draft.transforms.scale)return!1;if(null!==e.crop.aspectRatio)return!1;if(!1===e.crop.limitToImageBounds)return!1;if(0!==Re(e.crop.rotation.sub,5))return!1;var t=Re(e.crop.rotation.main/Sn,5)%2!=0?e.image.width/e.image.height:e.image.height/e.image.width,n=e.crop.rectangle.height/e.crop.rectangle.width;if(t===n)return!1;var r=Fe(e.stage,n);!!Le(r,e.crop.rectangle)&&(e.crop.rectangle=Fe(e.stage,t))}(n),zn(n),Dn(n),Fn(n,t,e)},CROP_IMAGE_RESIZE:function(e){var r=e.value;qn(n);var i=n.crop.transforms;n.crop.draft.targetSize=i.scale+i.scale*r,n.crop.draft.transforms=Zn(n.image,n.crop.rectangle,i,n.crop.draft.targetSize,t("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_MULTIPLY:function(e){var r=e.value;qn(n);var i=n.crop.transforms;n.crop.draft.targetSize=i.scale*r,n.crop.draft.transforms=Zn(n.image,n.crop.rectangle,i,n.crop.draft.targetSize,t("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_AMOUNT:function(e){var r=e.value;qn(n);var i=n.crop.transforms;n.crop.draft.targetSize=(n.crop.draft.transforms?n.crop.draft.transforms.scale:i.scale)+r,n.crop.draft.transforms=Zn(n.image,n.crop.rectangle,i,n.crop.draft.targetSize,t("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_ROTATE:function(e){var r=e.value;qn(n),n.crop.isRotating=!0,Vn(n,{main:n.crop.rotation.main,sub:r},t("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds)},CROP_IMAGE_ROTATE_ADJUST:function(e){var r=e.value;qn(n),Vn(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+r))},t("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds),zn(n)},CROP_IMAGE_ROTATE_CENTER:function(){qn(n),Vn(n,{main:n.crop.rotation.main,sub:0},t("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds),zn(n)},CROP_IMAGE_ROTATE_LEFT:function(){Wn(n,t,e),Vn(n,{main:n.crop.rotation.main-Sn,sub:n.crop.rotation.sub},t("GET_MIN_PREVIEW_IMAGE_SIZE"),-Sn,n.crop.limitToImageBounds),zn(n),t("GET_CROP_FORCE_LETTERBOX")&&e("CROP_UPDATE_LETTERBOX")},CROP_IMAGE_ROTATE_RIGHT:function(){Wn(n,t,e),Vn(n,{main:n.crop.rotation.main+Sn,sub:n.crop.rotation.sub},t("GET_MIN_PREVIEW_IMAGE_SIZE"),Sn,n.crop.limitToImageBounds),zn(n),t("GET_CROP_FORCE_LETTERBOX")&&e("CROP_UPDATE_LETTERBOX")},CROP_IMAGE_FLIP_HORIZONTAL:function(){Wn(n,t,e),0===Re(n.crop.rotation.main%Math.PI/2,5)?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){Wn(n,t,e),0===Re(n.crop.rotation.main%Math.PI/2,5)?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},DID_RECEIVE_IMAGE_DATA:function(e){var t=e.previewData,r=e.thumbData;n.file.preview=t,n.file.thumb=r},MARKUP_SET_VALUE:function(e){var t=e.value;n.markup=t},MARKUP_ADD:function(t){n.markup.forEach(function(e){return e[1].isSelected=!1}),n.markup=n.markup.filter(function(e){return!e[1].isDestroyed});var r=On(t);n.markup.push(r),n.markup.sort(an),e("MARKUP_SELECT",{id:r[1].id}),n.crop.isDirty=!0},MARKUP_SELECT:function(e){var t=e.id;n.markup.forEach(function(e){e[1].isSelected=e[1].id===t,e[1].isDirty=!0})},MARKUP_ELEMENT_DRAG:function(e){var t=e.id,r=e.origin,i=e.offset,o=e.size,a=n.markup.find(function(e){return e[1].id===t});if(a){var l=a[1],c=r.x/o.width,u=r.y/o.height,s=r.width/o.width,f=r.height/o.height,d=i.x/o.width,h=i.y/o.height;l.x=c+d,l.y=u+h,l.width=s,l.height=f,l.left=void 0,l.top=void 0,l.right=void 0,l.bottom=void 0,l.isDirty=!0,n.crop.isDirty=!0}},MARKUP_ELEMENT_RESIZE:function(e){var t=e.id,r=e.corner,i=e.origin,o=e.offset,a=e.size,c=n.markup.find(function(e){return e[1].id===t});if(c){var u=l(c,2),s=u[0],f=u[1],d=(i.x+o.x)/a.width,h=(i.y+o.y)/a.height;if(/n/.test(r))if("line"===s)f.height=f.height-(h-f.y),f.y=h;else{var p=f.y+f.height;h>p&&(h=p),f.height=f.height-(h-f.y),f.y=h}if(/w/.test(r))if("line"===s)f.width=f.width-(d-f.x),f.x=d;else{var m=f.x+f.width;d>m&&(d=m),f.width=f.width-(d-f.x),f.x=d}/s/.test(r)&&(f.height="line"===s?h-f.y:Math.max(0,h-f.y)),/e/.test(r)&&(f.width="line"===s?d-f.x:Math.max(0,d-f.x)),f.left=void 0,f.top=void 0,f.right=void 0,f.bottom=void 0,f.isDirty=!0,n.crop.isDirty=!0}},MARKUP_DELETE:function(t){var r=t.id,i=n.markup.find(function(e){return e[1].id===r});if(i){var o=i[1];o.allowDestroy&&(o.isDestroyed=!0,o.isSelected=!1,o.isDirty=!0);for(var a=null,l=n.markup.length;l>0;){l--;var c=n.markup[l][1];if(!c.isDestroyed&&c.allowDestroy){a=c.id;break}}e("MARKUP_SELECT",{id:a})}},MARKUP_UPDATE:function(e){var t=e.id,r=e.props,i=n.markup.find(function(e){return e[1].id===t});if(i){var o=i[1];Object.keys(r).forEach(function(e){o[e]=r[e]}),o.isDirty=!0,n.crop.isDirty=!0}},COLOR_SET_COLOR_VALUE:function(t){var r=t.key,i=t.value;n.crop.isDirty=!0,e("COLOR_SET_VALUE",{key:r,value:i})},COLOR_SET_VALUE:function(t){var r=t.key,i=t.value;n.colorValues[r]=i,e("SET_COLOR_MATRIX",{key:r,matrix:Mn[r](i)})}},Object.keys(Mn).reduce(function(r,i){var o=i.toUpperCase(),a=xn(i);return r["SET_COLOR_".concat(o)]=function(r){var c=r.value;if(c!==r.prevValue){var u=l(t("GET_COLOR_".concat(o,"_RANGE")),2),s=u[0],f=u[1],d=xe(c,s,f);n.options["color".concat(a)]=d,n.instructions.color||(n.instructions.color={}),n.instructions.color[i]=d,e("COLOR_SET_VALUE",{key:i,value:d})}},r},{}),{SET_COLOR_MATRIX:function(t){var r=t.key,i=t.matrix;i?n.colorMatrices[r]=c(i):delete n.colorMatrices[r],e("DID_SET_COLOR_MATRIX",{key:r,matrix:i})},FILTER_SET_FILTER:function(t){var r=t.value;n.crop.isDirty=!0,e("FILTER_SET_VALUE",{value:r})},FILTER_SET_VALUE:function(r){var i=r.value,o=Cn(i)?i:null;if(Y(i)){var a=t("GET_FILTERS");p(a,function(e,t){e===i&&(o=t.matrix())})}n.filter=i,n.filterName=Y(i)?i:null,e("SET_COLOR_MATRIX",{key:"filter",matrix:o})},DID_SET_FILTER:function(t){var n=t.value;n!==t.prevValue&&(e("FILTER_SET_VALUE",{value:n}),e("SET_DATA",{filter:n}))},DID_SET_SIZE:function(t){var n=t.value;n!==t.prevValue&&e("SET_DATA",{size:n})},DID_SET_CROP:function(t){var n=t.value;n!==t.prevValue&&e("SET_DATA",{crop:n})},DID_SET_MARKUP:function(t){var n=t.value,r=t.prevValue;n!==r&&JSON.stringify(n)===JSON.stringify(r)||e("SET_DATA",{markup:n})},SET_DATA:function(r){if(r.size&&t("ALLOW_MANUAL_RESIZE")){var i=a({width:null,height:null},r.size),o=nt(i,t("GET_SIZE_MIN"),t("GET_SIZE_MAX"),null);n.instructions.size=a({},o),e("RESIZE_SET_OUTPUT_SIZE",o)}r.filter&&(n.instructions.filter=r.filter),n.instructions.markup=r.markup||[],n.instructions.color=Object.keys(Mn).reduce(function(e,t){return e[t]=void 0===r.color||void 0===r.color[t]?n.options["color".concat(xn(t))]:r.color[t],e},{}),r.crop&&(n.instructions.crop=Tn(t,n,r.crop,n.size),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,!1===n.instructions.crop.scaleToFit&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),e("EDIT_RESET"))},DID_SET_INITIAL_STATE:function(e){var r=e.value||{},i=r.crop,o=r.filter,l=r.color,c=r.size,u=void 0===c?{}:c,s=r.markup,f=void 0===s?[]:s,d=a({width:null,height:null},u),h=nt(d,t("GET_SIZE_MIN"),t("GET_SIZE_MAX"),null);n.instructions.size=a({},h),n.instructions.crop=Tn(t,n,i),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,!1===n.instructions.crop.scaleToFit&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),n.instructions.filter=o||null,n.instructions.color=Object.keys(Mn).reduce(function(e,t){return e[t]=void 0===l||void 0===l[t]?n.options["color".concat(xn(t))]:l[t],e},{}),n.instructions.markup=f,n.crop.isDirty=!0},GET_DATA:function(r){var i=r.success,o=r.failure,a=r.file,l=r.data;if(!n.file)return o("no-image-source");if(!n.stage)return o("image-not-fully-loaded");var c={file:q(a)?a:t("GET_OUTPUT_FILE"),data:q(l)?l:t("GET_OUTPUT_DATA"),success:i,failure:o};e(c.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",c)},REQUEST_PREPARE_OUTPUT:function(t){var n=t.file,r=t.data,i=t.success,o=t.failure;e("PREPARE_OUTPUT",{file:n,data:r,success:i,failure:o},!0),e("DID_REQUEST_PREPARE_OUTPUT")},PREPARE_OUTPUT:function(r){var i=r.file,o=r.data,a=r.success,l=void 0===a?function(){}:a,c=r.failure,u=void 0===c?function(){}:c;if(Xn(n))return e("ABORT_IMAGE");kn({file:i,data:o},n,t).then(function(t){if(e("DID_PREPARE_OUTPUT"),Xn(n))return e("ABORT_IMAGE");l(t)}).catch(function(t){if(Xn(n))return e("ABORT_IMAGE");u(t)})},EDIT_RESET:function(){qn(n),Bn(n,t,e)},EDIT_CONFIRM:function(){if(n.file&&n.stage){qn(n),e("CROP_ZOOM");var r={file:t("GET_OUTPUT_FILE"),data:t("GET_OUTPUT_DATA"),success:function(t){n.filePromise.resolveOnConfirm&&n.filePromise.success(t),e("DID_CONFIRM",{output:t})},failure:console.error};e(r.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",r)}},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.success(null),e("DID_CANCEL")},EDIT_CLOSE:function(){qn(n)},EDIT_DESTROY:function(){ee(n)},SET_OPTIONS:function(t){var n=t.options;p(n,function(t,n){e("SET_".concat(ne(t,"_").toUpperCase()),{value:n})})}})},Qn=function(e,t){return V({ignoreRect:!0,name:e,mixins:t,create:function(e){var t=e.root,n=e.props;n.className&&t.element.classList.add(n.className),n.controls.map(function(e){var n=t.createChildView(e.view,e);e.didCreateView&&e.didCreateView(n),t.appendChildView(n)})}})},Jn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},apis:["id"],listeners:!0},tag:"button",create:function(e){var t=e.root,n=e.props;t.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),t.element.setAttribute("type",n.type||"button"),n.name&&n.name.split(" ").forEach(function(e){t.element.className+=" doka--button-".concat(e)}),t.ref.handleClick=function(){"string"==typeof n.action?t.dispatch(n.action):n.action()},t.element.addEventListener("click",t.ref.handleClick),n.create&&n.create({root:t,props:n})},destroy:function(e){var t=e.root;t.element.removeEventListener("click",t.ref.handleClick)}}),$n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;return'<svg width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">').concat(e,"</svg>")},er=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return V({ignoreRect:!0,tag:e,create:function(e){e.root.element.textContent=t}})},tr=function(e){e.element.dataset.viewStatus="idle",nr(e)},nr=function(e){e.ref.busyIndicators.forEach(function(e){e.translateY=-10,e.opacity=0,e.markedForRemoval=!0})},rr=function(e,t,n){e.element.dataset.viewStatus="busy";var r=ir(e,t,n);nr(e),e.ref.busyIndicators.push(r),r.markedForRemoval=!1,r.translateY=0,r.opacity=1},ir=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.appendChildView(e.createChildView(Qn("status-bubble",{styles:["opacity","translateY"],apis:["markedForRemoval"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}}),{translateY:20,opacity:0,controls:[{view:Qn("status-bubble-inner"),controls:n?[{view:Jn,label:"Close",name:"icon-only status-bubble-close",icon:$n('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),action:n},{view:er("p",t)}]:[{view:er("p",t)}]}]}))},or=V({name:"edit-status",ignoreRect:!0,create:function(e){var t=e.root;t.ref.busyIndicators=[],t.element.setAttribute("tabindex",-1)},write:B({MISSING_WEBGL:function(e){var t=e.root,n=/fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE"));rr(t,t.query("GET_LABEL_STATUS_MISSING_WEB_G_L"),n?function(){t.dispatch("EDIT_CANCEL")}:null)},AWAITING_IMAGE:function(e){var t=e.root;rr(t,t.query("GET_LABEL_STATUS_AWAITING_IMAGE"))},DID_PRESENT_IMAGE:function(e){var t=e.root;tr(t)},DID_LOAD_IMAGE_ERROR:function(e){var t=e.root,n=e.action,r=/fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE")),i=t.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"),o="function"==typeof i?i(n.error):i;rr(t,o,r?function(){t.dispatch("EDIT_CANCEL")}:null)},DID_REQUEST_LOAD_IMAGE:function(e){var t=e.root;rr(t,t.query("GET_LABEL_STATUS_LOADING_IMAGE"))},DID_REQUEST_PREPARE_OUTPUT:function(e){var t=e.root;rr(t,t.query("GET_LABEL_STATUS_PROCESSING_IMAGE"))},DID_PREPARE_OUTPUT:function(e){var t=e.root;tr(t)}}),didWriteView:function(e){var t=e.root;t.ref.busyIndicators=t.ref.busyIndicators.filter(function(e){return!e.markedForRemoval||0!==e.opacity||(t.removeChildView(e),!1)})}}),ar={down:"pointerdown",move:"pointermove",up:"pointerup"},lr=function(){var e=[],t=function(t){return e.findIndex(function(e){return e.pointerId===t.pointerId})};return{update:function(n){var r=t(n);r<0||(e[r]=n)},multiple:function(){return e.length>1},count:function(){return e.length},active:function(){return e.concat()},push:function(n){t(n)>=0||e.push(n)},pop:function(n){var r=t(n);r<0||e.splice(r,1)}}},cr=function(e,t,n,r){return e.addEventListener(ar[t],n,r)},ur=function(e,t,n){return e.removeEventListener(ar[t],n)},sr=function(e,t){"contains"in e&&e.contains(t);var n=t;do{if(n===e)return!0}while(n=n.parentNode);return!1},fr=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{stopPropagation:!0,cancelOnMultiple:!1},o={x:0,y:0},a={enabled:!0,origin:null,cancel:!1,cancelled:!1,pointers:lr()},l=null,c=function(e,t){t&&(l||u(e,t),cancelAnimationFrame(l),l=requestAnimationFrame(function(){u(e,t),l=null}))},u=function(e,t){return t.apply(null,[e,function(e){return{x:e.pageX-o.x,y:e.pageY-o.y}}(e)])},s=function(n){var r=0===a.pointers.count();r&&(a.active=!1,a.cancel=!1,a.cancelled=!1),a.pointers.push(n),cr(document.documentElement,"up",d),r?(e===n.target||sr(e,n.target))&&n.isPrimary&&(n.preventDefault(),i.stopPropagation&&(n.stopPropagation(),n.stopImmediatePropagation()),a.active=!0,o.x=n.pageX,o.y=n.pageY,cr(document.documentElement,"move",f),t(n)):i.cancelOnMultiple&&(a.cancel=!0)},f=function(e){e.isPrimary&&(a.cancelled||(e.preventDefault(),i.stopPropagation&&e.stopPropagation(),c(e,n),a.cancel&&(a.cancelled=!0,c(e,r))))},d=function e(t){a.pointers.pop(t),0===a.pointers.count()&&(ur(document.documentElement,"move",f),ur(document.documentElement,"up",e)),a.active&&(a.cancelled||(t.preventDefault(),i.stopPropagation&&t.stopPropagation(),c(t,n),c(t,r)))};return cr(document.documentElement,"down",s),{enable:function(){a.enabled||cr(document.documentElement,"down",s),a.enabled=!0},disable:function(){a.enabled&&ur(document.documentElement,"down",s),a.enabled=!1},destroy:function(){ur(document.documentElement,"up",d),ur(document.documentElement,"move",f),ur(document.documentElement,"down",s)}}},dr={type:"spring",stiffness:.4,damping:.65,mass:7},hr=function(e,t){return Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})},pr=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&hr(n,t),n},mr=["nw","se"],gr=["nw","n","ne","w","e","sw","s","se"],vr={nw:"nwse",n:"ns",ne:"nesw",w:"ew",e:"ew",sw:"nesw",s:"ns",se:"nwse"},yr={nw:function(e){return{x:e.x,y:e.y}},n:function(e){return{x:e.x+.5*e.width,y:e.y}},ne:function(e){return{x:e.x+e.width,y:e.y}},w:function(e){return{x:e.x,y:e.y+.5*e.height}},e:function(e){return{x:e.x+e.width,y:e.y+.5*e.height}},sw:function(e){return{x:e.x,y:e.y+e.height}},s:function(e){return{x:e.x+.5*e.width,y:e.y+e.height}},se:function(e){return{x:e.x+e.width,y:e.y+e.height}}},Er=V({tag:"div",name:"image-markup",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:"spring",markupX:dr,markupY:dr,markupWidth:dr,markupHeight:dr},listeners:!0,apis:["toolsReference","onSelect","onDrag","markupX","markupY","markupWidth","markupHeight","allowInteraction"]},create:function(e){var t=e.root,n=e.props,r=n.onSelect,i=void 0===r?function(){}:r,o=n.onUpdate,a=void 0===o?function(){}:o,l=pr("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"});t.ref.canvas=l;var c=t.query("GET_ROOT_SIZE");l.setAttribute("width",c.width),l.setAttribute("height",c.height);var u=document.createElement("input");hr(u,{type:"text",autocomplete:"off",autocapitalize:"off"}),u.addEventListener("keydown",function(e){e.stopPropagation(),13===e.keyCode||9===e.keyCode?(e.target.blur(),s()):8!==e.keyCode||t.ref.input.value.length||t.dispatch("MARKUP_DELETE",{id:t.ref.selected.id})}),t.appendChild(u),t.ref.input=u,t.ref.elements=[],t.ref.viewSize={},t.ref.resetSelected=function(){return t.ref.selected={id:null,type:null,settings:{}},t.ref.selected},t.ref.resetSelected();var s=function(){t.ref.resetSelected(),i(null)};t.ref.handleDeselect=function(e){var r;t.query("IS_ACTIVE_VIEW","markup")&&t.ref.selected.id&&e.target!==t.ref.removeButton.element&&(r=e.target,t.ref.selected.id!==function(e){return e.id?e:e.parentNode}(r).id&&(function(e){return sr(t.ref.manipulatorGroup,e)||e===t.ref.input}(e.target)||n.isMarkupUtil(e.target)||s()))},cr(document.body,"down",t.ref.handleDeselect),t.ref.handleTextInput=function(){return a(t.ref.selected.id,{text:t.ref.input.value})},t.ref.input.addEventListener("input",t.ref.handleTextInput),t.ref.handleAttemptDelete=function(e){t.query("IS_ACTIVE_VIEW","markup")&&(!t.ref.selected.id||8!==e.keyCode&&46!==e.keyCode||(e.stopPropagation(),e.preventDefault(),t.dispatch("MARKUP_DELETE",{id:t.ref.selected.id})))},document.body.addEventListener("keydown",t.ref.handleAttemptDelete);var f=pr("g"),d=pr("g");f.appendChild(d),t.ref.shapeGroup=d;var h=pr("g",{fill:"none",class:"doka--manipulator-group"}),p=pr("rect",{x:0,y:0,width:0,height:0,fill:"none"}),m=pr("line",{x1:0,y1:0,x2:0,y2:0});h.appendChild(m),h.appendChild(p),t.ref.manipulatorLine=m,t.ref.manipulatorRect=p,t.ref.manipulators=[];for(var g=0;g<10;g++){var v=pr("circle",{r:6,"stroke-width":2,style:"display:none"});h.appendChild(v),t.ref.manipulators.push(v)}f.appendChild(h),t.ref.manipulatorGroup=h,l.appendChild(f),t.element.appendChild(l),t.ref.shapeOffsetGroup=f,t.ref.removeButton=t.appendChildView(t.createChildView(Jn,{label:t.query("GET_LABEL_MARKUP_REMOVE_SHAPE"),name:"destroy-shape",action:function(){t.dispatch("MARKUP_DELETE",{id:t.ref.selected.id})}})),t.query("IS_ACTIVE_VIEW","markup")&&(t.element.dataset.active=!0)},destroy:function(e){var t=e.root;t.ref.elements.concat(t.ref.manipulators).forEach(function(e){e.dragger&&e.dragger.destroy()}),t.ref.input.removeEventListener("input",t.ref.handleTextInput),document.body.removeEventListener("keydown",t.ref.handleAttemptDelete),ur(document.body,"down",t.ref.handleDeselect)},read:function(e){var t=e.root;if(!t.rect.element.hidden)for(var n in t.ref.elements){var r=t.ref.elements[n];if(r&&"text"===r.nodeName&&r.parentNode){var i=r.getBBox();r.bbox={x:i.x,y:i.y,width:i.width,height:i.height}}}},write:B({SHOW_VIEW:function(e){var t=e.root;"markup"===e.action.id?t.element.dataset.active=!0:t.element.dataset.active=!1},MARKUP_SET_VALUE:function(e){e.root.ref.shapeGroup.innerHTML=""},UPDATE_ROOT_RECT:function(e){var t=e.root,n=e.action,r=t.ref.canvas;r.setAttribute("width",n.rect.width),r.setAttribute("height",n.rect.height),t.ref.previousScale=null}},function(e){var t=e.root,n=e.props,r=e.timestamp;if(!(t.opacity<=0)){var i=t.query("GET_CROP",n.id,r);if(i){var o=i.markup,c=i.cropStatus,u=n.onSelect,s=n.onDrag,f=t.ref,d=f.viewSize,h=f.shapeOffsetGroup,p=f.manipulators,m=f.manipulatorLine,g=f.manipulatorRect,v=f.removeButton,y=t.query("GET_OUTPUT_WIDTH"),E=t.query("GET_OUTPUT_HEIGHT"),_=c.image,w=c.crop,T=w.width,x=w.height,R=w.widthFloat/w.heightFloat;if(y||E){var A=t.query("GET_OUTPUT_FIT");y&&!E&&(E=y),E&&!y&&(y=E);var I,C=y/T,b=E/x;"force"===A?(T=y,x=E):("cover"===A?I=Math.max(C,b):"contain"===A&&(I=Math.min(C,b)),T*=I,x*=I)}else _.width&&_.height?(T=_.width,x=_.height):_.width&&!_.height?(T=_.width,x=_.width/R):_.height&&!_.width&&(x=_.height,T=_.height*R);var O=Re(t.markupX,3),M=Re(t.markupY,3),S=Re(t.markupWidth,3),L=Re(t.markupHeight,3),P=Re(Math.min(t.markupWidth/T,t.markupHeight/x),4);if(d.width=S,d.height=L,wr(t,{markupX:O,markupY:M,scale:P,markup:o,currentWidth:T,currentHeight:x})&&(h.setAttribute("transform","translate(".concat(O," ").concat(M,")")),t.ref.previousX=O,t.ref.previousY=M,t.ref.previousScale=P,t.ref.previousCurrentHeight=x,t.ref.previousCurrentWidth=T,t.ref.previousMarkupLength=o.length,!(d.width<1||d.height<1))){var G,k=o.find(function(e){return e[1].isSelected}),D=k&&t.ref.selected.id!==k[1].id||t.ref.selected.id&&!k;G=k?t.ref.selected={id:k[1].id,type:k[0],settings:k[1]}:t.ref.resetSelected(),t.ref.input.hidden="text"!==t.ref.selected.type,v.element.dataset.active=null!==t.ref.selected.id,m.setAttribute("style","opacity:0"),g.setAttribute("style","opacity:0"),p.forEach(function(e){return e.setAttribute("style","opacity:0;pointer-events:none;")});var U=t.query("GET_MARKUP_FILTER");o.filter(U).sort(an).forEach(function(e,r){var i=l(e,2),o=i[0],c=i[1],f=c.id,h=c.isDestroyed,y=c.isDirty,E=c.isSelected,_=c.allowSelect,w=c.allowMove,T=c.allowResize,x=c.allowInput;if(h){var R=t.ref.elements[f];R&&(R.dragger&&R.dragger.destroy(),t.ref.elements[f]=null,R.parentNode.removeChild(R))}else{var A,I,C,b=t.ref.elements[f];if(b||(b=rn(o,c),t.ref.elements[f]=b,_?(b.dragger=fr(b,function(){I=Date.now(),A=a({},b.rect),(C=f===t.ref.selected.id)||u(f)},function(e,t){w&&s(f,A,t,d,P)},function(e,n){if(x&&"text"===o&&C){var r=Ce({x:0,y:0},n),i=Date.now()-I;if(!(r>10||i>750)){t.ref.input.focus();var a=t.markupX+b.bbox.x,l=b.bbox.width,c=(e.offsetX-a)/l,u=Math.round(t.ref.input.value.length*c);t.ref.input.setSelectionRange(u,u)}}}),b.dragger.disable()):b.setAttribute("style","pointer-events:none;")),b.dragger&&(n.allowInteraction?b.dragger.enable():b.dragger.disable()),r!==b.index){b.index=r;var O=t.ref.shapeGroup;O.insertBefore(b,O.childNodes[r+1])}if(y&&on(b,o,c,d,P),E){var M=v.rect.element.width,S=v.rect.element.height,L=t.markupX-.5*M,G=t.markupY-S-15,k="text"===o?b.bbox:b.rect;"line"===o?(L+=k.x,G+=k.y,hr(m,{x1:k.x,y1:k.y,x2:k.x+k.width,y2:k.y+k.height,style:"opacity:1"})):k&&(G+=k.y,L+=k.x+.5*k.width,hr(g,{x:k.x-("text"===o?5:0),y:k.y,width:k.width+("text"===o?10:0),height:k.height,style:"opacity:1"}));var D=t.markupY+10,U=t.markupY+t.markupHeight-10,V=t.markupX+10,B=t.markupX+t.markupWidth-10;if(G<D?G=D:G+S>U&&(G=U-S),L<V?L=V:L+M>B&&(L=B-M),k||(v.element.dataset.active="false"),v.element.setAttribute("style","transform: translate3d(".concat(L,"px, ").concat(G,"px, 0)")),"text"===o&&k){var N=k.width+65,z=t.markupWidth-k.x,F="\n                        width: ".concat(Math.min(N,z),"px;\n                        height: ").concat(k.height,"px;\n                        color: ").concat(b.getAttribute("fill"),";\n                        font-family: ").concat(b.getAttribute("font-family"),";\n                        font-size: ").concat(b.getAttribute("font-size").replace(/px/,""),"px;\n                        font-weight: ").concat(b.getAttribute("font-weight")||"normal",";\n                    ");Ee()?F+="\n                            left: ".concat(Math.round(t.markupX+k.x),"px;\n                            top: ").concat(Math.round(t.markupY+k.y),"px;\n                        "):F+="\n                            transform: translate3d(".concat(Math.round(t.markupX+k.x),"px,").concat(Math.round(t.markupY+k.y),"px,0);\n                        "),t.ref.input.setAttribute("style",F),b.setAttribute("fill","none")}if("text"===o)return;if(!T)return;var W="line"===o?mr:gr;p.forEach(function(e,t){var n=W[t];if(n){var r="line"===o?"move":"".concat(vr[n],"-resize"),i=yr[n](b.rect);hr(e,{cx:i.x,cy:i.y,style:"opacity:1;cursor:".concat(r)})}})}c.isDirty=!1}}),D&&(xr(t),"text"===G.type?t.ref.input.value=G.settings.text:t.ref.selected.id&&Tr(t,n.onResize))}}}})}),_r=function(e){return e.forEach(function(e){return e[1].isDirty=!0})},wr=function(e,t){var n=t.markup,r=t.markupX,i=t.markupY,o=t.currentWidth,a=t.currentHeight,l=t.scale;return r!==e.ref.previousX?(_r(n),!0):i!==e.ref.previousY?(_r(n),!0):l!==e.ref.previousScale?(_r(n),!0):a!==e.ref.previousCurrentHeight?(_r(n),!0):o!==e.ref.previousCurrentWidth?(_r(n),!0):n.length!==e.ref.previousMarkupLength||!!n.find(function(e){return e[1].isDirty})},Tr=function(e,t){var n=e.ref.selected.id,r="g"===e.ref.elements[n].nodeName?mr:gr;e.ref.manipulators.forEach(function(i,o){var a=r[o];if(a){var l=null;i.dragger=fr(i,function(){l={x:parseFloat(g(i,"cx")),y:parseFloat(g(i,"cy"))}},function(r,i){t(n,a,l,i,e.ref.viewSize)},null,{stopPropagation:!0})}})},xr=function(e){e.ref.manipulators.forEach(function(e){e.dragger&&(e.dragger.destroy(),e.dragger=null)})},Rr={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},Ar=function(e,t,n,r,i){var o=null,a=!0,l={enabled:!0},c=function(e){var i=Rr[e.keyCode]||e.keyCode;n[i]&&(e.stopPropagation(),a&&(o=t(i),a=!1),n[i](o),r(o))},u=function(e){var t=Rr[e.keyCode]||e.keyCode;n[t]&&(e.stopPropagation(),i(o),a=!0)};return e.addEventListener("keydown",c),e.addEventListener("keyup",u),{enable:function(){l.enabled||(e.addEventListener("keydown",c),e.addEventListener("keyup",u)),l.enabled=!0},disable:function(){l.enabled&&(e.removeEventListener("keydown",c),e.removeEventListener("keyup",u)),l.enabled=!1},destroy:function(){e.removeEventListener("keydown",c),e.removeEventListener("keyup",u)}}},Ir={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},Cr=function(e,t,n,r){-1!==r&&e.transform.apply(e,Ir[r](t,n))},br=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4?arguments[4]:void 0;t=Math.round(t),n=Math.round(n);var o=i||document.createElement("canvas"),a=o.getContext("2d");return r>=5&&r<=8?(o.width=n,o.height=t):(o.width=t,o.height=n),a.save(),Cr(a,t,n,r),a.drawImage(e,0,0,t,n),a.restore(),o},Or=function(){self.onmessage=function(e){createImageBitmap(e.data.message.file).then(function(t){self.postMessage({id:e.data.id,message:t},[t])})}},Mr=function(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),r},Sr=function(e,t,n){var r=e.createProgram();return e.attachShader(r,Mr(e,t,e.VERTEX_SHADER)),e.attachShader(r,Mr(e,n,e.FRAGMENT_SHADER)),e.linkProgram(r),r},Lr=function(){return{x:arguments.length<3?0:arguments.length<=0?void 0:arguments[0],y:arguments.length<3?0:arguments.length<=1?void 0:arguments[1],width:arguments.length<3?arguments.length<=0?void 0:arguments[0]:arguments.length<=2?void 0:arguments[2],height:1===arguments.length?arguments.length<=0?void 0:arguments[0]:arguments.length<3?arguments.length<=1?void 0:arguments[1]:arguments.length<=3?void 0:arguments[3]}},Pr=function(e,t){return{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t}},Gr=function(){var e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},kr=function(e,t,n,r,i){var o=1/Math.tan(t/2),a=1/(r-i);e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,e[10]=(i+r)*a,e[14]=2*i*r*a},Dr=function(e,t){var n=t[0],r=t[1],i=t[2];e[12]=e[0]*n+e[4]*r+e[8]*i+e[12],e[13]=e[1]*n+e[5]*r+e[9]*i+e[13],e[14]=e[2]*n+e[6]*r+e[10]*i+e[14],e[15]=e[3]*n+e[7]*r+e[11]*i+e[15]},Ur=function(e,t){var n=t[0],r=t[1],i=t[2];e[0]=e[0]*n,e[1]=e[1]*n,e[2]=e[2]*n,e[3]=e[3]*n,e[4]=e[4]*r,e[5]=e[5]*r,e[6]=e[6]*r,e[7]=e[7]*r,e[8]=e[8]*i,e[9]=e[9]*i,e[10]=e[10]*i,e[11]=e[11]*i},Vr=function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],s=e[10],f=e[11];e[4]=i*r+c*n,e[5]=o*r+u*n,e[6]=a*r+s*n,e[7]=l*r+f*n,e[8]=c*r-i*n,e[9]=u*r-o*n,e[10]=s*r-a*n,e[11]=f*r-l*n},Br=function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],s=e[10],f=e[11];e[0]=i*r-c*n,e[1]=o*r-u*n,e[2]=a*r-s*n,e[3]=l*r-f*n,e[8]=i*n+c*r,e[9]=o*n+u*r,e[10]=a*n+s*r,e[11]=l*n+f*r},Nr=function(e,t){var n=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],s=e[6],f=e[7];e[0]=i*r+c*n,e[1]=o*r+u*n,e[2]=a*r+s*n,e[3]=l*r+f*n,e[4]=c*r-i*n,e[5]=u*r-o*n,e[6]=s*r-a*n,e[7]=f*r-l*n},zr="\nattribute vec4 aPosition;\nvoid main() {\n\tgl_Position = aPosition;\n}\n",Fr=function(e,t,n){var r=Lr(),i=null,o=function(e){return e*Math.PI/180}(30),a=Math.tan(o/2),l={antialias:!1,alpha:!1},u=e.getContext("webgl",l)||e.getContext("experimental-webgl",l);if(!u)return null;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA);var s=Sr(u,zr,"\nprecision mediump float;\n\nuniform vec2 uViewportSize;\nuniform vec3 uColorStart;\nuniform vec3 uColorEnd;\nuniform vec2 uOverlayLeftTop;\nuniform vec2 uOverlayRightBottom;\nuniform vec4 uColorCanvasBackground;\n\nvoid main() {\n\n\tfloat x = gl_FragCoord.x;\n\tfloat y = gl_FragCoord.y;\n\n\tvec2 center = vec2(.5, .5);\n\tvec2 st = vec2(x / uViewportSize.x, y / uViewportSize.y);\n\tfloat mixValue = distance(st, center) * 1.5; // expand outside view (same as doka--root::after)\n\tvec3 color = mix(uColorStart, uColorEnd, mixValue);\n\n\tif (uColorCanvasBackground[3] == 1.0) {\n\n\t\tfloat innerLeft = uOverlayLeftTop.x;\n\t\tfloat innerRight = uOverlayRightBottom.x;\n\t\tfloat innerTop = uOverlayRightBottom.y;\n\t\tfloat innerBottom = uOverlayLeftTop.y;\n\n\t\tif (x < innerLeft || x > innerRight || y < innerTop || y > innerBottom) {\n\t\t\tgl_FragColor = vec4(color, 1.0);\n\t\t\treturn;\n\t\t}\n\n\t\tgl_FragColor = uColorCanvasBackground;\n\t\treturn;\n\t}\n\t\n\tgl_FragColor = vec4(color, 1.0);\n}\n"),f=u.getUniformLocation(s,"uColorStart"),d=u.getUniformLocation(s,"uColorEnd"),h=u.getUniformLocation(s,"uViewportSize"),p=u.getAttribLocation(s,"aPosition"),m=u.getUniformLocation(s,"uOverlayLeftTop"),g=u.getUniformLocation(s,"uOverlayRightBottom"),v=u.getUniformLocation(s,"uColorCanvasBackground"),y=u.createBuffer(),E=new Float32Array([1,-1,1,1,-1,-1,-1,1]);u.bindBuffer(u.ARRAY_BUFFER,y),u.bufferData(u.ARRAY_BUFFER,E,u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null);var _=Sr(u,zr,"\nprecision mediump float;\n\nuniform vec2 uOverlayLeftTop;\nuniform vec2 uOverlayRightBottom;\nuniform vec4 uOutlineColor;\nuniform float uOutlineWidth;\n\nvoid main() {\n\n\tfloat x = gl_FragCoord.x;\n\tfloat y = gl_FragCoord.y;\n\n\tfloat innerLeft = uOverlayLeftTop.x;\n\tfloat innerRight = uOverlayRightBottom.x;\n\tfloat innerTop = uOverlayRightBottom.y;\n\tfloat innerBottom = uOverlayLeftTop.y;\n\n\tfloat outerLeft = innerLeft - uOutlineWidth;\n\tfloat outerRight = innerRight + uOutlineWidth;\n\tfloat outerTop = innerTop - uOutlineWidth;\n\tfloat outerBottom = innerBottom + uOutlineWidth;\n\t\n\tif (x < outerLeft || x > outerRight || y < outerTop || y > outerBottom) {\n\t\tdiscard;\n\t}\n\n\tif (x < innerLeft || x > innerRight || y < innerTop || y > innerBottom) {\n\t\tgl_FragColor = uOutlineColor;\n\t}\n}\n"),w=u.getAttribLocation(_,"aPosition"),T=u.getUniformLocation(_,"uOutlineWidth"),x=u.getUniformLocation(_,"uOutlineColor"),R=u.getUniformLocation(_,"uOverlayLeftTop"),A=u.getUniformLocation(_,"uOverlayRightBottom"),I=u.createBuffer(),C=new Float32Array([1,-1,1,1,-1,-1,-1,1]);u.bindBuffer(u.ARRAY_BUFFER,I),u.bufferData(u.ARRAY_BUFFER,C,u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null);var b=Sr(u,"\nattribute vec4 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMatrix;\n\n// send to fragment shader\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvoid main () {\n    vPosition = uMatrix * aPosition;\n    gl_Position = vPosition;\n    vTexCoord = aTexCoord;\n}\n","\nprecision mediump float;\n\nuniform sampler2D uTexture;\nuniform vec2 uTextureSize;\n\nuniform float uColorOpacity;\nuniform mat4 uColorMatrix;\nuniform vec4 uColorOffset;\n\nuniform vec4 uOverlayColor;\nuniform vec2 uOverlayLeftTop;\nuniform vec2 uOverlayRightBottom;\n\n// received from vertex shader\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvoid main () {\n\n\t// get texture color\n\tvec4 color = texture2D(uTexture, vTexCoord);\n\t\n\t// apply color matrix\n\tcolor = color * uColorMatrix + uColorOffset;\n\n\t// test if falls within \n    if ((gl_FragCoord.x < uOverlayLeftTop.x || gl_FragCoord.x > uOverlayRightBottom.x) || \n        (gl_FragCoord.y > uOverlayLeftTop.y || gl_FragCoord.y < uOverlayRightBottom.y)) {\n\t\tcolor *= uOverlayColor;\n\t}\n\t\n    gl_FragColor = color * uColorOpacity;\n}\n");u.useProgram(b);var O=u.getUniformLocation(b,"uMatrix"),M=u.getUniformLocation(b,"uTexture"),S=u.getUniformLocation(b,"uTextureSize"),L=u.getUniformLocation(b,"uOverlayColor"),P=u.getUniformLocation(b,"uOverlayLeftTop"),G=u.getUniformLocation(b,"uOverlayRightBottom"),k=u.getUniformLocation(b,"uColorOpacity"),D=u.getUniformLocation(b,"uColorOffset"),U=u.getUniformLocation(b,"uColorMatrix"),V=u.getAttribLocation(b,"aPosition"),B=u.getAttribLocation(b,"aTexCoord"),N=function(e,t,n,r,i){var o=e.createTexture();e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.uniform1i(t,r),e.uniform2f(n,i.width,i.height);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)}catch(t){e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i.width,i.height,0,e.RGBA,e.UNSIGNED_BYTE,null)}return o}(u,M,S,0,t),z=t.width*n,F=t.height*n,W=-.5*z,q=.5*F,Y=.5*z,H=-.5*F,j=new Float32Array([W,q,W,H,Y,q,Y,H]),Z=new Float32Array([0,0,0,1,1,0,1,1]),X=j.length/2,K=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,K),u.bufferData(u.ARRAY_BUFFER,j,u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null);var Q=u.createBuffer();return u.bindBuffer(u.ARRAY_BUFFER,Q),u.bufferData(u.ARRAY_BUFFER,Z,u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null),{release:function(){e.width=1,e.height=1},resize:function(t,o){e.width=t*n,e.height=o*n,e.style.width="".concat(t,"px"),e.style.height="".concat(o,"px"),r.width=t*n,r.height=o*n,i=function(e,t){return e/t}(r.width,r.height),u.viewport(0,0,u.canvas.width,u.canvas.height)},update:function(e,l,E,C,M,S,z,F,W,q,Y,H,j,Z,J,$,ee,te,ne){Y=Y?Pr(Y,n):Lr(r.width,r.height);var re=.5*r.width,ie=.5*r.height,oe=t.width*n,ae=t.height*n;e*=n,l*=n,E*=n,C*=n;var le=ae/2/a*(r.height/Y.height)*-1;le/=-a*le*2/r.height;var ce=.5*oe,ue=.5*ae;e-=ce,l-=ue;var se=F,fe=-(re-ce)+E,de=ie-ue-C,he=Gr();kr(he,o,i,1,2*-le),Dr(he,[fe,de,le]),Dr(he,[e,-l,0]),Ur(he,[se,se,se]),Nr(he,-z),Dr(he,[-e,l,0]),Br(he,S),Vr(he,M),u.clearColor(Z[0],Z[1],Z[2],1),u.clear(u.COLOR_BUFFER_BIT),u.useProgram(s),u.uniform3fv(f,J),u.uniform3fv(d,$),u.uniform4fv(v,ne.map(function(e,t){return t<3?e/255:e})),u.uniform2f(h,r.width,r.height),u.uniform2f(m,H.x*n,r.height-H.y*n),u.uniform2f(g,(H.x+H.width)*n,r.height-(H.y+H.height)*n),u.bindBuffer(u.ARRAY_BUFFER,y),u.vertexAttribPointer(p,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(p),u.drawArrays(u.TRIANGLE_STRIP,0,4),u.useProgram(b),u.bindFramebuffer(u.FRAMEBUFFER,null),u.bindTexture(u.TEXTURE_2D,N),u.bindBuffer(u.ARRAY_BUFFER,K),u.vertexAttribPointer(V,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(V),u.bindBuffer(u.ARRAY_BUFFER,Q),u.vertexAttribPointer(B,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(B),u.uniformMatrix4fv(O,!1,he),H=Pr(H,n),u.uniform2f(P,H.x,r.height-H.y),u.uniform2f(G,H.x+H.width,r.height-(H.y+H.height)),u.uniform4fv(L,j),u.uniform1f(k,q),u.uniform4f(D,W[4],W[9],W[14],W[19]),u.uniformMatrix4fv(U,!1,[].concat(c(W.slice(0,4)),c(W.slice(5,9)),c(W.slice(10,14)),c(W.slice(15,19)))),u.drawArrays(u.TRIANGLE_STRIP,0,X),u.useProgram(_),u.uniform1f(T,ee),u.uniform4fv(x,te),u.uniform2f(R,H.x,r.height-H.y),u.uniform2f(A,H.x+H.width,r.height-(H.y+H.height)),u.bindBuffer(u.ARRAY_BUFFER,I),u.vertexAttribPointer(w,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(w),u.drawArrays(u.TRIANGLE_STRIP,0,4)}}},Wr=function(e){var t=0,n={},r=O(e),i=O(e),o=O(e),l=O(e);return r.onupdate=function(e){return n.x=e},r.oncomplete=function(){return t++},i.onupdate=function(e){return n.y=e},i.oncomplete=function(){return t++},o.onupdate=function(e){return n.width=e},o.oncomplete=function(){return t++},l.onupdate=function(e){return n.height=e},l.oncomplete=function(){return t++},{interpolate:function(e){r.interpolate(e),i.interpolate(e),o.interpolate(e),l.interpolate(e)},setTarget:function(e){t=0,r.target=e?e.x:null,i.target=e?e.y:null,o.target=e?e.width:null,l.target=e?e.height:null},getRect:function(){return a({},n)},isStable:function(){return 4===t}}},qr=function(e){var t=0,n={},r=O(e),i=O(e),o=O(e);return r.onupdate=function(e){return n.r=e},r.oncomplete=function(){return t++},i.onupdate=function(e){return n.g=e},i.oncomplete=function(){return t++},o.onupdate=function(e){return n.b=e},o.oncomplete=function(){return t++},{interpolate:function(e){r.interpolate(e),i.interpolate(e),o.interpolate(e)},setTarget:function(e){t=0,r.target=e?e[0]:null,i.target=e?e[1]:null,o.target=e?e[2]:null},getColor:function(){return[n.r,n.g,n.b]},isStable:function(){return 3===t}}},Yr={stiffness:.25,damping:.25,mass:2.5},Hr=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],jr=V({name:"image-gl",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["top","left","width","height","xOrigin","yOrigin","xTranslation","yTranslation","xRotation","yRotation","zRotation","scale","overlay","stage","colorMatrix","colorOpacity","overlayOpacity","outlineWidth","isDraft"],animations:{xTranslation:dr,yTranslation:dr,xOrigin:dr,yOrigin:dr,scale:dr,xRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},yRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},zRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},colorOpacity:{type:"tween",delay:150,duration:750},overlayOpacity:"spring",introScale:{type:"spring",stiffness:.25,damping:.75,mass:15},outlineWidth:dr}},create:function(e){var t=e.root;t.ref.canvas=document.createElement("canvas"),t.ref.canvas.width=0,t.ref.canvas.height=0,t.appendChild(t.ref.canvas),t.ref.gl=null,t.introScale=1,t.ref.isPreview="preview"===t.query("GET_STYLE_LAYOUT_MODE"),t.ref.shouldZoom=!t.ref.isPreview,t.ref.didZoom=!1,t.ref.backgroundColor=null,t.ref.backgroundColorSpring=qr(Yr),t.ref.backgroundColorCenter=null,t.ref.backgroundColorCenterSpring=qr(Yr),t.ref.overlaySpring=Wr(dr),t.ref.stageSpring=Wr(dr),t.ref.outlineSpring=O(dr),t.ref.colorMatrixSpring=[],t.ref.colorMatrixStable=!0,t.ref.colorMatrixStableCount=0,t.ref.colorMatrixPositions=[];for(var n=0;n<20;n++)!function(){var e=n,r=O(Yr);r.target=Hr[e],r.onupdate=function(n){t.ref.colorMatrixPositions[e]=n},r.oncomplete=function(){t.ref.colorMatrixStableCount++},t.ref.colorMatrixSpring[e]=r}();t.ref.dragger=fr(t.element,function(){t.dispatch("CROP_IMAGE_DRAG_GRAB")},function(e,n){t.dispatch("CROP_IMAGE_DRAG",{value:n})},function(){t.dispatch("CROP_IMAGE_DRAG_RELEASE")},{cancelOnMultiple:!0});var r=0,i=0;t.ref.keyboard=Ar(t.element,function(){return r=0,i=0,{x:0,y:0}},{up:function(e){e.y-=20},down:function(e){e.y+=20},left:function(e){e.x-=20},right:function(e){e.x+=20},plus:function(){r+=.1,t.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:r}),t.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){r-=.1,t.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:r}),t.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){i-=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:i})},right_bracket:function(){i+=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:i})},h:function(){t.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){t.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){t.dispatch("CROP_RESET")},r:function(){t.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){t.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){t.dispatch("CROP_ZOOM")}},function(e){e&&t.dispatch("CROP_IMAGE_DRAG",{value:e})},function(e){e&&t.dispatch("CROP_IMAGE_DRAG_RELEASE")});var o=t.query("GET_FILE"),a=URL.createObjectURL(o.data),l=function(e){var n=Pt(e,{width:t.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:t.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")}),r=br(e,n.width,n.height,o.orientation),i=Math.max(1,.75*window.devicePixelRatio),a=r.height/r.width,l=96*i,c=br(r,a>1?l:l/a,a>1?l*a:l),u=r.getContext("2d").getImageData(0,0,r.width,r.height),s=c.getContext("2d").getImageData(0,0,c.width,c.height);Dt(r),Dt(c),t.ref.gl=Fr(t.ref.canvas,u,i),t.ref.gl?(t.dispatch("DID_RECEIVE_IMAGE_DATA",{previewData:u,thumbData:s}),t.dispatch("DID_PRESENT_IMAGE")):t.dispatch("MISSING_WEBGL")},c=function(){(function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(e){n(e)},r.src=e})})(a).then(l)};if(function(e){return"createImageBitmap"in window&&function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)}(e)}(o.data)){var u=hn(Or);u.post({file:o.data},function(e){u.terminate(),e?l(e):c()})}else c();t.ref.previousLeft,t.ref.previousTop,t.ref.previousWidth,t.ref.previousHeight,t.ref.canvasStyle=getComputedStyle(t.ref.canvas),t.ref.previousBackgroundColor},destroy:function(e){var t=e.root;t.ref.gl&&(t.ref.gl.release(),t.ref.gl=null),t.ref.dragger.destroy()},read:function(e){var t=e.root,n=t.ref.canvasStyle.backgroundColor,r=t.ref.canvasStyle.color;if("transparent"!==r&&""!==r||(r=null),"transparent"!==n&&""!==n||(n=null),n&&n!==t.ref.previousBackgroundColor){var i=rt(n).map(function(e){return e/255}),o=(i[0]+i[1]+i[2])/3;t.ref.backgroundColor=i,t.ref.backgroundColorCenter=i.map(function(e){return o>.5?e-.15:e+.15}),t.ref.previousBackgroundColor=n}r&&r!==t.ref.previousOutlineColor&&(t.ref.outlineColor=rt(r).map(function(e){return e/255}).concat(1),t.ref.previousOutlineColor=r)},write:B({SHOW_VIEW:function(e){var t=e.root;"crop"===e.action.id?(t.element.setAttribute("tabindex",0),t.ref.dragger.enable()):(t.element.removeAttribute("tabindex"),t.ref.dragger.disable())}},function(e){var t=e.root,n=e.props,r=e.timestamp;if(t.ref.gl&&n.width&&n.height){var i=t.ref,o=i.gl,a=i.shouldZoom,l=i.stageSpring,c=i.overlaySpring,u=i.backgroundColorSpring,s=i.backgroundColorCenterSpring;n.width===t.ref.previousWidth&&n.height===t.ref.previousHeight||(t.ref.gl.resize(n.width,n.height),t.ref.previousWidth=n.width,t.ref.previousHeight=n.height),n.left===t.ref.previousLeft&&n.top===t.ref.previousTop||(t.ref.canvas.style.transform="translate(".concat(-n.left,"px, ").concat(-n.top,"px)"),t.ref.previousLeft=n.left,t.ref.previousTop=n.top),a&&!t.ref.didZoom&&(t.introScale=null,t.introScale=1.15,t.introScale=1,t.ref.didZoom=!0),u.setTarget(t.ref.backgroundColor),u.interpolate(r);var f=u.isStable();s.setTarget(t.ref.backgroundColorCenter),s.interpolate(r);var d=s.isStable();t.ref.colorMatrixStableCount=0;var h=n.colorMatrix||Hr,p=t.ref.colorMatrixSpring.map(function(e,n){return e.target=h[n],e.interpolate(r),t.ref.colorMatrixPositions[n]}),m=20===t.ref.colorMatrixStableCount;n.isDraft&&c.setTarget(null),c.setTarget(n.overlay),c.interpolate(r);var g=c.isStable();n.isDraft&&l.setTarget(null),l.setTarget(n.stage),l.interpolate(r);var v=l.isStable();return o.update(t.xOrigin,t.yOrigin,t.xTranslation+n.left,t.yTranslation+n.top,t.xRotation,t.yRotation,t.zRotation,t.scale*t.introScale,p,t.ref.isPreview?1:t.colorOpacity,l.getRect(),c.getRect(),[1,1,1,1-t.overlayOpacity],u.getColor(),s.getColor(),u.getColor(),t.outlineWidth,t.ref.outlineColor,t.query("GET_BACKGROUND_COLOR")),g&&v&&m&&f&&d}})}),Zr=V({name:"image",ignoreRect:!0,mixins:{apis:["offsetTop"]},create:function(e){var t=e.root,n=e.props;t.ref.imageGL=t.appendChildView(t.createChildView(jr)),t.ref.createMarkup=function(){return t.ref.markup?t.ref.markup:(t.ref.markup=t.appendChildView(t.createChildView(Er,{id:n.id,opacity:0,onSelect:function(e){t.dispatch("MARKUP_SELECT",{id:e})},onDrag:function(e,n,r,i,o){t.dispatch("MARKUP_ELEMENT_DRAG",{id:e,origin:n,offset:r,size:i,scale:o})},onResize:function(e,n,r,i,o){t.dispatch("MARKUP_ELEMENT_RESIZE",{id:e,corner:n,origin:r,offset:i,size:o})},onUpdate:function(e,n){t.dispatch("MARKUP_UPDATE",{id:e,props:n})},isMarkupUtil:function(e){var t=e;do{if("doka--markup-tools"===t.className)return!0}while(t=t.parentNode);return!1}})),t.ref.markup)},t.ref.removeMarkup=function(){t.ref.markup&&(t.removeChildView(t.ref.markup),t.ref.markup=null)},t.ref.isModal=/modal/.test(t.query("GET_STYLE_LAYOUT_MODE"))},write:B({DID_PRESENT_IMAGE:function(e){e.root.ref.imageGL.colorOpacity=1}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.ref.imageGL,o=t.ref.markup,l=t.query("GET_CROP",n.id,r);if(l){var c=l.isDraft,u=l.cropRect,s=l.cropStatus,f=l.origin,d=l.translation,h=l.translationBand,p=l.scale,m=l.scaleBand,g=l.rotation,v=l.rotationBand,y=l.flip,E=l.colorMatrix,_=t.query("GET_ROOT"),w=t.query("GET_STAGE"),T=w.x,x=w.y;c&&(i.scale=null,i.zRotation=null,i.xTranslation=null,i.yTranslation=null,i.xOrigin=null,i.yOrigin=null),i.colorMatrix=E;var R=t.query("IS_ACTIVE_VIEW","crop"),A=t.query("IS_ACTIVE_VIEW","markup"),I=R?.75:.95,C=a({},u),b=1,O=R?1:5;if(t.query("IS_ACTIVE_VIEW","resize")){var M=s.image.width,S=s.image.height;b=null===M&&null===S?s.crop.width/u.width:null===M?S/u.height:M/u.width,b/=window.devicePixelRatio;var L=u.width*b,P=u.height*b;C.x=C.x+(.5*u.width-.5*L),C.y=C.y+(.5*u.height-.5*P),C.width=L,C.height=P}var G=t.ref.isModal?0:_.left,k=t.ref.isModal?0:_.top,D=t.ref.isModal?0:_.width-t.rect.element.width,U=t.ref.isModal?0:_.height-t.rect.element.height-n.offsetTop,V=(p+m)*b;i.isDraft=c,i.overlayOpacity=I,i.xOrigin=f.x,i.yOrigin=f.y,i.xTranslation=d.x+h.x+T,i.yTranslation=d.y+h.y+x,i.left=G,i.top=k+n.offsetTop,i.width=t.rect.element.width+D,i.height=t.rect.element.height+U+n.offsetTop,i.scale=V,i.xRotation=y.vertical?Math.PI:0,i.yRotation=y.horizontal?Math.PI:0,i.zRotation=g.main+g.sub+v,i.stage={x:w.x+G,y:w.y+k+n.offsetTop,width:w.width,height:w.height},i.overlay={x:C.x+T+G,y:C.y+x+k+n.offsetTop,width:C.width,height:C.height},i.outlineWidth=O,l.markup.length&&!o?o=t.ref.createMarkup():!l.markup.length&&o&&(t.ref.removeMarkup(),o=null),o&&(c&&(o.translateX=null,o.translateY=null,o.markupX=null,o.markupY=null,o.markupWidth=null,o.markupHeight=null),o.opacity=R?.3:1,o.markupX=C.x+T,o.markupY=C.y+x,o.markupWidth=C.width,o.markupHeight=C.height,o.allowInteraction=A)}})}),Xr=V({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(e){for(var t=e.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">',r=0;r<=180;r+=2){var i=r*(176/180)-90+2,o=r%10==0?.5:.2;n+='<circle fill="currentColor" cx="'.concat(i,'" cy="').concat(0,'" r="').concat(o,'"/>'),r%10==0&&(n+='<text fill="currentColor" x="'.concat(i+(i<0?-2.25:0===i?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+r,"&deg;</text>"))}n+="</svg>",t.element.innerHTML=n}}),Kr=V({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity","translateY"],animations:{opacity:{type:"spring",damping:.5,mass:5},translateY:"spring"},apis:["rotation","animate","setAllowInteraction"]},create:function(e){var t=e.root,n=e.props;t.element.setAttribute("tabindex",0);var r=document.createElement("button");r.innerHTML="<span>".concat(t.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),r.className="doka--crop-rotator-center",r.addEventListener("click",function(){t.dispatch("CROP_IMAGE_ROTATE_CENTER")}),t.appendChild(r);var i=null;t.appendChildView(t.createChildView(function(e,t){return V({name:e,ignoreRect:!0,create:t})}("crop-rotator-line-mask",function(e){var t=e.root,n=e.props;i=t.appendChildView(t.createChildView(Xr,{translateX:Math.round(312*n.rotation)}))}),n)),t.ref.line=i;var o=document.createElement("div");o.className="doka--crop-rotator-bar",t.appendChild(o);var a=Math.PI/4,l=0;t.ref.dragger=fr(o,function(){l=i.translateX/312,t.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(e,n){var r=n.x/t.rect.element.width*(Math.PI/2),i=xe(l+r,-a,a);t.dispatch("CROP_IMAGE_ROTATE",{value:-i})},function(){t.dispatch("CROP_IMAGE_ROTATE_RELEASE")},{stopPropagation:!0}),n.setAllowInteraction=function(e){e?t.ref.dragger.enable():t.ref.dragger.disable()},t.ref.keyboard=Ar(t.element,function(){l=0},{left:function(){l+=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:l})},right:function(){l-=Math.PI/128,t.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:l})}},function(){},function(){}),t.ref.prevRotation},destroy:function(e){var t=e.root;t.ref.dragger.destroy(),t.ref.keyboard.destroy()},write:function(e){var t=e.root,n=e.props,r=e.timestamp,i=n.animate,o=n.rotation;if(t.ref.prevRotation!==o){t.ref.prevRotation=o,i||0===o||(t.ref.line.translateX=null);var a=0,l=t.query("GET_CROP",n.id,r);if(l&&l.interaction&&l.interaction.rotation){var c=St(l.interaction.rotation).sub-o;a=.025*Math.sign(c)*Math.log10(1+Math.abs(c)/.025)}t.ref.line.translateX=Math.round(312*(-o-a))}}}),Qr=["nw","ne","se","sw"],Jr=["n","e","s","w"],$r=ve()&&1===window.devicePixelRatio?function(e){return Math.round(e)}:function(e){return e},ei=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),ti=function(e){return V({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(e),mixins:{styles:["translateX","translateY","scaleX","scaleY"],apis:["setAllowInteraction"]},create:function(t){var n=t.root,r=t.props;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button");var i=e,o=function(e){return Jr[(Jr.indexOf(e)+2)%Jr.length]}(e);n.ref.dragger=fr(n.element,function(){n.dispatch("CROP_RECT_DRAG_GRAB")},function(e,t){return n.dispatch("CROP_RECT_EDGE_DRAG",{offset:t,origin:i,anchor:o})},function(){return n.dispatch("CROP_RECT_DRAG_RELEASE")},{stopPropagation:!0,cancelOnMultiple:!0}),r.setAllowInteraction=function(e){e?n.ref.dragger.enable():n.ref.dragger.disable()},n.ref.keyboard=Ar(n.element,function(){return{x:0,y:0}},{up:function(e){e.y-=20},down:function(e){e.y+=20},left:function(e){e.x-=20},right:function(e){e.x+=20}},function(e){n.dispatch("CROP_RECT_DRAG_GRAB"),n.dispatch("CROP_RECT_EDGE_DRAG",{offset:e,origin:i,anchor:o})},function(){n.dispatch("CROP_RECT_DRAG_RELEASE")})},destroy:function(e){var t=e.root;t.ref.keyboard.destroy(),t.ref.dragger.destroy()}})},ni=function(e,t,n){return V({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(e),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:dr,translateY:dr,scaleX:{type:"spring",delay:n},scaleY:{type:"spring",delay:n},opacity:{type:"spring",delay:t}},apis:["setAllowInteraction"]},create:function(t){var n=t.root,r=t.props;n.element.classList.add("doka--crop-rect-corner"),n.element.setAttribute("role","button"),n.element.setAttribute("tabindex",-1);var i=e,o=function(e){return Qr[(Qr.indexOf(e)+2)%Qr.length]}(e);n.ref.dragger=fr(n.element,function(){n.dispatch("CROP_RECT_DRAG_GRAB")},function(e,t){n.dispatch("CROP_RECT_CORNER_DRAG",{offset:t,origin:i,anchor:o})},function(){n.dispatch("CROP_RECT_DRAG_RELEASE")},{stopPropagation:!0,cancelOnMultiple:!0}),r.setAllowInteraction=function(e){e?n.ref.dragger.enable():n.ref.dragger.disable()}},destroy:function(e){e.root.ref.dragger.destroy()}})},ri=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{apis:["rectangle","draft","rotating","enabled"]},create:function(e){var t=e.root;t.ref.wasRotating=!1,Qr.forEach(function(e,n){var r=10*n,i=250+r+50,o=250+r;t.ref[e]=t.appendChildView(t.createChildView(ni(e,i,o),{opacity:0,scaleX:.5,scaleY:.5}))}),Jr.forEach(function(e){t.ref[e]=t.appendChildView(t.createChildView(ti(e)))}),t.ref.lines=[];for(var n=0;n<10;n++)t.ref.lines.push(t.appendChildView(t.createChildView(ei,{opacity:0})));t.ref.animationDir=null,t.ref.previousRotating,t.ref.previousRect={},t.ref.previousEnabled,t.ref.previousDraft},write:function(e){var t=e.root,n=e.props,r=n.rectangle,i=n.draft,o=n.rotating,a=n.enabled;if(r&&(!Le(r,t.ref.previousRect)||o!==t.ref.previousRotating||a!==t.ref.previousEnabled||i!==t.ref.previousDraft)){t.ref.previousRect=r,t.ref.previousRotating=o,t.ref.previousEnabled=a,t.ref.previousDraft=i;var l=t.ref,c=l.n,u=l.e,s=l.s,f=l.w,d=l.nw,h=l.ne,p=l.se,m=l.sw,g=l.lines,v=l.animationDir,y=r.x,E=r.y,_=r.x+r.width,w=r.y+r.height,T=w-E,x=_-y,R=Math.min(x,T);t.element.dataset.indicatorSize=R<80?"none":"default",Jr.forEach(function(e){return t.ref[e].setAllowInteraction(a)}),Qr.forEach(function(e){return t.ref[e].setAllowInteraction(a)});var A=t.query("IS_ACTIVE_VIEW","crop");if(A&&"in"!==v?(t.ref.animationDir="in",Qr.map(function(e){return t.ref[e]}).forEach(function(e){e.opacity=1,e.scaleX=1,e.scaleY=1})):A||"out"===v||(t.ref.animationDir="out",Qr.map(function(e){return t.ref[e]}).forEach(function(e){e.opacity=0,e.scaleX=.5,e.scaleY=.5})),oi(i,d,y,E),oi(i,h,_,E),oi(i,p,_,w),oi(i,m,y,w),ii(i,c,y,E,x/100,1),ii(i,u,_,E,1,T/100),ii(i,s,y,w,x/100,1),ii(i,f,y,E,1,T/100),o){t.ref.wasRotating=!0;var I=g.slice(0,5),C=1/I.length;I.forEach(function(e,t){ii(i,e,y,E+T*(C+t*C),x/100,.01),e.opacity=.5});var b=g.slice(5);C=1/b.length,b.forEach(function(e,t){ii(i,e,y+x*(C+t*C),E,.01,T/100),e.opacity=.5})}else if(i){t.ref.wasRotating=!1;var O=g[0],M=g[1],S=g[2],L=g[3];ii(i,O,y,E+.333*T,x/100,.01),ii(i,M,y,E+.666*T,x/100,.01),ii(i,S,y+.333*x,E,.01,T/100),ii(i,L,y+.666*x,E,.01,T/100),O.opacity=.5,M.opacity=.5,S.opacity=.5,L.opacity=.5}else{var P=g[0],G=g[1],k=g[2],D=g[3];!t.ref.wasRotating&&P.opacity>0&&(ii(i,P,y,E+.333*T,x/100,.01),ii(i,G,y,E+.666*T,x/100,.01),ii(i,k,y+.333*x,E,.01,T/100),ii(i,D,y+.666*x,E,.01,T/100)),g.forEach(function(e){return e.opacity=0})}}}}),ii=function(e,t,n,r,i,o){e&&(t.translateX=null,t.translateY=null,t.scaleX=null,t.scaleY=null),t.translateX=$r(n),t.translateY=$r(r),t.scaleX=i,t.scaleY=o},oi=function(e,t,n,r){e&&(t.translateX=null,t.translateY=null),t.translateX=$r(n),t.translateY=$r(r)},ai=function(e,t){if(!/svg/.test(e.namespaceURI)||"innerHTML"in e)e.innerHTML=t;else{var n=document.createElement("div");n.innerHTML="<svg>"+t+"</svg>";for(var r=n.firstChild;r.firstChild;)e.appendChild(r.firstChild)}},li=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-mask",tag:"svg",mixins:{styles:["opacity","translateX","translateY"],animations:{scale:dr,maskWidth:dr,maskHeight:dr,translateX:dr,translateY:dr,opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","animate","maskWidth","maskHeight","scale"]},create:function(e){var t=e.root;t.customWriter=t.query("GET_CROP_MASK")(t.element,ai)||function(){}},didWriteView:function(e){var t=e.root,n=e.props,r=n.maskWidth,i=n.maskHeight,o=n.scale;if(r&&i){t.element.setAttribute("width",$r(r)),t.element.setAttribute("height",$r(i));var a=t.query("GET_CROP_MASK_INSET");t.customWriter({x:o*a,y:o*a,width:r-o*a*2,height:i-o*a*2},{width:r,height:i})}}}),ci=function(e,t){var n=e.childNodes[0];n?t!==n.nodeValue&&(n.nodeValue=t):(n=document.createTextNode(t),e.appendChild(n))},ui=V({ignoreRect:!0,name:"crop-size",mixins:{styles:["translateX","translateY","opacity"],animations:{translateX:"spring",translateY:"spring",opacity:"spring"},listeners:!0},create:function(e){var t=e.root,n=_("span");n.className="doka--crop-size-info doka--crop-resize-percentage",t.ref.resizePercentage=n,t.appendChild(n);var r=_("span");r.className="doka--crop-size-info";var i=_("span");i.className="doka--crop-size-multiply",i.textContent="\xd7";var o=_("span"),a=_("span");t.ref.outputWidth=o,t.ref.outputHeight=a,r.appendChild(o),r.appendChild(i),r.appendChild(a),t.appendChild(r),t.ref.previousValues={width:0,height:0,percentage:0}},write:function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=t.ref,l=a.outputWidth,c=a.outputHeight,u=a.resizePercentage,s=a.previousValues,f=o.image,d=o.crop,h=o.currentWidth,p=o.currentHeight,m=f.width?Math.round(f.width/d.width*100):0;h!==s.width&&(ci(l,h),s.width=h),p!==s.height&&(ci(c,p),s.height=p),m!==s.percentage&&(f.width?ci(u,"".concat(m,"%")):ci(u,""),s.percentage=m)}}}),si={type:"spring",stiffness:.4,damping:.65,mass:7},fi=V({name:"crop-subject",ignoreRect:!0,mixins:{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250},translateX:si,translateY:si}},create:function(e){var t=e.root,n=e.props;t.opacity=1,t.query("GET_CROP_MASK")&&(t.ref.maskView=t.appendChildView(t.createChildView(li))),t.ref.cropView=t.appendChildView(t.createChildView(ri)),t.query("GET_CROP_SHOW_SIZE")&&(t.ref.cropSize=t.appendChildView(t.createChildView(ui,{id:n.id,opacity:1,scaleX:1,scaleY:1,translateX:null}))),t.query("GET_CROP_ZOOM_TIMEOUT")||(t.ref.btnZoom=t.appendChildView(t.createChildView(Qn("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:Jn,label:t.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:$n('<g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g>',26),action:function(){return t.dispatch("CROP_ZOOM")}}]})))},write:B({CROP_RECT_DRAG_RELEASE:function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r),o=t.ref.btnZoom;if(o){var a=i.cropRect;o.translateX=a.x+.5*a.width,o.translateY=a.y+.5*a.height}}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){var o=t.ref,a=o.cropView,l=o.maskView,c=o.btnZoom,u=o.cropSize,s=i.cropRect,f=i.isRotating,d=i.isDraft,h=i.scale;if(t.query("IS_ACTIVE_VIEW","crop")){var p=t.query("GET_STAGE");if(t.translateX=p.x-t.rect.element.left,t.translateY=p.y-t.rect.element.top,a.draft=d,a.rotating=f,a.rectangle=s,a.enabled=!0,u){d&&(u.translateX=null,u.translateY=null);var m=di(t.rect.element,u.rect.element,s);u.translateX=d?m.x:$r(m.x),u.translateY=d?m.y:$r(m.y)}l&&(d&&(l.translateX=null,l.translateY=null,l.maskWidth=null,l.maskHeight=null),l.translateX=$r(s.x),l.translateY=$r(s.y),l.maskWidth=s.width,l.maskHeight=s.height,l.scale=h),c&&(c.opacity=i.canRecenter&&!i.isDraft?1:0)}else a.enabled=!1}})}),di=function(e,t,n){var r=n.x,i=n.x+n.width,o=n.y+n.height,a=i-t.width-16,l=o-t.height-16;return t.width>n.width-32&&(a=r+(.5*n.width-.5*t.width),(l=o+16)>e.height-t.height&&(l=o-t.height-16)),{x:a=Math.max(0,Math.min(a,e.width-t.width)),y:l}},hi=function(){return performance.now()},pi=function(e,t){var n=function(e,t){for(;1===e.nodeType&&!t(e);)e=e.parentNode;return 1===e.nodeType?e:null}(t,function(e){return e.classList.contains("doka--root")});return!!n&&n.contains(e)},mi=function(e){var t=e.root,n=e.props,r=e.action.position,i=n.pivotPoint,o=t.ref,a=o.indicatorA,l=o.indicatorB,c=i.x-r.x,u=i.y-r.y,s={x:i.x+c,y:i.y+u},f={x:i.x-c,y:i.y-u};a.style.cssText="transform: translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)"),l.style.cssText="transform: translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)")},gi=function(e){return{x:e.pageX,y:e.pageY}},vi=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint","scrollRect"]},create:function(e){var t=e.root,n=e.props;t.ref.isActive=!1,t.ref.isCropping=!1,t.ref.indicatorA=document.createElement("div"),t.appendChild(t.ref.indicatorA),t.ref.indicatorB=document.createElement("div"),t.appendChild(t.ref.indicatorB);var r=t.query("GET_CROP_RESIZE_KEY_CODES"),i={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},o=hi();t.ref.state=i;var l=lr(),c=0,u=!1;t.ref.resizeStart=function(e){if(t.ref.isActive&&(0===l.count()&&(u=!1),l.push(e),cr(document.documentElement,"up",t.ref.resizeEnd),pi(t.element,e.target)&&l.multiple())){e.stopPropagation(),e.preventDefault();var n=l.active(),r=gi(n[0]),i=gi(n[1]);c=be(r,i),cr(document.documentElement,"move",t.ref.resizeMove),u=!0}},t.ref.resizeMove=function(e){if(t.ref.isActive&&u&&(e.preventDefault(),2===l.count())){l.update(e);var n=l.active(),r=gi(n[0]),i=gi(n[1]),o=(be(r,i)-c)/c;t.dispatch("CROP_IMAGE_RESIZE",{value:o})}},t.ref.resizeEnd=function(e){if(t.ref.isActive){l.pop(e);var n=0===l.count();n&&(ur(document.documentElement,"move",t.ref.resizeMove),ur(document.documentElement,"up",t.ref.resizeEnd)),u&&(e.preventDefault(),n&&t.dispatch("CROP_IMAGE_RESIZE_RELEASE"))}},cr(document.documentElement,"down",t.ref.resizeStart);var s=performance.now(),f=0,d=1,h=function(e,t){var n=null,r=null;return function(){var i=arguments;if(!r)return e.apply(null,Array.from(arguments)),void(r=hi());clearTimeout(n),n=setTimeout(function(){hi()-r>=t&&(e.apply(null,Array.from(i)),r=hi())},t-(hi()-r))}}(function(e){if(!t.ref.isCropping){var n=Math.sign(e.wheelDelta||e.deltaY),r=hi(),i=r-s;s=r,(i>750||f!==n)&&(d=1,f=n),d+=.05*n,t.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,d)}),t.dispatch("CROP_IMAGE_RESIZE_RELEASE")}},100);t.ref.wheel=function(e){if(t.ref.isActive&&pi(t.element,e.target)){if(n.scrollRect){var r=n.scrollRect,i=t.query("GET_ROOT"),o=gi(e),a={x:o.x-i.leftScroll,y:o.y-i.topScroll};if(a.x<r.x||a.x>r.x+r.width||a.y<r.y||a.y>r.y+r.height)return}e.preventDefault(),h(e)}},document.addEventListener("wheel",t.ref.wheel,{passive:!1}),t.ref.move=function(e){if(t.ref.isActive&&!t.ref.isCropping&&(i.position.x=e.pageX-t.ref.state.offsetX,i.position.y=e.pageY-t.ref.state.scrollY-t.ref.state.offsetY,i.enabled))if(pi(t.element,e.target)){"idle"===t.element.dataset.state&&t.dispatch("RESIZER_SHOW",{position:a({},i.position)}),e.preventDefault(),t.dispatch("RESIZER_MOVE",{position:a({},i.position)});var r=n.pivotPoint,l=r.x-i.position.x,u=r.y-i.position.y,s={x:r.x+l,y:r.y+u},f=a({},i.position);if(i.selecting){var d=(be(s,f)-c)/c,h=performance.now();h-o>25&&(o=h,t.dispatch("CROP_IMAGE_RESIZE",{value:d}))}}else t.dispatch("RESIZER_CANCEL")},t.ref.select=function(e){if(t.ref.isActive&&pi(t.element,e.target)){var r=n.pivotPoint,o=r.x-i.position.x,a=r.y-i.position.y,l={x:r.x+o,y:r.y+a},u=i.position;c=be(l,u),i.selecting=!0,i.origin.x=e.pageX,i.origin.y=e.pageY,t.dispatch("CROP_IMAGE_RESIZE_GRAB")}},t.ref.confirm=function(e){t.ref.isActive&&pi(t.element,e.target)&&(i.selecting=!1,t.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},t.ref.blur=function(){t.ref.isActive&&(i.selecting=!1,i.enabled=!1,document.removeEventListener("mousedown",t.ref.select),document.removeEventListener("mouseup",t.ref.confirm),t.dispatch("RESIZER_CANCEL"))},window.addEventListener("blur",t.ref.blur),document.addEventListener("mousemove",t.ref.move),t.ref.keyDown=function(e){t.ref.isActive&&r.includes(e.keyCode)&&i.position&&(i.enabled=!0,document.addEventListener("mousedown",t.ref.select),document.addEventListener("mouseup",t.ref.confirm),t.dispatch("RESIZER_SHOW",{position:a({},i.position)}))},t.ref.keyUp=function(e){t.ref.isActive&&r.includes(e.keyCode)&&(i.enabled=!1,document.removeEventListener("mousedown",t.ref.select),document.removeEventListener("mouseup",t.ref.confirm),t.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",t.ref.keyDown),document.body.addEventListener("keyup",t.ref.keyUp)},destroy:function(e){var t=e.root;document.removeEventListener("touchmove",t.ref.resizeMove),document.removeEventListener("touchend",t.ref.resizeEnd),document.removeEventListener("touchstart",t.ref.resizeStart),document.removeEventListener("wheel",t.ref.wheel),document.removeEventListener("mousemove",t.ref.move),document.removeEventListener("mousedown",t.ref.select),document.removeEventListener("mouseup",t.ref.confirm),document.body.removeEventListener("keydown",t.ref.keyDown),document.body.removeEventListener("keyup",t.ref.keyUp),window.removeEventListener("blur",t.ref.blur)},read:function(e){var t=e.root;t.ref.state.scrollY=window.scrollY;var n=t.element.getBoundingClientRect();t.ref.state.offsetX=n.x,t.ref.state.offsetY=n.y},write:B({CROP_RECT_DRAG_GRAB:function(e){e.root.ref.isCropping=!0},CROP_RECT_DRAG_RELEASE:function(e){e.root.ref.isCropping=!1},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.ref.isActive="crop"===n.id},RESIZER_SHOW:function(e){var t=e.root,n=e.props,r=e.action;t.element.dataset.state="multi-touch",mi({root:t,props:n,action:r})},RESIZER_CANCEL:function(e){e.root.element.dataset.state="idle"},RESIZER_MOVE:mi})}),yi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"group",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["opacity"],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return V({ignoreRect:!0,name:e,mixins:{styles:["opacity"].concat(c(t)),animations:a({opacity:{type:"spring",stiffness:.25,damping:.5,mass:5}},n)},create:function(e){var t=e.root;e.props.controls.map(function(e){var n=t.createChildView(e.view,e);e.didCreateView&&e.didCreateView(n),t.appendChildView(n)})}})},Ei=V({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue","options","onSelect"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(e){var t=e.root,n=e.props;t.element.setAttribute("role","list"),t.ref.handleClick=function(){return n.action&&n.action()},t.element.addEventListener("click",t.ref.handleClick),t.ref.activeOptions=null,t.ref.activeSelectedValue},write:function(e){var t=e.root,n=e.props;if(n.options!==t.ref.activeOptions&&(t.ref.activeOptions=n.options,t.childViews.forEach(function(e){return t.removeChildView(e)}),n.options.map(function(e){var r=t.createChildView(Jn,a({},e,{action:function(){return n.onSelect(e.value)}}));return t.appendChildView(r)})),n.selectedValue!==t.ref.activeSelectedValue){t.ref.activeSelectedValue=n.selectedValue;var r=n.options.findIndex(function(e){return"object"===i(e.value)&&n.selectedValue?JSON.stringify(e.value)===JSON.stringify(n.selectedValue):e.value===n.selectedValue});t.childViews.forEach(function(e,t){e.element.setAttribute("aria-selected",t===r)})}},destroy:function(e){var t=e.root;t.element.removeEventListener("click",t.ref.handleClick)}}),_i=V({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{styles:["opacity"],animations:{opacity:"spring"},apis:["direction","selectedValue","options","onSelect"]},create:function(e){var t=e.root,n=e.props;t.ref.open=!1;var r=function(e){t.ref.open=e,t.dispatch("KICK")};t.ref.button=t.appendChildView(t.createChildView(Jn,a({},n,{action:function(){r(!t.ref.open)}}))),t.ref.list=t.appendChildView(t.createChildView(Ei,a({},n,{opacity:0,action:function(){r(!1)}}))),t.ref.handleBodyClick=function(e){t.element.contains(e.target)||r(!1)},t.element.addEventListener("focusin",function(e){e.target!==t.ref.button.element&&r(!0)}),t.element.addEventListener("focusout",function(e){t.element.contains(e.relatedTarget)||r(!1)}),document.body.addEventListener("click",t.ref.handleBodyClick)},destroy:function(e){var t=e.root;document.body.removeEventListener("click",t.ref.handleBodyClick)},write:function(e){var t=e.root,n=e.props;if(t.ref.list.opacity=t.ref.open?1:0,t.ref.list.selectedValue=n.selectedValue,t.ref.list.options=n.options,"up"===n.direction){var r=t.ref.list.rect.element.height;t.ref.list.translateY=(t.ref.open?-(r+5):-r)-t.rect.element.height}else t.ref.list.translateY=t.ref.open?0:-5}}),wi=function(e,t){return e.style.opacity=t},Ti=function(e,t){var n=Array.from(e.element.querySelectorAll(".doka--icon-crop-limit rect"));n.length&&(wi(n[0],t?.3:0),wi(n[1],t?1:0),wi(n[2],t?0:.3),wi(n[3],t?0:1))},xi=function(e,t){var n=e.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!t)return wi(n[0],.2),wi(n[1],.3),void wi(n[2],.4);wi(n[0],t>1?1:.3),wi(n[1],1===t?.85:.5),wi(n[2],t<1?1:.3)}},Ri=function(e){var t,n;e>1?(n=14,t=Math.round(n/e)):(t=14,n=Math.round(t*e));var r=Math.round(.5*(23-t)),i=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="'.concat(r,'" y="').concat(i,'" width="').concat(t,'" height="').concat(n,'" rx="2.5"/></g></svg>')},Ai=V({name:"crop",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden","offsetTop"]},create:function(e){var t=e.root,n=e.props;n.viewId="crop",n.hidden=!1,t.ref.isHiding=!1;var r=[];t.query("GET_CROP_ALLOW_IMAGE_TURN_LEFT")&&r.push({view:Jn,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:$n('<g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g>',26),action:function(){return t.dispatch("CROP_IMAGE_ROTATE_LEFT")}}),t.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&r.push({view:Jn,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:$n('<g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g>',26),action:function(){return t.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),t.query("GET_CROP_ALLOW_IMAGE_FLIP_HORIZONTAL")&&r.push({view:Jn,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:$n('<g fill="currentColor" fill-rule="evenodd"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g>',26),action:function(){return t.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}}),t.query("GET_CROP_ALLOW_IMAGE_FLIP_HORIZONTAL")&&r.push({view:Jn,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:$n('<g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g>',26),action:function(){return t.dispatch("CROP_IMAGE_FLIP_VERTICAL")}});var i=t.query("GET_CROP_ASPECT_RATIO_OPTIONS");i&&i.length&&r.push({view:_i,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:$n('<g class="doka--icon-aspect-ratio" fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g>',26),options:null,onSelect:function(e){e.width&&e.height?t.dispatch("RESIZE_SET_OUTPUT_SIZE",{width:e.width,height:e.height}):(t.query("GET_CROP_ASPECT_RATIO_OPTIONS").find(function(e){return e.value&&e.value.width||e.value.height})&&t.dispatch("RESIZE_SET_OUTPUT_SIZE",{width:null,height:null}),t.dispatch("CROP_SET_ASPECT_RATIO",{value:e.aspectRatio}))},didCreateView:function(e){t.ref.aspectRatioDropdown=e}}),t.query("GET_CROP_ALLOW_TOGGLE_LIMIT")&&r.push({view:_i,name:"tool",label:t.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT"),icon:$n('<g class="doka--icon-crop-limit" fill="currentColor" fill-rule="evenodd">\n                    <rect x="2" y="3" width="20" height="20" rx="1"/>\n                    <rect x="7" y="8" width="10" height="10" rx="1"/>\n                    <rect x="4" y="8" width="14" height="14" rx="1"/>\n                    <rect x="12" y="4" width="10" height="10" rx="1"/>\n                </g>',26),options:[{value:!0,label:t.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT_ENABLE"),icon:'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="3" y="3" width="17" height="17" rx="2.5" opacity=".3"/><rect x="7" y="7" width="9" height="9" rx="2.5"/></g></svg>'},{value:!1,label:t.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT_DISABLE"),icon:'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="3" y="6" width="13" height="13" rx="2.5" opacity=".3"/><rect x="10" y="3" width="9" height="9" rx="2.5"/></g></svg>'}],onSelect:function(e){t.dispatch("CROP_SET_LIMIT",{value:e})},didCreateView:function(e){t.ref.cropToggleLimitDropdown=e}}),t.ref.menu=t.appendChildView(t.createChildView(yi("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:50}}),{opacity:0,controls:r})),t.ref.menuItemsRequiredWidth=null,t.ref.subject=t.appendChildView(t.createChildView(fi,a({},n))),t.ref.rotator=t.appendChildView(t.createChildView(Kr,{rotation:0,opacity:0,translateY:20,id:n.id})),t.ref.resizer=t.appendChildView(t.createChildView(vi,{pivotPoint:{x:0,y:0}})),t.ref.updateControls=function(){var e=t.query("GET_IMAGE");if(function(e,t){Array.from(e.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(e){t>1&&(e.setAttribute("x",e.previousElementSibling?5:4),e.setAttribute("width",9)),t<1&&(e.setAttribute("y",11),e.setAttribute("height",10))})}(t,e.height/e.width),t.ref.cropToggleLimitDropdown&&(t.ref.isLimitedToImageBounds=t.query("GET_CROP_LIMIT_TO_IMAGE_BOUNDS"),Ti(t,t.ref.isLimitedToImageBounds),t.ref.cropToggleLimitDropdown.selectedValue=t.ref.isLimitedToImageBounds),t.ref.aspectRatioDropdown){var n=t.query("GET_MIN_IMAGE_SIZE"),r=i.filter(function(t){if(!t.value.aspectRatio)return!0;if(t.value.aspectRatio<1){if(e.naturalWidth*t.value.aspectRatio<n.height)return!1}else if(e.naturalHeight/t.value.aspectRatio<n.width)return!1;return!0});t.ref.aspectRatioDropdown.options=r.map(function(e){return a({},e,{icon:Ri(e.value.aspectRatio)})})}},t.ref.isModal=/modal|fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE"))},read:function(e){var t=e.root,n=e.props;if(n.hidden)t.ref.menuItemsRequiredWidth=null;else{var r=t.rect;if(0!==r.element.width&&0!==r.element.height){if(null===t.ref.menuItemsRequiredWidth){var i=t.ref.menu.childViews.reduce(function(e,t){return e+t.rect.outer.width},0);t.ref.menuItemsRequiredWidth=0===i?null:i}var o=t.ref.subject.rect.element,a=o.left,l=o.top,c=o.width,u=o.height;n.stagePosition={x:a,y:l,width:c,height:u}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:B({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props,i=t.ref,o=i.menu,a=i.rotator,l=i.subject;r.viewId===n.id?(l.opacity=1,o.opacity=1,a.opacity=1,a.translateY=0,r.hidden=!1,t.ref.isHiding=!1,t.ref.updateControls()):(l.opacity=0,o.opacity=0,a.opacity=0,a.translateY=20,t.ref.isHiding=!0)},UNLOAD_IMAGE:function(e){var t=e.root.ref,n=t.menu,r=t.rotator;n.opacity=0,r.opacity=0,r.translateY=20},DID_PRESENT_IMAGE:function(e){var t=e.root,n=t.ref,r=n.menu,i=n.rotator;r.opacity=1,i.opacity=1,i.translateY=0,t.ref.updateControls()}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.ref,o=i.resizer,a=i.subject,l=i.menu,c=i.rotator,u=i.isHiding,s=i.cropToggleLimitDropdown,f=i.aspectRatioDropdown,d=n.hidden,h=0===a.opacity&&0===l.opacity&&0===c.opacity;if(!d&&u&&h&&(t.ref.isHiding=!1,n.hidden=!0),!n.hidden){var p=t.query("GET_CROP",n.id,r);if(p){if(f){var m=t.query("GET_ACTIVE_CROP_ASPECT_RATIO"),g=t.query("GET_SIZE"),v=f.selectedValue;v?(v.aspectRatio!==m&&xi(t,m),v.aspectRatio===m&&v.width===g.width&&v.height===g.height||(f.selectedValue={aspectRatio:m,width:g.width,height:g.height})):(f.selectedValue={aspectRatio:m,width:g.width,height:g.height},xi(t,m))}if(s&&t.ref.isLimitedToImageBounds!==p.isLimitedToImageBounds&&(t.ref.isLimitedToImageBounds=p.isLimitedToImageBounds,Ti(t,p.isLimitedToImageBounds),s.selectedValue=p.isLimitedToImageBounds),o.pivotPoint={x:.5*o.rect.element.width,y:.5*o.rect.element.height},c.animate=!p.isDraft,c.rotation=p.rotation.sub,c.setAllowInteraction(t.query("IS_ACTIVE_VIEW","crop")),l.element.dataset.layout=t.ref.menuItemsRequiredWidth>t.ref.menu.rect.element.width?"compact":"spacious",t.query("GET_CROP_RESIZE_SCROLL_RECT_ONLY")){var y=t.query("GET_STAGE"),E=y.x,_=y.y,w=t.query("GET_ROOT"),T=t.ref.isModal?w.left:0,x=t.ref.isModal?w.top:0;o.scrollRect={x:T+E+p.cropRect.x,y:x+_+p.cropRect.y+n.offsetTop,width:p.cropRect.width,height:p.cropRect.height}}}}})}),Ii=V({name:"size-input",mixins:{listeners:!0,apis:["id","value","placeholder","getValue","setValue","setPlaceholder","hasFocus","onChange"]},create:function(e){var t=e.root,n=e.props,r=n.id,i=n.min,o=n.max,a=n.value,l=n.placeholder,c=n.onChange,u=void 0===c?function(){}:c,s=n.onBlur,f=void 0===s?function(){}:s,d="doka--".concat(r,"-").concat(ae()),h=_("input",{type:"number",step:1,id:d,min:i,max:o,value:a,placeholder:l}),p=h.getAttribute("max").length,m=_("label",{for:d});m.textContent=n.label;var g=function(e,t,n){return Y(e)?((e=e.replace(/[^0-9]/g,"")).length>p&&(e=e.slice(0,p)),e=parseInt(e,10)):e=Math.round(e),isNaN(e)?null:xe(e,t,n)},v=function(e){return e.length?parseInt(h.value,10):null};t.ref.handleInput=function(){h.value=g(h.value,1,o),u(v(h.value))},t.ref.handleBlur=function(){h.value=g(h.value,i,o),f(v(h.value))},h.addEventListener("input",t.ref.handleInput),h.addEventListener("blur",t.ref.handleBlur),t.appendChild(h),t.appendChild(m),t.ref.input=h,n.hasFocus=function(){return h===document.activeElement},n.getValue=function(){return v(h.value)},n.setValue=function(e){return h.value=e?g(e,1,999999):null},n.setPlaceholder=function(e){return h.placeholder=e}},destroy:function(e){var t=e.root;t.ref.input.removeEventListener("input",t.ref.handleInput),t.ref.input.removeEventListener("blur",t.ref.handleBlur)}}),Ci=V({name:"checkable",tag:"span",mixins:{listeners:!0,apis:["id","checked","onChange","onSetValue","setValue","getValue"]},create:function(e){var t=e.root,n=e.props,r=n.id,i=n.checked,o=n.onChange,a=void 0===o?function(){}:o,l=n.onSetValue,c=void 0===l?function(){}:l,u="doka--".concat(r,"-").concat(ae()),s=_("input",{type:"checkbox",value:1,id:u});s.checked=i,t.ref.input=s;var f=_("label",{for:u});f.innerHTML=n.label,t.appendChild(s),t.appendChild(f),t.ref.handleChange=function(){c(s.checked),a(s.checked)},s.addEventListener("change",t.ref.handleChange),n.getValue=function(){return s.checked},n.setValue=function(e){s.checked=e,c(s.checked)},setTimeout(function(){c(s.checked)},0)},destroy:function(e){var t=e.root;t.ref.input.removeEventListener("change",t.ref.handleChange)}}),bi=null,Oi=V({ignoreRect:!0,name:"resize-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15,delay:150}}},create:function(e){var t=e.root;t.element.setAttribute("novalidate","novalidate"),t.element.setAttribute("action","#"),t.ref.shouldBlurKeyboard=Ee()||(null===bi&&(bi=/Android/i.test(navigator.userAgent)),bi);var n=t.query("GET_SIZE_MAX"),r=t.query("GET_SIZE_MIN"),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.axisLock,o=void 0===i?"none":i,a=e.enforceLimits,l=void 0!==a&&a,c=t.ref,u=c.inputImageWidth,s=c.inputImageHeight,f=c.buttonConfirm,d=t.query("GET_SIZE_ASPECT_RATIO_LOCK"),h=t.query("GET_CROP_RECTANGLE_ASPECT_RATIO"),p={width:u.getValue(),height:s.getValue()},m=nt(p,l?r:{width:1,height:1},l?n:{width:999999,height:999999},d?h:null,o);if(d)"width"===o?s.setValue(m.width/h):"height"===o?u.setValue(m.height*h):(u.setValue(m.width||m.height*h),s.setValue(m.height||m.width/h));else if(m.width&&!m.height){var g=Math.round(m.width/h),v=nt({width:m.width,height:g},l?r:{width:1,height:1},l?n:{width:999999,height:999999},h,o);l&&u.setValue(Math.round(v.width)),s.setPlaceholder(Math.round(v.height))}else if(m.height&&!m.width){var y=Math.round(m.height*h);u.setPlaceholder(y)}var E=t.query("GET_SIZE_INPUT"),_=E.width,w=E.height,T=C(_)?Math.round(_):null,x=C(w)?Math.round(w):null,R=u.getValue(),A=s.getValue(),I=R!==T||A!==x;return f.opacity=I?1:0,t.dispatch("KICK"),{width:u.getValue(),height:s.getValue()}},o=t;t.appendChildView(t.createChildView(Mi("Image size",function(e){var t=e.root,a=t.query("GET_SIZE"),l=t.appendChildView(t.createChildView(Ii,{id:"image-width",label:"Width",value:C(a.width)?Math.round(a.width):null,min:r.width,max:n.width,placeholder:0,onChange:function(){return i({axisLock:"width"})},onBlur:function(){return i({enforceLimits:!1})}})),c=t.appendChildView(t.createChildView(Ci,{id:"aspect-ratio-lock",label:$n('<g fill="none" fill-rule="evenodd"><path stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="doka--aspect-ratio-lock-ring" d="M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V14"/><rect fill="currentColor" x="7" y="10" width="10" height="7" rx="1.5"/></g>'),checked:t.query("GET_SIZE_ASPECT_RATIO_LOCK"),onSetValue:function(e){var t=e?0:-3;c.element.querySelector(".doka--aspect-ratio-lock-ring").setAttribute("transform","translate(0 ".concat(t,")"))},onChange:function(e){t.dispatch("RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK",{value:e}),i()}})),u=t.appendChildView(t.createChildView(Ii,{id:"image-height",label:"Height",value:C(a.height)?Math.round(a.height):null,min:r.height,max:n.height,placeholder:0,onChange:function(){return i({axisLock:"height"})},onBlur:function(){return i({enforceLimits:!1})}}));o.ref.aspectRatioLock=c,o.ref.inputImageWidth=l,o.ref.inputImageHeight=u}))),t.ref.buttonConfirm=t.appendChildView(t.createChildView(Jn,{name:"app action-confirm icon-only",label:"Apply",action:function(){},opacity:0,icon:$n('><polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),type:"submit"})),t.ref.confirmForm=function(e){var n=i({enforceLimits:!0});e.preventDefault();var r=t.ref,o=r.shouldBlurKeyboard,a=r.buttonConfirm;o&&(document.activeElement.blur(),a.element.focus()),a.opacity=0,t.dispatch("RESIZE_SET_OUTPUT_SIZE",n)},t.element.addEventListener("submit",t.ref.confirmForm)},destroy:function(e){var t=e.root;t.element.removeEventListener("submit",t.ref.confirmForm)},write:B({EDIT_RESET:function(e){var t=e.root,n=t.query("GET_SIZE"),r=t.ref,i=r.inputImageWidth,o=r.inputImageHeight,a=r.aspectRatioLock,l=r.buttonConfirm;i.setValue(n.width),o.setValue(n.height),a.setValue(t.query("GET_SIZE_ASPECT_RATIO_LOCK")),l.opacity=0},RESIZE_SET_OUTPUT_SIZE:function(e){var t=e.root,n=e.action,r=t.ref,i=r.inputImageWidth,o=r.inputImageHeight;i.setValue(n.width),o.setValue(n.height)},CROP_SET_ASPECT_RATIO:function(e){var t=e.root,n=e.props,r=e.action,i=e.timestamp,o=t.query("GET_CROP",n.id,i);if(o){var a=o.cropStatus,l=t.ref,c=l.inputImageWidth,u=l.inputImageHeight;null!==r.value?(c.setValue(a.image.width),c.setPlaceholder(a.crop.width),u.setValue(a.image.height),u.setPlaceholder(a.crop.height)):c.getValue()&&u.getValue()&&(u.setValue(null),u.setPlaceholder(a.crop.height))}}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=t.ref,l=a.inputImageWidth,c=a.inputImageHeight;if(!l.hasFocus()&&!c.hasFocus()){var u=t.query("GET_CROP_RECTANGLE_ASPECT_RATIO");if(null===l.getValue()&&null===c.getValue())l.setPlaceholder(o.crop.width),c.setPlaceholder(o.crop.height);else if(null===l.getValue()&&null!==o.image.height){var s=Math.round(o.image.height*u);l.setPlaceholder(s)}else if(null===c.getValue()&&null!==o.image.width){var f=Math.round(o.image.width/u);c.setPlaceholder(f)}}}})}),Mi=function(e,t){return V({tag:"fieldset",create:function(n){var r=n.root,i=_("legend");i.textContent=e,r.element.appendChild(i),t({root:r})}})},Si=V({name:"resize",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(e){var t=e.root,n=e.props;n.viewId="resize",n.hidden=!1,t.ref.isHiding=!1,t.ref.form=t.appendChildView(t.createChildView(Oi,{opacity:0,id:n.id}))},read:function(e){var t=e.root,n=e.props;if(!n.hidden){var r=t.rect;if(0!==r.element.width&&0!==r.element.height){var i=t.ref.form.rect;n.stagePosition={x:r.element.left,y:r.element.top+i.element.height,width:r.element.width,height:r.element.height-i.element.height}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:B({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props;n.id===r.viewId?(t.ref.isHiding=!1,t.ref.form.opacity=1):(t.ref.isHiding=!0,t.ref.form.opacity=0)}},function(e){var t=e.root,n=e.props,r=t.ref,i=r.form,o=r.isHiding,a=n.hidden;o&&0===i.opacity&&!a?n.hidden=!0:n.hidden=!1})}),Li=V({name:"range-input",tag:"span",mixins:{listeners:!0,apis:["onUpdate","setValue","getValue","setAllowInteraction"]},create:function(e){var t=e.root,n=e.props,r=n.id,i=n.min,o=n.max,a=n.step,l=n.value,c=n.onUpdate,u=void 0===c?function(){}:c,s="doka--".concat(r,"-").concat(ae()),f=_("input",{type:"range",id:s,min:i,max:o,step:a});f.value=l,t.ref.input=f;var d=_("span");d.className="doka--range-input-inner";var h=_("label",{for:s});h.innerHTML=n.label;var p=i+.5*(o-i);t.element.dataset.centered=l===p,t.ref.handleRecenter=function(){n.setValue(p),t.ref.handleChange()};var m=_("button",{type:"button"});m.textContent="center",m.addEventListener("click",t.ref.handleRecenter),t.ref.recenter=m,d.appendChild(f),d.appendChild(m),t.appendChild(h),t.appendChild(d),t.ref.handleChange=function(){var e=n.getValue();t.element.dataset.centered=e===p,u(e)},f.addEventListener("input",t.ref.handleChange);var g=null;t.ref.dragger=fr(d,function(){g=f.getBoundingClientRect()},function(e){var n=(e.pageX-g.left)/g.width;f.value=i+n*(o-i),t.ref.handleChange()},function(){},{stopPropagation:!0}),n.getValue=function(){return parseFloat(f.value)},n.setValue=function(e){return f.value=e},n.setAllowInteraction=function(e){e?t.ref.dragger.enable():t.ref.dragger.disable()}},destroy:function(e){var t=e.root;t.ref.dragger.destroy(),t.ref.recenter.removeEventListener("click",t.ref.handleRecenter),t.ref.input.removeEventListener("input",t.ref.handleChange)}}),Pi={brightness:{icon:$n('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="7"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></g>')},contrast:{icon:$n('<g fill="none" fill-rule="evenodd"><circle stroke="currentColor" stroke-width="3" cx="12" cy="12" r="10"/><path d="M12 2v20C6.477 22 2 17.523 2 12S6.477 2 12 2z" fill="currentColor"/></g>')},exposure:{icon:$n('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path d="M20.828 3.172L3.172 20.828A3.987 3.987 0 0 1 2 18V6a4 4 0 0 1 4-4h12c1.105 0 2.105.448 2.828 1.172zM7 7H5v2h2v2h2V9h2V7H9V5H7v2zM12 15h5v2h-5z" fill="currentColor"/></g>')},saturation:{icon:$n('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path fill="currentColor" opacity=".3" d="M7 2.5h5v18.75H7z"/><path fill="currentColor" opacity=".6" d="M12 2.5h5v18.75h-5z"/><path fill="currentColor" opacity=".9" d="M17 2.5h4v18.75h-4z"/></g>')}},Gi=V({ignoreRect:!0,name:"color-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15}}},create:function(e){var t=e.root;t.element.setAttribute("novalidate","novalidate");var n=t.query("GET_COLOR_VALUES");t.ref.tools=Object.keys(Pi).reduce(function(e,r){var i=r,o=Pi[r].icon,a=t.query("GET_LABEL_COLOR_".concat(r.toUpperCase())),l=t.query("GET_COLOR_".concat(r.toUpperCase(),"_RANGE")),c=n[r];return e[i]={view:t.appendChildView(t.createChildView(Li,{id:i,label:"".concat(o,"<span>").concat(a,"</span>"),min:l[0],max:l[1],step:.01,value:c,onUpdate:function(e){return t.dispatch("COLOR_SET_COLOR_VALUE",{key:i,value:e})}}))},e},{})},write:B({COLOR_SET_VALUE:function(e){var t=e.root,n=e.action;t.ref.tools[n.key].view.setValue(n.value)},SHOW_VIEW:function(e){var t=e.root,n=e.action;Object.keys(t.ref.tools).forEach(function(e){t.ref.tools[e].view.setAllowInteraction("color"===n.id)})}})}),ki=null,Di=null,Ui=function(e,t){var n=t.brightness,r=t.exposure,i=t.contrast,o=t.saturation;if(0!==n){var a=n<0,l=a?"multiply":"overlay",c=a?0:255,u=a?Math.abs(n):1-n;e.ref.imageOverlay.style.cssText="mix-blend-mode: ".concat(l,"; background: rgba(").concat(c,",").concat(c,",").concat(c,",").concat(u,")")}return e.ref.imageOverlay.style.cssText="background:transparent",e.ref.image.style.cssText="filter: brightness(".concat(r,") contrast(").concat(i,") saturate(").concat(o,")"),t},Vi=Object.keys(Pi),Bi=function(e){return V({ignoreRect:!0,tag:"li",name:"filter-tile",mixins:{styles:["opacity","translateY"],animations:{translateY:{type:"spring",delay:10*e},opacity:{type:"spring",delay:30*e}}},create:function(e){var t=e.root,n=e.props,r="doka--filter-".concat(n.style,"-").concat(ae()),i=_("input",{id:r,type:"radio",name:"filter"});t.appendChild(i),i.checked=n.selected,i.value=n.style,i.addEventListener("change",function(){i.checked&&n.onSelect()});var o=_("label",{for:r});o.textContent=n.label,t.appendChild(o);var a=n.imageData,l=Math.min(a.width,a.height),c=l,u=_("canvas");u.width=l,u.height=c;var s=u.getContext("2d");t.ref.image=u;var f=_("div");t.ref.imageOverlay=f;var d={x:.5*l-.5*a.width,y:.5*c-.5*a.height},h=_("div");h.appendChild(u),h.appendChild(f),t.appendChild(h),t.ref.imageWrapper=h,n.matrix?(ki||(ki=hn(un)),clearTimeout(Di),ki.post({transforms:[{type:"filter",data:n.matrix}],imageData:a},function(e){s.putImageData(e,d.x,d.y),clearTimeout(Di),Di=setTimeout(function(){ki.terminate(),ki=null},1e3)},[a.data.buffer]),t.ref.activeColors=Ui(t,t.query("GET_COLOR_VALUES"))):s.putImageData(a,d.x,d.y)},write:function(e){var t=e.root,n=t.query("GET_COLOR_VALUES"),r=t.ref.activeColors;(!r&&n||!function(e,t){return Vi.findIndex(function(n){return e[n]!==t[n]})<0}(r,n))&&(t.ref.activeColors=n,Ui(t,n))}})},Ni=function(e){var t;try{t=new ImageData(e.width,e.height)}catch(n){t=document.createElement("canvas").getContext("2d").createImageData(e.width,e.height)}return t.data.set(new Uint8ClampedArray(e.data)),t},zi=function(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(function(e,n){return e===t[n]})},Fi=V({ignoreRect:!0,tag:"ul",name:"filter-list",mixins:{apis:["filterOpacity"]},create:function(e){var t=e.root,n=e.props;t.element.setAttribute("role","list"),t.ref.tiles=[];var r=t.query("GET_THUMB_IMAGE_DATA"),i=t.query("GET_FILTERS"),o=[];p(i,function(e,t){o.push(a({id:e},t))}),t.ref.activeFilter=t.query("GET_FILTER"),t.ref.tiles=o.map(function(e,i){var o=e.matrix(),a=t.ref.activeFilter===e.id||zi(t.ref.activeFilter,o)||0===i;return t.appendChildView(t.createChildView(Bi(i),{opacity:0,translateY:-5,id:n.id,style:e.id,label:e.label,matrix:o,imageData:Ni(r),selected:a,onSelect:function(){return t.dispatch("FILTER_SET_FILTER",{value:o?e.id:null})}}))})},write:function(e){var t=e.root,n=e.props,r=t.query("GET_FILTER");if(r!==t.ref.activeFilter){t.ref.activeFilter=r;var i=t.query("GET_FILTERS"),o=r?Y(r)?r:Cn(r)?Object.keys(i).find(function(e){return zi(i[e].matrix(),r)}):null:"original";Array.from(t.element.querySelectorAll("input")).forEach(function(e){return e.checked=e.value===o})}t.query("IS_ACTIVE_VIEW","filter")?t.ref.tiles.forEach(function(e){e.opacity=1,e.translateY=0}):t.ref.tiles.forEach(function(e){e.opacity=0,e.translateY=-5}),n.filterOpacity=t.ref.tiles.reduce(function(e,t){return e+t.opacity},0)/t.ref.tiles.length}}),Wi=V({name:"filter",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(e){var t=e.root,n=e.props;n.viewId="filter",n.hidden=!1,t.ref.isHiding=!1,t.ref.filters=t.appendChildView(t.createChildView(Fi,{id:n.id}))},read:function(e){var t=e.root,n=e.props;if(t.ref.filters&&!n.hidden){var r=t.rect;if(0!==r.element.width&&0!==r.element.height){var i=t.ref.filters.rect,o=0===i.element.top,a=o?r.element.top+i.element.height:r.element.top,l=o?r.element.height-i.element.height:r.element.height-i.element.height-r.element.top;n.stagePosition={x:r.element.left+i.element.left,y:a,width:r.element.width-i.element.left,height:l}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:B({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props;t.ref.filters&&(n.id===r.viewId?(t.ref.isHiding=!1,r.hidden=!1):t.ref.isHiding=!0)}},function(e){var t=e.root,n=e.props;t.ref.isHiding&&0===t.ref.filters.filterOpacity&&(t.ref.isHiding=!1,n.hidden=!0)})}),qi=V({name:"color",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(e){var t=e.root,n=e.props;n.viewId="color",n.hidden=!1,t.ref.isHiding=!1,t.ref.form=t.appendChildView(t.createChildView(Gi,{opacity:0,id:n.id}))},read:function(e){var t=e.root,n=e.props;if(!n.hidden){var r=t.rect;if(0!==r.element.width&&0!==r.element.height){var i=t.ref.form.rect,o=i.element.height,a=0===i.element.top,l=a?r.element.top+o:r.element.top,c=a?r.element.height-o:r.element.height-o-r.element.top;n.stagePosition={x:r.element.left+i.element.left,y:l,width:r.element.width-i.element.left,height:c}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:B({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props;n.id===r.viewId?(t.ref.isHiding=!1,t.ref.form.opacity=1,r.hidden=!1):(t.ref.isHiding=!0,t.ref.form.opacity=0)}},function(e){var t=e.root,n=e.props;t.ref.isHiding&&0===t.ref.form.opacity&&(t.ref.isHiding=!1,n.hidden=!0)})}),Yi=V({ignoreRect:!0,tag:"ul",name:"markup-color",mixins:{animations:{opacity:"spring"},styles:["opacity"],apis:["onSelect","setSelectedValue"]},create:function(e){var t=e.root,n=e.props,r=n.colors,i=n.name,o=n.onSelect;n.setSelectedValue=function(e){t.ref.inputs.forEach(function(t){t.checked=t.value===e})},t.element.addEventListener("change",function(e){o(e.target.value),e.stopPropagation()}),t.ref.inputs=r.map(function(e){var n="doka--color-"+ae(),r=_("li"),o=_("input");o.id=n,o.setAttribute("type","radio"),o.setAttribute("name",i),o.value=e[1];var a=_("label");return a.setAttribute("for",n),a.textContent=e[0],a.title=e[0],a.style.backgroundColor=e[2]||e[1],r.appendChild(o),r.appendChild(a),t.element.appendChild(r),o})}}),Hi=["fontFamily","fontSize","fontWeight","textAlign","backgroundColor","fontColor","borderColor","borderWidth","borderStyle","lineColor","lineWidth","lineDecoration","lineJoin","lineCap"],ji=function(e){return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">'.concat(e,"</svg>")},Zi=function(e){var t=0===e?"currentColor":"none",n=e;return ji('<rect stroke="'.concat(0===e?"none":"currentColor",'" fill="').concat(t,'" stroke-width="').concat(n,'" x="2" y="3" width="17" height="17" rx="3"/>'))},Xi=function(e){return ji('<line stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width="'.concat(e,'" x1="3" y1="12" x2="20" y2="12"/>'))},Ki=V({name:"markup-tools",ignoreRect:!0,mixins:{apis:["onUpdate"],animations:{translateY:"spring",opacity:"spring"},styles:["translateY","opacity"]},create:function(e){var t=e.root,n=e.props.onUpdate;t.ref.activeMarkup=null;var r=function(e){t.ref.activeMarkup&&n(t.ref.activeMarkup[1].id,e)};t.ref.colorSelect=t.appendChildView(t.createChildView(Yi,{onSelect:function(e){var n={};n[Qi(t.ref.activeMarkup[1])]=e,r(n)},name:"color-select",colors:t.query("GET_MARKUP_COLOR_OPTIONS")})),t.ref.shapeStyleSelect=t.appendChildView(t.createChildView(_i,{onSelect:function(e){t.ref.shapeStyleSelect.selectedValue=e;var n=Ji(t.ref.activeMarkup[1]),i=e[1],o=e[2],a=e[3]?null:n;r({borderWidth:i,borderStyle:o,backgroundColor:a,borderColor:n})},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_SHAPE_STYLE"),direction:"up",options:t.query("GET_MARKUP_SHAPE_STYLE_OPTIONS").map(function(e){return{value:e,label:e[0],icon:Zi(e[3])}})})),t.ref.lineStyleSelect=t.appendChildView(t.createChildView(_i,{onSelect:function(e){t.ref.lineStyleSelect.selectedValue=e;var n=e[1],i=e[2];r({lineWidth:n,lineStyle:i})},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_LINE_STYLE"),direction:"up",options:t.query("GET_MARKUP_LINE_STYLE_OPTIONS").map(function(e){return{value:e,label:e[0],icon:Xi(e[3])}})})),t.ref.lineDecorationSelect=t.appendChildView(t.createChildView(_i,{onSelect:function(e){t.ref.lineDecorationSelect.selectedValue=e,r({lineDecoration:e})},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_LINE_DECORATION"),direction:"up",options:t.query("GET_MARKUP_LINE_DECORATION_OPTIONS").map(function(e){return{value:e[1],label:e[0]}})})),t.ref.fontFamilySelect=t.appendChildView(t.createChildView(_i,{onSelect:function(e){t.ref.fontFamilySelect.selectedValue=e,r({fontFamily:e})},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_FONT_FAMILY"),direction:"up",options:t.query("GET_MARKUP_FONT_FAMILY_OPTIONS").map(function(e){return{value:e[1],label:'<span style="font-family:'.concat(e[1],';font-weight:600;">').concat(e[0],"</span>")}})})),t.ref.fontSizeSelect=t.appendChildView(t.createChildView(_i,{onSelect:function(e){t.ref.fontSizeSelect.selectedValue=e,r({fontSize:e})},name:"tool",label:t.query("GET_LABEL_MARKUP_SELECT_FONT_SIZE"),direction:"up",options:t.query("GET_MARKUP_FONT_SIZE_OPTIONS").map(function(e){return{value:e[1],label:e[0]}})}))},write:B({MARKUP_SELECT:function(e){var t=e.root,n=e.action,r=t.ref,i=r.colorSelect,o=r.fontFamilySelect,a=r.fontSizeSelect,c=r.shapeStyleSelect,u=r.lineStyleSelect,s=r.lineDecorationSelect;t.ref.activeMarkup=n.id?t.query("GET_MARKUP_BY_ID",n.id):null;var f=[i,o,a,c,u,s],d=[];if(t.ref.activeMarkup){var h=l(t.ref.activeMarkup,2),p=h[0],m=h[1],g=Array.isArray(m.allowEdit)?m.allowEdit:!1===m.allowEdit?[]:Hi,v=Hi.reduce(function(e,t){return e[t]=-1!==g.indexOf(t),e},{});if(v.color=!!g.find(function(e){return/[a-z]Color/.test(e)}),"image"!==p&&v.color&&(i.setSelectedValue(Ji(m)),d.push(i)),"text"===p&&(v.fontFamily&&(o.selectedValue=m.fontFamily,d.push(o)),v.fontSize&&(a.selectedValue=m.fontSize,d.push(a))),("rect"===p||"ellipse"===p)&&v.borderStyle){var y=t.query("GET_MARKUP_SHAPE_STYLE_OPTIONS").find(function(e){var t=m.borderWidth===e[1],n=m.borderStyle===e[2]||zi(m.borderStyle,e[2]);return t&&n});c.selectedValue=y,d.push(c)}if("line"===p){if(v.lineWidth){var E=t.query("GET_MARKUP_LINE_STYLE_OPTIONS").find(function(e){var t=m.lineWidth===e[1],n=m.lineStyle===e[2]||zi(m.lineStyle,e[2]);return t&&n});u.selectedValue=E,d.push(u)}v.lineDecoration&&(s.selectedValue=m.lineDecoration,d.push(s))}f.forEach(function(e){e.element.dataset.active="false"}),d.forEach(function(e){e.element.dataset.active="true"})}}})}),Qi=function(e){return e.borderWidth?"borderColor":e.lineWidth?"lineColor":e.fontColor?"fontColor":e.backgroundColor?"backgroundColor":void 0},Ji=function(e){var t=e.fontColor,n=e.backgroundColor,r=e.lineColor,i=e.borderColor;return t||n||r||i},$i=V({name:"markup",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(e){var t=e.root,n=e.props;n.viewId="markup",n.hidden=!1,t.ref.isHiding=!1,t.ref.defaultRect={x:.5,y:.5,width:.25,height:.25};var r=function(){return.5*Math.random()-.25},i=function(){return a({},t.ref.defaultRect,{x:t.ref.defaultRect.x-.5*t.ref.defaultRect.width+r(),y:t.ref.defaultRect.y-.5*t.ref.defaultRect.height+r()})},o=function(e){return t.query("GET_MARKUP_".concat(e,"_OPTIONS"))[t.query("GET_MARKUP_".concat(e,"_DEFAULT"))]},l=function(){return{backgroundColor:0===o("SHAPE_STYLE")[3]?o("COLOR")[1]:null,borderWidth:o("SHAPE_STYLE")[1],borderStyle:o("SHAPE_STYLE")[2]?o("SHAPE_STYLE")[2]:null,borderColor:o("COLOR")[1]}},c=[{view:Jn,name:"tool",label:t.query("GET_LABEL_MARKUP_TYPE_RECTANGLE"),icon:$n('<g fill="currentColor"><rect x="5" y="5" width="16" height="16" rx="2"/></g>',26),action:function(){return t.dispatch("MARKUP_ADD",["rect",a({},i(),l())])}},{view:Jn,name:"tool",label:t.query("GET_LABEL_MARKUP_TYPE_ELLIPSE"),icon:$n('<g fill="currentColor"><circle cx="13" cy="13" r="9"/></g>',26),action:function(){return t.dispatch("MARKUP_ADD",["ellipse",a({},i(),l())])}},{view:Jn,name:"tool",label:t.query("GET_LABEL_MARKUP_TYPE_TEXT"),icon:$n('<g transform="translate(5 5)" fill="currentColor" fill-rule="evenodd"><<path d="M10 4v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4H1a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-5z"/></g>',26),action:function(){return t.dispatch("MARKUP_ADD",["text",a({},i(),{width:0,height:0,fontColor:o("COLOR")[1],fontSize:o("FONT_SIZE")[1],fontFamily:o("FONT_FAMILY")[1],text:"Text"})])}},{view:Jn,name:"tool",label:t.query("GET_LABEL_MARKUP_TYPE_LINE"),icon:$n('<g transform="translate(3 4.5)" fill-rule="nonzero" fill="currentColor" stroke="none"><path d="M15.414 9.414l-6.01 6.01a2 2 0 1 1-2.829-2.828L9.172 10H2a2 2 0 1 1 0-4h7.172L6.575 3.404A2 2 0 1 1 9.404.575l6.01 6.01c.362.363.586.863.586 1.415s-.224 1.052-.586 1.414z"/></g>',26),action:function(){return t.dispatch("MARKUP_ADD",["line",a({},i(),{lineColor:o("COLOR")[1],lineWidth:o("LINE_STYLE")[1],lineStyle:o("LINE_STYLE")[2]?o("LINE_STYLE")[2]:null,lineDecoration:o("LINE_DECORATION")[1]})])}}];t.query("GET_MARKUP_ALLOW_ADD_MARKUP")&&(t.ref.menu=t.appendChildView(t.createChildView(yi("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:50}}),{opacity:0,controls:c}))),t.ref.tools=t.appendChildView(t.createChildView(Ki,{opacity:0,onUpdate:function(e,n){t.dispatch("MARKUP_UPDATE",{id:e,props:n})}})),t.ref.menuItemsRequiredWidth=null},read:function(e){var t=e.root,n=e.props;if(n.hidden)t.ref.menuItemsRequiredWidth=null;else{var r=t.rect;if(0!==r.element.width&&0!==r.element.height){if(t.ref.menu&&null===t.ref.menuItemsRequiredWidth){var i=t.ref.menu.childViews.reduce(function(e,t){return e+t.rect.outer.width},0);t.ref.menuItemsRequiredWidth=0===i?null:i}var o=t.ref.menu&&t.ref.menu.rect,a=t.ref.tools.rect.element.height,l=o?o.element.height:a,c=!o||0===o.element.top,u=c?r.element.top+l:r.element.top,s=c?r.element.height-l:r.element.height-l-r.element.top;n.stagePosition={x:r.element.left+20,y:u,width:r.element.width-40,height:s-a}}}},shouldUpdateChildViews:function(e){var t=e.props,n=e.actions;return!t.hidden||t.hidden&&n&&n.length},write:B({SHOW_VIEW:function(e){var t=e.root,n=e.action,r=e.props;n.id===r.viewId?(r.hidden=!1,t.ref.isHiding=!1,t.ref.menu&&(t.ref.menu.opacity=1)):(t.ref.isHiding=!0,t.ref.menu&&(t.ref.menu.opacity=0),t.ref.tools.opacity=0,t.ref.tools.translateY=5)},MARKUP_SELECT:function(e){var t=e.root,n=e.action;t.ref.tools.opacity=n.id?1:0,t.ref.tools.translateY=n.id?0:5,t.ref.tools.element.dataset.active=n.id?"true":"false"}},function(e){var t=e.root,n=e.props,r=e.timestamp;if(t.ref.isHiding&&t.ref.menu&&0===t.ref.menu.opacity&&(t.ref.isHiding=!1,n.hidden=!0),!n.hidden){var i=t.query("GET_CROP",n.id,r);if(i){var o=i.cropRect,a=o.height/o.width;t.ref.defaultRect.height=t.ref.defaultRect.width/a,t.ref.menu.element.dataset.layout=t.ref.menuItemsRequiredWidth>t.ref.menu.rect.element.width?"compact":"spacious"}}})}),eo={crop:Ai,resize:Si,filter:Wi,color:qi,markup:$i},to=V({name:"view-stack",ignoreRect:!0,mixins:{apis:["offsetTop"]},create:function(e){var t=e.root;t.ref.activeView=null,t.ref.activeStagePosition=null,t.ref.shouldFocus=!1},write:B({SHOW_VIEW:function(e){var t=e.root,n=e.props,r=e.action,i=0===t.childViews.length,o=t.childViews.find(function(e){return e.viewId===r.id});o||(o=t.appendChildView(t.createChildView(eo[r.id],a({},n)))),t.ref.activeView=o,t.childViews.map(function(e){return e.element}).forEach(function(e){e.dataset.viewActive="false",e.removeAttribute("tabindex")});var l=t.ref.activeView.element;l.dataset.viewActive="true",l.setAttribute("tabindex",-1),t.ref.shouldFocus=!i},DID_PRESENT_IMAGE:function(e){var t=e.root;t.dispatch("CHANGE_VIEW",{id:t.query("GET_UTILS")[0]})},DID_SET_UTILS:function(e){var t=e.root;t.dispatch("CHANGE_VIEW",{id:t.query("GET_UTILS")[0]})}},function(e){var t=e.root,n=e.props,r=t.ref,i=r.activeView,o=r.previousStagePosition;if(i&&i.stagePosition&&(t.childViews.forEach(function(e){e.offsetTop=n.offsetTop,e.element.viewHidden!==e.hidden&&(e.element.viewHidden=e.hidden,e.element.dataset.viewHidden=e.hidden)}),function(e,t){return!e||!t||!Le(e,t)}(i.stagePosition,o))){var a=i.stagePosition,l=a.x,c=a.y,u=a.width,s=a.height;if(0===u&&0===s)return;t.dispatch("DID_RESIZE_STAGE",{offset:{x:l,y:c},size:{width:u,height:s},animate:!0}),t.ref.previousStagePosition=i.stagePosition}}),didWriteView:function(e){var t=e.root;t.ref.shouldFocus&&(t.ref.activeView.element.focus({preventScroll:!0}),t.ref.shouldFocus=!1)}}),no=V({name:"content",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(e){var t=e.root,n=e.props;t.opacity=1,t.ref.viewStack=t.appendChildView(t.createChildView(to,{id:n.id})),t.ref.image=null},write:B({DID_LOAD_IMAGE:function(e){var t=e.root,n=e.props;t.ref.image=t.appendChildView(t.createChildView(Zr,{id:n.id}))}},function(e){var t=e.root,n=t.ref,r=n.image,i=n.viewStack;if(r){var o=t.rect.element.top;i.offsetTop=o,r.offsetTop=o}})}),ro=V({name:"utils",create:function(e){var t=e.root,n={crop:{title:t.query("GET_LABEL_BUTTON_UTIL_CROP"),icon:$n('<g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width="2"><path d="M23 17H9a2 2 0 0 1-2-2v-5m0-3V1"/><path d="M1 7h14a2 2 0 0 1 2 2v7m0 4v3"/></g>')},filter:{title:t.query("GET_LABEL_BUTTON_UTIL_FILTER"),icon:$n('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.347 9.907a6.5 6.5 0 1 0-1.872 3.306M3.26 11.574a6.5 6.5 0 1 0 2.815-1.417"/><path d="M10.15 17.897A6.503 6.503 0 0 0 16.5 23a6.5 6.5 0 1 0-6.183-8.51"/></g>')},color:{title:t.query("GET_LABEL_BUTTON_UTIL_COLOR"),icon:$n('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 1v5.5m0 3.503V23M12 1v10.5m0 3.5v8M20 1v15.5m0 3.5v3M2 7h4M10 12h4M18 17h4"/></g>')},markup:{title:t.query("GET_LABEL_BUTTON_UTIL_MARKUP"),icon:$n('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.086 2.914a2.828 2.828 0 1 1 4 4l-14.5 14.5-5.5 1.5 1.5-5.5 14.5-14.5z"/></g>')},resize:{title:t.query("GET_LABEL_BUTTON_UTIL_RESIZE"),icon:$n('<g fill="none" fill-rule="evenodd" stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="12" width="10" height="10" rx="2"/><path d="M4 11.5V4a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5"/><path d="M14 10l3.365-3.365M14 6h4v4" class="doka--icon-resize-arrow-ne"/><path d="M14 10l3.365-3.365M14 6v4h4" class="doka--icon-resize-arrow-sw"/></g>')}};t.ref.utils=Object.keys(n).map(function(e){return a({id:e},n[e])}),t.ref.utilMenuRequiredWidth=null},read:function(e){var t=e.root;if(null===t.ref.utilMenuRequiredWidth){var n=t.childViews.reduce(function(e,t){return e+t.rect.outer.width},0);t.ref.utilMenuRequiredWidth=0===n?null:n}},write:B({DID_SET_UTILS:function(e){var t=e.root,n=c(t.query("GET_UTILS"));t.childViews.forEach(function(e){return t.removeChildView(e)}),t.element.dataset.utilCount=n.length,1===n.length&&(n.length=0),n.forEach(function(e){var n=t.ref.utils.find(function(t){return t.id===e}),r=t.appendChildView(t.createChildView(Jn,{name:"tab",view:Jn,label:n.title,opacity:1,icon:n.icon,id:n.id,action:function(){return t.dispatch("CHANGE_VIEW",{id:n.id})}}));t.ref["util_button_".concat(n.id)]=r})},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.childViews.forEach(function(e){e.element.dataset.active=e.id===n.id})}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus;t.ref.util_button_resize&&function(e,t){e.element.dataset.scaleDirection=null===t||t>1?"up":"down"}(t.ref.util_button_resize,o.image.width?o.image.width/o.crop.width:null),t.element.dataset.layout=t.ref.utilMenuRequiredWidth>t.rect.element.width?"compact":"spacious"}})}),io=ve()&&function(){try{var e={antialias:!1,alpha:!1},t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}(),oo=V({name:"container",create:function(e){var t=e.root,n=[{view:Jn,opacity:0,label:t.query("GET_LABEL_BUTTON_RESET"),didCreateView:function(e){return t.ref.btnReset=e},name:"app action-reset icon-only",icon:$n('<g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g>',26),action:function(){return t.dispatch("EDIT_RESET")}}];t.query("GET_ALLOW_BUTTON_CANCEL")&&n.unshift({view:Jn,label:t.query("GET_LABEL_BUTTON_CANCEL"),name:"app action-cancel icon-fallback",opacity:1,icon:$n('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),didCreateView:function(e){t.ref.btnCancel=e},action:function(){t.dispatch("EDIT_CANCEL")}}),n.push({view:ro}),t.query("GET_ALLOW_BUTTON_CONFIRM")&&n.push({view:Jn,label:t.query("GET_LABEL_BUTTON_CONFIRM"),name:"app action-confirm icon-fallback",opacity:1,icon:$n('<polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),didCreateView:function(e){t.ref.btnConfirm=e},action:function(){t.dispatch("EDIT_CONFIRM")}}),t.ref.menu=t.appendChildView(t.createChildView(yi("menu"),{controls:n})),t.ref.menu.opacity=0,t.ref.status=t.appendChildView(t.createChildView(or)),t.ref.hasWebGL=io,t.ref.hasWebGL?t.dispatch("AWAIT_IMAGE"):t.dispatch("MISSING_WEBGL"),t.ref.handleFocusOut=function(){var e=t.ref.status;"busy"===e.element.dataset.viewStatus&&e.element.focus()},t.ref.handleFocusIn=function(e){var n=t.ref,r=n.menu,i=n.content,o=e.target;if(!r.element.contains(o)&&i&&i.element.contains(o)){if(!Array.from(t.element.querySelectorAll("[data-view-active=false]")).reduce(function(e,t){return t.contains(o)&&(e=!0),e},!1))return;r.element.querySelector("button,input,[tabindex]").focus()}},t.element.addEventListener("focusin",t.ref.handleFocusIn),t.element.addEventListener("focusout",t.ref.handleFocusOut),t.ref.previousState=null},destroy:function(e){var t=e.root;t.element.removeEventListener("focusin",t.ref.handleFocusIn),t.element.removeEventListener("focusout",t.ref.handleFocusOut)},write:B({UNLOAD_IMAGE:function(e){var t=e.root;t.ref.content&&(t.ref.content.opacity=0,t.ref.menu.opacity=0)},DID_UNLOAD_IMAGE:function(e){var t=e.root;t.removeChildView(t.ref.content),t.ref.content=null},DID_LOAD_IMAGE:function(e){var t=e.root,n=e.props;t.ref.hasWebGL&&(t.ref.content=t.appendChildView(t.createChildView(no,{opacity:null,id:n.id})),t.ref.menu.opacity=1)},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.element.dataset.limitOverflow="resize"===n.id}},function(e){var t=e.root,n=e.props,r=e.timestamp,i=t.query("GET_CROP",n.id,r);if(i){var o={crop:{width:i.cropStatus.currentWidth,height:i.cropStatus.currentHeight}};ao(t.ref.previousState,o)&&(t.dispatch("DID_UPDATE",{state:a({},o)}),t.ref.previousState=o);var l=t.ref,c=l.btnCancel,u=l.content,s=i.canReset;if(t.ref.btnReset.opacity=s?1:0,c&&t.query("GET_UTILS").length>1){var f=t.query("GET_ROOT_SIZE");c.opacity=s&&f.width<600?0:1}u&&0===u.opacity&&t.dispatch("DID_UNLOAD_IMAGE")}})}),ao=function(e,t){return!e||e.crop.width!==t.crop.width||e.crop.height!==t.crop.height},lo=function(e){return e.preventDefault()},co=V({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(e){var t=e.root,n=e.props;n.markedForRemoval=!1,t.element.addEventListener("touchmove",lo,{passive:!1}),t.element.addEventListener("gesturestart",lo),t.ref.pointerPolyfill=function(e){var t={destroy:function(){}};if("onpointerdown"in window||e.pointersPolyfilled)return t;e.pointersPolyfilled=!0;var n=0,r=[],i=function(e,t,n){var r=new UIEvent(t.type,{view:window,bubbles:!n});Object.keys(t).forEach(function(e){Object.defineProperty(r,e,{value:t[e],writable:!1})}),e.dispatchEvent(r)},o=function(e,t,o){return Array.from(t.changedTouches).map(function(a){var l=r[a.identifier],c={type:e,pageX:a.pageX,pageY:a.pageY,pointerId:a.identifier,isPrimary:l?l.isPrimary:0===n,preventDefault:function(){return t.preventDefault()}};return i(a.target,c,o),c})},a=function(e){o("pointerdown",e).forEach(function(e){r[e.pointerId]=e,n++})},l=function(e){o("pointermove",e)},c=function(e){o("pointerup",e).forEach(function(e){delete r[e.pointerId],n--})},u=function(e,t,n){var r={type:e,pageX:t.pageX,pageY:t.pageY,pointerId:0,isPrimary:!0,preventDefault:function(){return t.preventDefault()}};return i(t.target,r,n),r},s=function(e){u("pointerdown",e)},f=function(e){u("pointermove",e)},d=function(e){u("pointerup",e)};return"ontouchstart"in window?(e.addEventListener("touchstart",a),e.addEventListener("touchmove",l),e.addEventListener("touchend",c)):"onmousedown"in window&&(e.addEventListener("mousedown",s),e.addEventListener("mousemove",f),e.addEventListener("mouseup",d)),t.destroy=function(){r.length=0,e.pointersPolyfilled=!1,e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",l),e.removeEventListener("touchend",c),e.removeEventListener("mousedown",s),e.removeEventListener("mousemove",f),e.removeEventListener("mouseup",d)},t}("root"===t.query("GET_POINTER_EVENTS_POLYFILL_SCOPE")?t.element:document.documentElement),t.appendChildView(t.createChildView(oo,a({},n)))},destroy:function(e){var t=e.root;t.ref.pointerPolyfill.destroy(),t.element.removeEventListener("touchmove",lo,!0),t.element.removeEventListener("gesturestart",lo)}}),uo=function(e){return e.ref.isFullscreen},so=function(e){return/fullscreen/.test(e.query("GET_STYLE_LAYOUT_MODE"))},fo=function(e){return/fullscreen|preview/.test(e.query("GET_STYLE_LAYOUT_MODE"))},ho=function(e){return e.query("GET_ALLOW_AUTO_CLOSE")},po=fo,mo=fo,go=function(e){var t=e.ref,n=t.environment,r=t.isSingleUtil,i=t.canBeControlled;e.element.dataset.styleViewport=_o(e.rect.element.width,e.rect.element.height)+" "+n.join(" ")+(r?" single-util":" multi-util")+(i?" flow-controls":" no-flow-controls")},vo=function(e){var t=e.element,n=e.ref,r=n.handleFullscreenUpdate,i=n.handleEscapeKey;t.setAttribute("tabindex",-1),r(),e.ref.focusTrap=function(e){var t=function(t){if(9===t.keyCode){var n=Array.from(e.querySelectorAll("button,input,[tabindex]")).filter(function(e){return"hidden"!==e.style.visibility&&-1!==e.tabIndex}),r=n[0],i=n[n.length-1];t.shiftKey?document.activeElement===r&&(i.focus(),t.preventDefault()):document.activeElement===i&&(r.focus(),t.preventDefault())}};return e.addEventListener("keydown",t),{destroy:function(){e.removeEventListener("keydown",t)}}}(t),t.addEventListener("keydown",i),window.addEventListener("resize",r),document.body.classList.add("doka--parent"),document.body.appendChild(t);var o=document.querySelector("meta[name=viewport]");e.ref.defaultViewportContent=o?o.getAttribute("content"):null,o||((o=document.createElement("meta")).setAttribute("name","viewport"),document.head.appendChild(o)),o.setAttribute("content","width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0"),e.opacity=1,e.element.contains(document.activeElement)||t.focus(),e.dispatch("INVALIDATE_VIEWPORT"),e.ref.isFullscreen=!0},yo=function(e){var t=e.element,n=e.ref,r=n.handleFullscreenUpdate,i=n.focusTrap,o=n.handleEscapeKey;t.removeAttribute("tabindex"),i.destroy(),t.removeEventListener("keydown",o),window.removeEventListener("resize",r),document.body.classList.remove("doka--parent");var a=document.querySelector("meta[name=viewport]");e.ref.defaultViewportContent?(a.setAttribute("content",e.ref.defaultViewportContent),e.ref.defaultViewportContent=null):a.parentNode.removeChild(a),e.ref.isFullscreen=!1},Eo=V({name:"root",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(e){var t=e.root,n=e.props;t.element.id=t.query("GET_ID")||"doka-".concat(n.id);var r=t.query("GET_CLASS_NAME");r&&t.element.classList.add(r),t.ref.environment=[],t.ref.shouldBeDestroyed=!1,t.ref.isClosing=!1,t.ref.isClosed=!1,t.ref.isFullscreen=!1,t.query("GET_ALLOW_DROP_FILES")&&(t.ref.catcher=function(e){var t,n={browseEnabled:!1},r=function(){t.files.length&&i.fire("drop",Array.from(t.files))},i=a({},le(),{enableBrowse:function(){n.browseEnabled||((t=document.createElement("input")).style.display="none",t.setAttribute("type","file"),t.addEventListener("change",r),e.appendChild(t),e.addEventListener("click",o),n.browseEnabled=!0)},disableBrowse:function(){n.browseEnabled&&(t.removeEventListener("change",r),t.parentNode.removeChild(t),e.removeEventListener("click",o),n.browseEnabled=!1)},destroy:function(){e.removeEventListener("dragover",l),e.removeEventListener("drop",c),e.removeEventListener("click",o),t.removeEventListener("change",r)}}),o=function(){return t.click()},l=function(e){return e.preventDefault()},c=function(e){e.preventDefault();var t=Array.from(e.dataTransfer.items||e.dataTransfer.files).map(function(e){return e.getAsFile&&"file"===e.kind?e.getAsFile():e});i.fire("drop",t)};return e.addEventListener("dragover",l),e.addEventListener("drop",c),i}(t.element),t.ref.catcher.on("drop",function(e){e.forEach(function(e){t.dispatch("REQUEST_LOAD_IMAGE",{source:e})})})),t.ref.touchDetector=function(){function e(){t.fire("touch-detected"),window.removeEventListener("touchstart",e,!1)}var t=a({},le(),{destroy:function(){window.removeEventListener("touchstart",e,!1)}});return window.addEventListener("touchstart",e,!1),t}(),t.ref.touchDetector.onOnce("touch-detected",function(){t.ref.environment.push("touch")}),t.ref.editor=t.appendChildView(t.createChildView(co,{id:n.id})),t.query("GET_STYLES").filter(function(e){return!z(e.value)}).map(function(e){var n=e.name,r=e.value;t.element.dataset[n]=r}),t.ref.updateViewport=function(){t.dispatch("INVALIDATE_VIEWPORT")},window.addEventListener("resize",t.ref.updateViewport),window.addEventListener("scroll",t.ref.updateViewport),t.ref.isSingleUtil=1===t.query("GET_UTILS").length,t.ref.canBeControlled=t.query("GET_ALLOW_BUTTON_CONFIRM")||t.query("GET_ALLOW_BUTTON_CANCEL"),go(t);var i=document.createElement("div");i.style.cssText="position:fixed;height:100vh;top:0;",t.ref.measure=i,document.body.appendChild(i),t.ref.handleEscapeKey=function(e){27===e.keyCode&&t.dispatch("EDIT_CANCEL")},t.ref.initialScreenMeasureHeight=null,t.ref.handleFullscreenUpdate=function(){t.element.dataset.styleFullscreen=window.innerHeight===t.ref.initialScreenMeasureHeight},t.ref.clientRect={left:0,top:0}},read:function(e){var t=e.root,n=t.ref.measure;n&&(t.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),t.ref.measure=null),t.ref.clientRect=t.element.getBoundingClientRect(),t.ref.clientRect.leftScroll=t.ref.clientRect.left+(window.scrollX||window.pageXOffset),t.ref.clientRect.topScroll=t.ref.clientRect.top+(window.scrollY||window.pageYOffset)},write:B({ENTER_FULLSCREEN:function(e){var t=e.root;vo(t)},EXIT_FULLSCREEN:function(e){var t=e.root;yo(t)},SHOW_VIEW:function(e){var t=e.root,n=e.action;t.element.dataset.view=n.id},DID_SET_STYLE_LAYOUT_MODE:function(e){var t=e.root,n=e.action;t.element.dataset.styleLayoutMode=n.value||"none",/fullscreen/.test(n.value)&&!/fullscreen/.test(n.prevValue)&&t.dispatch("ENTER_FULLSCREEN")},AWAITING_IMAGE:function(e){var t=e.root;t.ref.catcher&&t.query("GET_ALLOW_BROWSE_FILES")&&t.ref.catcher.enableBrowse()},DID_REQUEST_LOAD_IMAGE:function(e){var t=e.root;if(t.ref.catcher&&t.query("GET_ALLOW_BROWSE_FILES")&&t.ref.catcher.disableBrowse(),0===t.opacity&&(t.opacity=1),t.ref.isClosing=!1,t.ref.isClosed=!1,!so(t)||uo(t)){var n=t.query("GET_STYLE_LAYOUT_MODE");null!==n&&"modal"!==n||t.element.parentNode||t.dispatch("SET_STYLE_LAYOUT_MODE",{value:("fullscreen "+(n||"")).trim()})}else t.dispatch("ENTER_FULLSCREEN")},DID_CANCEL:function(e){var t=e.root;po(t)&&ho(t)&&t.dispatch("EDIT_CLOSE")},DID_CONFIRM:function(e){var t=e.root;po(t)&&ho(t)&&t.dispatch("EDIT_CLOSE")},EDIT_CLOSE:function(e){var t=e.root;mo(t)&&(t.opacity=t.opacity||1,t.opacity=0,t.ref.isClosed=!1,t.ref.isClosing=!0,t.query("GET_ALLOW_AUTO_DESTROY")&&(t.ref.shouldBeDestroyed=!0),uo(t)&&t.dispatch("EXIT_FULLSCREEN"))},DID_SET_UTILS:function(e){var t=e.root;t.ref.isSingleUtil=1===t.query("GET_UTILS").length}},function(e){var t=e.root;go(t);var n=t.query("GET_ROOT"),r=t.rect.element;n.width===r.width&&n.height===r.height&&n.y===t.ref.clientRect.top&&n.topScroll===t.ref.clientRect.topScroll||t.dispatch("UPDATE_ROOT_RECT",{rect:{x:t.ref.clientRect.left,y:t.ref.clientRect.top,left:t.ref.editor.rect.element.left,top:t.ref.editor.rect.element.top,leftScroll:t.ref.clientRect.leftScroll,topScroll:t.ref.clientRect.topScroll,width:t.rect.element.width,height:t.rect.element.height}})}),didWriteView:function(e){var t=e.root,n=t.ref,r=n.isClosed,i=n.isClosing,o=n.shouldBeDestroyed;!r&&i&&0===t.opacity&&(t.dispatch("DID_CLOSE"),t.ref.isClosed=!0,t.ref.isClosing=!1,so(t)&&t.element.parentNode&&document.body.removeChild(t.element),o&&t.dispatch("EDIT_DESTROY"))},destroy:function(e){var t=e.root;uo(t)&&yo(t),so(t)&&t.element.parentNode&&document.body.removeChild(t.element),window.removeEventListener("resize",t.ref.updateViewport),t.ref.touchDetector.destroy(),t.ref.catcher&&t.ref.catcher.destroy()}}),_o=function(e,t){var n="";return 0===e&&0===t?"detached":(n+=t>e?"portrait":"landscape",(n+=e<=600?" x-cramped":e<=1e3?" x-comfortable":" x-spacious").trim())},wo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_e(),n=h(te(t),[st,oe(t)],[Kn,ie(t)]);n.dispatch("SET_OPTIONS",{options:e});var r=function(){document.hidden||n.dispatch("KICK")};document.addEventListener("visibilitychange",r);var i=ae();n.dispatch("SET_UID",{id:i});var o=null,l=Eo(n,{id:i}),c=!1,u={_read:function(){c||l._read()},_write:function(e){var t=n.processActionQueue().filter(function(e){return!/^SET_/.test(e.type)});c&&!t.length||(v(t),(c=l._write(e,t))&&n.processDispatchQueue(),t.find(function(e){return"EDIT_DESTROY"===e.type})&&y())}},p=function(e){return function(t){var n={type:e};return t?(t.hasOwnProperty("error")&&(n.error=d(t.error)?a({},t.error):t.error||null),t.hasOwnProperty("output")&&(n.output=t.output),t.hasOwnProperty("image")&&(n.image=t.image),t.hasOwnProperty("source")&&(n.source=t.source),t.hasOwnProperty("state")&&(n.state=t.state),n):n}},g={DID_CONFIRM:p("confirm"),DID_CANCEL:p("cancel"),DID_REQUEST_LOAD_IMAGE:p("loadstart"),DID_LOAD_IMAGE:p("load"),DID_LOAD_IMAGE_ERROR:p("loaderror"),DID_UPDATE:p("update"),DID_CLOSE:p("close"),DID_DESTROY:p("destroy"),DID_INIT:p("init")},v=function(e){e.length&&e.forEach(function(e){if(g[e.type]){var t=g[e.type];(Array.isArray(t)?t:[t]).forEach(function(t){setTimeout(function(){!function(e){var t=a({doka:E},e);delete t.type,l&&l.element.dispatchEvent(new CustomEvent("Doka:".concat(e.type),{detail:t,bubbles:!0,cancelable:!0,composed:!0}));var r=[];e.hasOwnProperty("error")&&r.push(e.error);var i=["type","error"];Object.keys(e).filter(function(e){return!i.includes(e)}).forEach(function(t){return r.push(e[t])}),E.fire.apply(E,[e.type].concat(r));var o=n.query("GET_ON".concat(e.type.toUpperCase()));o&&o.apply(void 0,r)}(t(e.data))},0)})}})},y=function(){E.fire("destroy",l.element),document.removeEventListener("visibilitychange",r),l._destroy(),n.dispatch("DID_DESTROY")},E=a({},le(),u,re(n,t),{setOptions:function(e){return n.dispatch("SET_OPTIONS",{options:e})},setData:function(e){n.dispatch("SET_DATA",e)},getData:function(e){return new Promise(function(t,r){n.dispatch("GET_DATA",a({},e,{success:t,failure:r}))})},open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,i){e&&n.dispatch("REQUEST_LOAD_IMAGE",{source:e,options:t,success:r,failure:i,resolveOnConfirm:!!t&&t.resolveOnConfirm})})},edit:function(e,t){return E.open(e,a({},t,{resolveOnConfirm:!0}))},save:function(e){return new Promise(function(t,r){n.dispatch("GET_DATA",a({},e,{success:t,failure:r}))})},clear:function(){return n.dispatch("REQUEST_REMOVE_IMAGE")},close:function(){return n.dispatch("EDIT_CLOSE")},destroy:y,insertBefore:function(e){s(l.element,e)},insertAfter:function(e){f(l.element,e)},appendTo:function(e){e.appendChild(l.element)},replaceElement:function(e){s(l.element,e),e.parentNode.removeChild(e),o=e},restoreElement:function(){o&&(f(o,l.element),l.element.parentNode.removeChild(l.element),o=null)},isAttachedTo:function(e){return!!l&&(l.element===e||o===e)},element:{get:function(){return l?l.element:null}}});return n.dispatch("DID_INIT"),m(E)},To=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_e(),n={};return p(t,function(e,t){Y(t)||(n[e]=t[0])}),wo(a({},n,e))},xo=function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.replace(new RegExp("".concat(t,"."),"g"),function(e){return e.charAt(1).toUpperCase()})}(e.replace(/^data-/,""))},Ro=function e(t,n){p(n,function(n,r){p(t,function(e,i){var o=new RegExp(n);if(o.test(e)&&(delete t[e],!1!==r))if(Y(r))t[r]=i;else{var a=r.group;d(r)&&!t[a]&&(t[a]={}),t[a][function(e){return e.charAt(0).toLowerCase()+e.slice(1)}(e.replace(o,""))]=i}}),r.mapping&&e(t[r.group],r.mapping)})},Ao=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];p(e.attributes,function(t){return n.push(e.attributes[t])});var r=n.filter(function(e){return e.name}).reduce(function(t,n){var r=g(e,n.name);return t[xo(n.name)]=r===n.name||r,t},{});return Ro(r,t),r},Io=function(e){var t=a({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=Ao(e,{"^class$":"className"});Object.keys(n).forEach(function(e){d(n[e])?(d(t[e])||(t[e]={}),Object.assign(t[e],n[e])):t[e]=n[e]}),"CANVAS"!==e.nodeName&&"IMG"!==e.nodeName||(t.src=e.dataset.dokaSrc?e.dataset.dokaSrc:e);var r=To(t);return r.replaceElement(e),r},Co=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return u(t[0])?Io.apply(void 0,t):To.apply(void 0,c(t.filter(function(e){return e})))},bo=["fire","_read","_write"],Oo=function(e){var t={};return function(e,t,n){Object.getOwnPropertyNames(e).filter(function(e){return!n.includes(e)}).forEach(function(n){return Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}(e,t,bo),t},Mo=function(){var e=ve()&&!("[object OperaMini]"===Object.prototype.toString.call(window.operamini))&&"visibilityState"in document&&"Promise"in window&&"slice"in Blob.prototype&&"URL"in window&&"createObjectURL"in window.URL&&"performance"in window;return function(){return e}}(),So={apps:[]},Lo=function(){},Po={},Go=Lo,ko=Lo,Do=Lo,Uo=Lo,Vo=Lo,Bo=Lo;if(Mo()){!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,r="__framePainter";if(window[r])return window[r].readers.push(e),void window[r].writers.push(t);window[r]={readers:[e],writers:[t]};var i=window[r],o=1e3/n,a=null,l=null,c=null,u=null,s=function(){document.hidden?(c=function(){return window.setTimeout(function(){return f(performance.now())},o)},u=function(){return window.clearTimeout(l)}):(c=function(){return window.requestAnimationFrame(f)},u=function(){return window.cancelAnimationFrame(l)})};document.addEventListener("visibilitychange",function(){u&&u(),s(),f(performance.now())});var f=function e(t){l=c(e),a||(a=t);var n=t-a;n<=o||(a=t-n%o,i.readers.forEach(function(e){return e()}),i.writers.forEach(function(e){return e(t)}))};s(),f(performance.now())}(function(){So.apps.forEach(function(e){return e._read()})},function(e){So.apps.forEach(function(t){return t._write(e)})});var No=function e(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:Mo,create:Go,destroy:ko,parse:Do,find:Uo,setOptions:Bo}})),document.removeEventListener("DOMContentLoaded",e)};"loading"!==document.readyState?setTimeout(function(){return No()},0):document.addEventListener("DOMContentLoaded",No);t.OptionTypes=Po={},p(_e(),function(e,t){Po[e]=t[1]}),t.create=Go=function(){var e=Co.apply(void 0,arguments);return e.on("destroy",ko),So.apps.push(e),Oo(e)},t.destroy=ko=function(e){var t=So.apps.findIndex(function(t){return t.isAttachedTo(e)});return t>=0&&(So.apps.splice(t,1)[0].restoreElement(),!0)},t.parse=Do=function(e){return Array.from(e.querySelectorAll(".".concat("doka"))).filter(function(e){return!So.apps.find(function(t){return t.isAttachedTo(e)})}).map(function(e){return Go(e)})},t.find=Uo=function(e){var t=So.apps.find(function(t){return t.isAttachedTo(e)});return t?Oo(t):null},t.getOptions=Vo=function(){var e={};return p(_e(),function(t,n){e[t]=n[0]}),e},t.setOptions=Bo=function(e){return d(e)&&(So.apps.forEach(function(t){t.setOptions(e)}),function(e){p(e,function(e,t){Te[e]&&we(e,t)})}(e)),Vo()}}t.supported=Mo,t.OptionTypes=Po,t.create=Go,t.destroy=ko,t.parse=Do,t.find=Uo,t.getOptions=Vo,t.setOptions=Bo},731:function(e,t,n){},738:function(e,t,n){e.exports=n.p+"static/media/jpg-icon.06cfaed3.svg"},739:function(e,t,n){e.exports=n.p+"static/media/png-icon.ce1e7079.svg"},740:function(e,t,n){e.exports=n.p+"static/media/svg-icon.b0009b89.svg"},743:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(122),a=n(8),l=n(66),c=n(7),u=n(719),s=n(741),f=n(3),d=n(721),h=n(722),p=n.n(h),m=n(723),g=n.n(m),v=n(724),y=n.n(v),E=n(725),_=n.n(E),w=n(726),T=n.n(w),x=n(727),R=n.n(x),A=n(728),I=n.n(A),C=n(729),b=n.n(C),O=n(730),M=n.n(O),S=n(18);n(731),n(732),n(733),n(734);Object(u.registerPlugin)(p.a,_.a,I.a,b.a,T.a,g.a,y.a,R.a,M.a);var L=Object(s.a)(function(e){return{filePondWrapper:{opacity:".8",transition:"opacity .3s","& .filepond--root":{minHeight:"40rem",borderBottom:"none","& .filepond--item":{minHeight:"40rem"},"& .filepond--drop-label":{minHeight:"40rem",color:"#fefefe",fontSize:"2em",fontWeight:"600"},"& .filepond--file-status":{fontSize:"2em"},"& .filepond--file-action-button":{fontSize:"2em"},"& .filepond--file-info-main":{fontSize:"2em"},"& .filepond--file-info-sub":{fontSize:"1.5em"},"@media screen and (max-width:600px)":{minHeight:"35rem","& .filepond--drop-label":{minHeight:"35rem"},"& .filepond--item":{minHeight:"35rem"}}},"& .filepond--panel-root":{fontSize:"1.75em",backgroundColor:"transparent"},"&:hover, &.active":{opacity:"1",cursor:"pointer"}}}});var P=function(){var e=L(),t=Object(c.b)(),n=Object(r.useRef)(null);return i.a.createElement("div",{className:Object(f.a)(e.filePondWrapper,"mb-12 rounded-12 border-3 border-dotted")},i.a.createElement(u.FilePond,{ref:n,files:[],labelIdle:"<svg width='279' height='161' xmlns='http://www.w3.org/2000/svg'><g fill='#fefefe' fill-rule='evenodd'><path d='M12.056572 23.081281C2.268447 27.645558-1.910177 39.126234 2.6541 48.914358l45.642773 97.881241c4.564277 9.788124 16.15371 13.916036 25.833077 9.402472l65.254161-30.428514c9.788124-4.564278 13.916035-16.153712 9.402472-25.833079l-38.035644-81.567701-.050516-.108332-.152539-.327121-.050516-.108332c-.159471-.058043-.26025-.276377-.41972-.33442L62.23631.07775c-.159471-.058043-.318972-.115038-.536485-.01361l-.108332.050516c-.108757.050714-.26888-.006507-.377636.044207l-.108333.050516-49.048952 22.871902zm1.216348 2.608467L60.909306 3.476537l6.998955 15.009306c4.564277 9.788124 16.15371 13.916034 25.833077 9.402471l15.009305-6.998954 37.42747 80.263468c3.854279 8.265527.255176 18.15398-8.010351 22.008259L72.9136 153.589602c-8.265527 3.854278-18.153982.255176-22.00826-8.010351L5.262568 47.69801c-3.854278-8.265527-.255175-18.153983 8.010352-22.008262z' fill-rule='nonzero'/><path d='M52.833628 97.191724l-1.255273-3.100822-3.106098 1.448398 1.255273 3.100821 3.106098-1.448397zm8.60496-22.093834l-1.524803-3.610683-2.19254 1.022398 1.550905 3.598512 2.166438-1.010227zm6.485741 13.499837l-5.36759-11.510833-7.569482 3.529707.53716 1.560824 5.7214-2.381938 4.75902 10.205751c1.20497 2.584065.66183 3.59999-4.930962 6.46217l.884995 2.03417c6.532451-3.30035 7.70597-6.167313 5.96546-9.89985zm10.983665-5.407762c2.323048-1.083255 3.346852-3.657963 1.849769-6.868468-1.484912-3.184403-3.763848-4.187241-5.773676-3.250043-1.017965.474685-1.86729 1.379168-2.424359 2.433366 1.038087 2.089892 2.246574 4.545207 4.025358 8.291675.878663-.091954 1.618163-.277902 2.322908-.60653zm.573887 6.818726l-2.029035 1.168596-2.069139-4.437283c-2.884623-6.186094-4.712093-10.03697-6.108428-12.690685l1.870667-1.031193.75125 1.270328c.564105-1.311697 1.514458-2.61284 3.10666-3.355296 2.714573-1.265827 5.8581.160055 7.598612 3.892593 2.142167 4.593893.185317 8.779447-3.599424 10.544301-.443728.206914-.92573.399898-1.432074.540678l1.91091 4.097961zm19.86829-14.158437c-8.025383 3.71052-11.275076 2.397698-13.21033-1.752466-1.813539-3.889148-.498677-8.156666 2.816234-9.702434 3.497623-1.630969 6.587048.360355 8.088986 4.80791L88.398374 73.4895c1.620697 2.930421 4.06166 3.190382 10.320783.462369l.631014 1.898386zm-9.944035-9.53569c-2.114235.985885-2.73772 3.056148-1.616332 5.869851 1.43735-.733802 4.886288-2.469177 6.66296-3.361207-1.170214-2.441385-2.906292-3.506698-5.046628-2.508643zm17.658169 11.08645l-1.109498-1.834152c5.836501-3.293596 6.304853-4.401756 4.665231-8.05423-.58493 1.130744-1.556109 2.250935-3.070005 2.956877-2.766777 1.290169-5.778178.21578-7.34829-3.151335-1.923081-4.124063.042422-8.154766 3.696655-9.858763 1.25288-.584227 2.550928-.935299 4.01248-1.140173.500787 1.005794 3.762724 8.00104 4.456494 9.488835 2.056968 4.411181 1.573982 7.941238-5.303067 11.592941zm.477636-8.993256c1.017965-.474685 1.86553-1.314793 2.457356-2.226311-.815485-1.748812-2.509069-5.312568-3.407994-7.308466-.944796.15457-1.800874.363102-2.610026.740416-2.244743 1.04674-3.24934 3.390052-1.922657 6.235133 1.314512 2.81898 3.473493 3.496426 5.483321 2.559228z'/><g><path d='M266.889188 25.176204c9.788124 4.564277 13.966748 16.044953 9.402471 25.833077l-45.642772 97.881241c-4.564277 9.788124-16.15371 13.916035-25.833078 9.402472l-65.25416-30.428515c-9.788125-4.564277-13.916035-16.153711-9.402472-25.833078L168.19482 20.4637l.050515-.108332.15254-.327121.050516-.108332c.15947-.058043.260249-.276377.41972-.33442L216.70945 2.172672c.159471-.058042.318971-.115037.536485-.013609l.108332.050516c.108757.050714.26888-.006507.377636.044207l.108333.050516 49.048952 22.871902zm-1.216348 2.608467L218.036453 5.57146 211.0375 20.580766c-4.564278 9.788124-16.15371 13.916034-25.833077 9.402471l-15.009306-6.998954-37.42747 80.263467c-3.854278 8.265527-.255175 18.153981 8.010352 22.00826l65.25416 30.428514c8.265528 3.854279 18.153983.255177 22.008261-8.01035l45.642773-97.881242c3.854278-8.265527.255175-18.153982-8.010352-22.00826z' fill-rule='nonzero'/><path d='M178.687106 77.171994l1.568493-2.954764-3.106098-1.448398-1.568493 2.954765 3.106098 1.448397zm13.130334 4.279693c2.323048 1.083255 4.953477.212544 6.45056-2.997961 1.484912-3.184403.788258-5.574781-1.22157-6.51198-1.017965-.474685-2.256774-.543914-3.422414-.293029-.93368 2.138578-2.03776 4.642579-3.764341 8.41339.635234.613987 1.25302 1.060952 1.957765 1.38958zm-4.85456 4.822616l-2.199435-.803172 2.06914-4.437283c2.884623-6.186095 4.659889-10.061313 5.795207-12.836743l1.99238.770176-.490233 1.392042c1.367418-.411013 2.975027-.519359 4.567229.223097 2.714573 1.265826 3.642905 4.590447 1.902394 8.322985-2.142168 4.593893-6.606327 5.785281-10.391069 4.020428-.443728-.206914-.901387-.452101-1.334702-.749492l-1.910911 4.097962zm24.702241-7.452195c1.618303.754627 2.182408 2.066324 1.038296 4.51988l-3.712279 7.961008 2.114235.985884 4.040907-8.665752c1.460569-3.1322.543071-5.117123-1.753875-6.188207-1.827117-.851998-3.587819-.687931-5.071815-.299502l.55109-1.52255-2.018481-.782347c-1.24486 3.010345-3.140082 7.210954-5.744763 12.79671l2.114235.985884c2.08131-4.463385 3.599218-7.854842 4.63027-10.202233 1.30832-.21613 2.585402-.16083 3.81218.411225zm2.68544 20.477498l.69187-2.028894c6.274672 2.353936 7.424623 2.000403 9.168652-1.603385-1.242186.278746-2.724564.254824-4.23846-.451117-2.766777-1.29017-3.879439-4.28764-2.309327-7.654755 1.923082-4.124063 6.274181-5.209286 9.928414-3.505289 1.25288.584228 2.356185 1.352926 3.452596 2.34085-.448584 1.030136-3.71052 8.025382-4.40429 9.513177-2.056968 4.41118-5.071606 6.31027-12.289455 3.389413zm7.196253-5.414862c1.017965.474685 2.20633.583946 3.28501.451398.815485-1.748812 2.456866-5.336911 3.407994-7.308466-.72571-.6244-1.435732-1.146152-2.244883-1.523466-2.244743-1.04674-4.685566-.310055-6.01225 2.535026-1.314511 2.81898-.4457 4.90831 1.564129 5.845508z'/></g></g></svg> </br>\u9ede\u64ca \u6216 \u62d6\u66f3\u4f86 <span class='filepond--label-action'>\u4e0a\u50b3\u5716\u7247 </span></br>\u652f\u63f4 SVG\u3001JPG\u3001PNG",labelInvalidField:"\u8acb\u4e0a\u50b3\u5716\u7247",labelFileWaitingForSize:"\u6aa2\u67e5\u5716\u7247\u5927\u5c0f",labelFileSizeNotAvailable:"\u5716\u7247\u6a94\u6848\u592a\u5927\u4e86",labelFileLoading:"\u8f09\u5165\u4e2d",labelFileLoadError:"\u51fa\u932f\u4e86",labelFileProcessing:"\u4e0a\u50b3\u4e2d",labelFileProcessingComplete:"\u4e0a\u50b3\u5b8c\u6210",labelFileProcessingAborted:"\u4e0a\u50b3\u5df2\u53d6\u6d88",labelFileProcessingError:"\u51fa\u932f\u4e86",labelFileProcessingRevertError:"\u51fa\u932f\u4e86",labelFileRemoveError:"\u51fa\u932f\u4e86",labelTapToCancel:"\u53d6\u6d88",labelTapToRetry:"\u91cd\u65b0\u4e0a\u50b3",labelTapToUndo:"\u4e0a\u4e00\u6b65",labelButtonRemoveItem:"\u79fb\u9664\u5716\u7247",labelButtonAbortItemLoad:"\u4e2d\u6b62\u4e0a\u50b3",labelButtonRetryItemLoad:"\u91cd\u65b0\u4e0a\u50b3",labelButtonAbortItemProcessing:"\u53d6\u6d88\u4e0a\u50b3\u4e2d",labelButtonUndoItemProcessing:"\u91cd\u65b0\u4e0a\u50b3\u4e2d",labelButtonRetryItemProcessing:"\u91cd\u8a66",labelButtonProcessItem:"\u4e0a\u50b3",labelFileTypeNotAllowed:"\u4e0d\u652f\u63f4\u7684\u5716\u7247\u683c\u5f0f",acceptedFileTypes:["image/jpeg","image/png","image/svg+xml"],dropValidation:!0,maxFileSize:"10MB",fileValidateTypeLabelExpectedTypesMap:{"image/jpeg":".jpg","image/png":".png","image/svg+xml":".svg"},styleItemPanelAspectRatio:.45,imageEditInstantEdit:!0,imageEditEditor:Object(d.create)({utils:["crop","filter","color","markup","resize"],labelButtonReset:"\u91cd\u65b0\u7de8\u8f2f",labelButtonCancel:"\u53d6\u6d88",labelButtonConfirm:"\u5132\u5b58",labelStatusAwaitingImage:"\u7b49\u5f85\u5716\u7247\u4e2d...",labelStatusLoadingImage:"\u8f09\u5165\u5716\u7247\u4e2d...",labelStatusLoadImageError:"\u8f09\u5165\u5716\u7247\u5931\u6557",labelStatusProcessingImage:"\u8655\u88e1\u5716\u7247\u4e2d...",labelColorBrightness:"\u660e\u4eae\u5ea6",labelColorContrast:"\u5c0d\u6bd4\u5ea6",labelColorExposure:"\u66dd\u5149\u5ea6",labelColorSaturation:"\u98fd\u548c\u5ea6",labelButtonCropZoom:"\u7e2e\u653e",labelButtonCropRotateLeft:"\u5411\u5de6\u65cb\u8f49",labelButtonCropRotateRight:"\u5411\u53f3\u65cb\u8f49",labelButtonCropRotateCenter:"\u5411\u4e2d\u5fc3\u65cb\u8f49",labelButtonCropFlipHorizontal:"\u6c34\u5e73\u7ffb\u8f49",labelButtonCropFlipVertical:"\u5782\u76f4\u7ffb\u8f49",labelButtonCropAspectRatio:"\u9577\u5bec\u6bd4",labelButtonUtilCrop:"\u88c1\u5207",labelButtonUtilFilter:"\u6ffe\u93e1",labelButtonUtilColor:"\u984f\u8272",labelButtonUtilMarkup:"\u5857\u9d09",labelButtonUtilResize:"\u5c3a\u5bf8",labelMarkupTypeRectangle:"\u6b63\u65b9\u5f62",labelMarkupTypeEllipse:"\u5713\u5f62",labelMarkupTypeText:"\u6587\u5b57",labelMarkupTypeLine:"\u7bad\u982d",labelMarkupSelectFontSize:"\u6587\u5b57\u5927\u5c0f",labelMarkupSelectFontFamily:"\u6587\u5b57\u5b57\u578b",labelMarkupSelectLineDecoration:"\u7bad\u982d\u6a23\u5f0f",labelMarkupSelectLineStyle:"\u98a8\u683c",labelMarkupSelectShapeStyle:"\u98a8\u683c",labelMarkupRemoveShape:"\u79fb\u9664",cropAllowImageTurnRight:!0,filters:{original:{label:"\u539f\u5716",matrix:function(){return null}},chrome:{label:"\u751f\u52d5",matrix:function(){return[1.398,-.316,.065,-.273,.201,-.051,1.278,-.08,-.273,.201,-.051,.119,1.151,-.29,.215,0,0,0,1,0]}},fade:{label:"\u5e74\u83ef",matrix:function(){return[1.073,-.015,.092,-.115,-.017,.107,.859,.184,-.115,-.017,.015,.077,1.104,-.115,-.017,0,0,0,1,0]}},mono:{label:"\u7070\u968e",matrix:function(){return[.212,.715,.114,0,0,.212,.715,.114,0,0,.212,.715,.114,0,0,0,0,0,1,0]}},noir:{label:"\u9ed1\u767d",matrix:function(){return[.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,0,0,0,1,0]}}},cropAspectRatioOptions:[{label:"\u4efb\u610f",value:null},{label:"\u8096\u50cf",value:1.25},{label:"\u6b63\u65b9\u5f62",value:1},{label:"\u666f\u89c0",value:.75}],markupShapeStyleOptions:[["\u586b\u6eff",0,null,0],["\u7c97\u539a\u6846\u7dda",.025,null,4],["\u9810\u8a2d\u6846\u7dda",.015,null,2],["\u7e96\u7d30\u6846\u7dda",.005,null,1],["\u865b\u7dda\u6846\u7dda",.005,[.01],1]],markupLineStyleOptions:[["\u7c97\u539a",.025,null,4],["\u9810\u8a2d",.015,null,2],["\u7e96\u7d30",.005,null,1],["\u865b\u7dda",.005,[.01],1]],markupLineDecorationOptions:[["\u7121\u7bad\u982d",[]],["\u55ae\u7bad\u982d",["arrow-end"]],["\u96d9\u7bad\u982d",["arrow-begin","arrow-end"]]],onloadstart:function(){return t(S.k())},oncancel:function(){return t(S.h())},onconfirm:function(e){var n={width:e.image.width,height:e.image.height};t(S.o([n]))}}),onwarning:function(e){t({type:S.a,options:{message:"\u8acb\u91cd\u65b0\u9078\u64c7\u5716\u7247"}}),t(S.h())},onerror:function(){t({type:S.a,options:{message:"\u627e\u5230\u5f69\u86cb\u4e86\uff01"}}),t(S.h())},onaddfilestart:function(){return t(S.k())},onremovefile:function(){return t(S.h())},onupdatefiles:function(e){e.length&&t(S.p(e.map(function(e){return e.file.size})))},onpreparefile:function(e,n){t(S.n([n]))}}))},G=n(21),k=n(742),D=n(702),U=n(640),V=n(685),B=n(28),N=n(735),z=n(736),F=n.n(z),W=n(737),q=n.n(W),Y=n(690),H=n(321),j=n(738),Z=n.n(j),X=n(739),K=n.n(X),Q=n(740),J=n.n(Q);function $(e){switch(e){case"image/jpeg":return i.a.createElement("img",{className:"w-32",src:Z.a,alt:"jpg icon"});case"image/png":return i.a.createElement("img",{className:"w-32",src:K.a,alt:"PNG icon"});default:return i.a.createElement("img",{className:"w-32",src:J.a,alt:"svg icon"})}}var ee=Object(s.a)(function(e){return{fileCompressWrapper:{minHeight:"25rem"},previewImage:{transition:e.transitions.create(["transform"],{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.short}),"&:hover":{transform:"scale(1.05)"}},scrollBox:{"&::-webkit-scrollbar":{width:"0 !important"}}}});var te=function(){var e=ee(),t=Object(B.a)(),n=Object(Y.a)(t.breakpoints.up("md")),a=Object(c.c)(function(e){return e.file.image}),u=a.dimensions,s=a.sizes,d=a.docs,h=a.blobs,p=a.loading,m=Object(r.useState)(null),g=Object(G.a)(m,2),v=g[0],y=g[1],E=Object(r.useState)(!0),_=Object(G.a)(E,2),w=_[0],T=_[1];function x(){q()(v,v.name)}return Object(r.useEffect)(function(){p&&!w&&T(!0)},[p,w]),Object(r.useEffect)(function(){h.length&&new N.a(h[0],{quality:.6,success:function(e){T(!1),y(e)},error:function(e){T(!1)}})},[h]),h.length?p?i.a.createElement(l.a,null,i.a.createElement("div",{className:"w-full flex justify-center items-center"},i.a.createElement(H.a,{width:64,heigh:64}))):n?v&&!w?i.a.createElement(l.b,{enter:{animation:"transition.expandIn"},className:Object(f.a)(e.fileCompressWrapper,"mb-12 rounded-12 border-3 border-dotted flex justify-center items-center px-12")},i.a.createElement("div",{className:"max-w-64 sm:max-w-128 p-12"},i.a.createElement("img",{className:Object(f.a)(e.previewImage,"rounded-12"),src:URL.createObjectURL(v),alt:v.name})),i.a.createElement("div",{className:"flex-1 px-12"},i.a.createElement(o.a,{className:"text-20 mb-16",color:"textSecondary"},v.name," \u58d3\u7e2e\u5b8c\u6210"),i.a.createElement(k.a,{variant:"determinate",value:100,className:"w-full",color:"secondary"})),i.a.createElement("div",{className:"flex flex-col justify-around items-center px-24"},i.a.createElement(o.a,{color:"textSecondary",variant:"subtitle1"},"\u5c3a\u5bf8"),i.a.createElement(o.a,{color:"textPrimary",variant:"h6"},u[0].width," X",u[0].height)),i.a.createElement("div",{className:"flex flex-col justify-center items-center px-24"},i.a.createElement(o.a,{color:"textSecondary",variant:"subtitle1"},"\u5927\u5c0f"),i.a.createElement(o.a,{color:"textPrimary",variant:"h6"},F()(v.size)),i.a.createElement(o.a,{color:"textPrimary",variant:"subtitle1"},"\u6e1b\u5c11",(100*(1-v.size/s[0])).toFixed(2),"%")),i.a.createElement("div",{className:"flex flex-col justify-center items-center px-24"},i.a.createElement(o.a,{color:"textSecondary",variant:"subtitle1"},"\u5716\u6a94"),i.a.createElement(o.a,{color:"textPrimary",variant:"h6"},$(v.type))),i.a.createElement("div",{className:"flex flex-col justify-center items-center px-24"},i.a.createElement(D.a,{title:"\u4e0b\u8f09\u5716\u7247",placement:"top"},i.a.createElement(U.a,{"aria-label":"\u4e0b\u8f09",color:"inherit",onClick:x},i.a.createElement(V.a,null,"cloudDownLoad"))))):i.a.createElement("div",{className:Object(f.a)(e.fileCompressWrapper,"mb-12 rounded-12 border-3 border-dotted flex justify-center items-center px-12")},i.a.createElement("div",{className:Object(f.a)(e.previewImageWrapper,"max-w-64 sm:max-w-128 p-12")},i.a.createElement("img",{className:"rounded-12",src:d[0],alt:"\u5716\u7247\u58d3\u7e2e\u4e2d"})),i.a.createElement("div",{className:"flex-1 px-12"},i.a.createElement(o.a,{className:"text-20 mb-16",color:"textSecondary"},"\u5716\u7247\u58d3\u7e2e\u4e2d..."),i.a.createElement(k.a,{className:"w-full",color:"secondary"}))):v&&!w?i.a.createElement(l.b,{enter:{animation:"transition.expandIn"},className:Object(f.a)(e.fileCompressWrapper,"mb-12 rounded-12 border-3 border-dotted flex flex-wrap justify-center items-center px-12")},i.a.createElement("div",{className:"w-full p-12 pt-20 flex justify-center items-center"},i.a.createElement("img",{className:Object(f.a)(e.previewImage,"rounded-12 max-w-128"),src:URL.createObjectURL(v),alt:v.name})),i.a.createElement("div",{className:"flex flex-col justify-center items-center p-12 w-full"},i.a.createElement("div",{className:Object(f.a)(e.scrollBox,"w-full overflow-x-scroll")},i.a.createElement(o.a,{className:"text-20 mb-16 whitespace-no-wrap",color:"textSecondary"},v.name," \u58d3\u7e2e\u5b8c\u6210")),i.a.createElement(k.a,{variant:"determinate",value:100,className:"w-full",color:"secondary"})),i.a.createElement("div",{className:Object(f.a)(e.scrollBox,"flex w-full overflow-x-scroll p-12")},i.a.createElement("div",{className:"flex flex-1 flex-col justify-around items-center px-24"},i.a.createElement(o.a,{className:"whitespace-no-wrap",color:"textSecondary",variant:"subtitle1"},"\u5c3a\u5bf8"),i.a.createElement(o.a,{className:"whitespace-no-wrap",color:"textPrimary",variant:"h6"},u[0].width," X",u[0].height)),i.a.createElement("div",{className:"flex flex-1 flex-col justify-center items-center px-24"},i.a.createElement(o.a,{className:"whitespace-no-wrap",color:"textSecondary",variant:"subtitle1"},"\u5927\u5c0f"),i.a.createElement(o.a,{className:"whitespace-no-wrap",color:"textPrimary",variant:"h6"},F()(v.size)),i.a.createElement(o.a,{className:"whitespace-no-wrap",color:"textPrimary",variant:"subtitle1"},"\u6e1b\u5c11",(100*(1-v.size/s[0])).toFixed(2),"%")),i.a.createElement("div",{className:"flex flex-1 flex-col justify-around items-center px-24"},i.a.createElement(o.a,{className:"whitespace-no-wrap",color:"textSecondary",variant:"subtitle1"},"\u5716\u6a94"),i.a.createElement(o.a,{className:"whitespace-no-wrap",color:"textPrimary",variant:"h6"},$(v.type)))),i.a.createElement("div",{className:"w-full flex flex-col justify-around items-center p-24",onClick:x},i.a.createElement(D.a,{title:"\u4e0b\u8f09\u5716\u7247",placement:"top"},i.a.createElement(U.a,{"aria-label":"\u4e0b\u8f09",color:"inherit"},i.a.createElement(V.a,null,"cloudDownLoad"))))):i.a.createElement("div",{className:Object(f.a)(e.fileCompressWrapper,"mb-12 rounded-12 border-3 border-dotted flex flex-col justify-center items-center px-12")},i.a.createElement("div",{className:"w-full p-12 pt-20 flex justify-center items-center"},i.a.createElement("img",{className:Object(f.a)(e.previewImage,"rounded-12 max-w-128"),src:d[0],alt:"\u5716\u7247\u58d3\u7e2e\u4e2d"})),i.a.createElement("div",{className:"flex-1 p-24 w-full text-center"},i.a.createElement(o.a,{className:"text-20 mb-16",color:"textSecondary"},"\u5716\u7247\u58d3\u7e2e\u4e2d..."),i.a.createElement(k.a,{className:"w-full",color:"secondary"}))):null};var ne=function(){return i.a.createElement("div",{className:"flex flex-wrap flex-1 justify-center items-center"},i.a.createElement("div",{className:"w-full \\flex flex-col justify-center items-center text-center py-12"},i.a.createElement(o.a,{color:"textSecondary",variant:"h6"},"\u9019\u500b APP \u80fd\u505a\u4ec0\u9ebc\uff1f"),i.a.createElement(o.a,{className:"font-bold",color:"textPrimary",variant:"subtitle1"},"\u6b64 APP \u7531JS\u7de8\u5beb\uff0c\u53ef\u9032\u884c\u7c21\u55ae\u7684\u5716\u7247\u7de8\u8f2f\u3001\u88c1\u5207\u3001\u58d3\u7e2e\uff0c\u76ee\u524d\u53ea\u80fd\u4e00\u6b21\u4e00\u5f35\u5716\u7247")),i.a.createElement("div",{className:"w-full sm:w-1/2 flex flex-col justify-center items-center py-12"},i.a.createElement(o.a,{color:"textSecondary",variant:"h6"},"\u6587\u4ef6\u5927\u5c0f\u9650\u5236"),i.a.createElement(o.a,{className:"font-bold",color:"textPrimary",variant:"subtitle1"},"10 MB")),i.a.createElement("div",{className:"w-full sm:w-1/2 flex flex-col justify-center items-center py-12"},i.a.createElement(o.a,{color:"textSecondary",variant:"h6"},"\u4f7f\u7528\u6846\u67b6"),i.a.createElement(o.a,{className:"font-bold",color:"textPrimary",variant:"subtitle1"},"Vanilla.js\u3001React.js\u3001WebGL")))};t.default=Object(a.a)(function(e){return{layoutRoot:{}}},{withTheme:!0})(function(e){var t=e.classes;return i.a.createElement(l.m,{classes:{root:t.layoutRoot},header:i.a.createElement("div",{className:"p-24 h-200 w-full"},i.a.createElement(l.a,null,i.a.createElement(o.a,{className:"mt-22 sm:mt-22 sm:py-12 text-24 sm:text-28 font-600 text-center pb-10",color:"inherit"},"\u6b64\u670d\u52d9\u50c5\u5728\u5ba2\u6236\u7aef\u57f7\u884c",i.a.createElement("br",null),i.a.createElement("span",{className:"text-blue"})," \u800c\u4e14",i.a.createElement("span",{className:"text-blue"},"\u4e0d\u6703\u4e0a\u50b3\u4efb\u4f55\u5716\u7247")))),content:i.a.createElement("div",{className:"flex flex-col h-full p-24"},i.a.createElement(P,null),i.a.createElement(te,null),i.a.createElement(ne,null))})})}}]);